{"version":3,"file":"panel-teambuilder.js","names":["TeambuilderRoom","DEFAULT_FORMAT","curFolder","curFolderKeep","handleMessage","line","startsWith","spaceIndex","indexOf","cmd","slice","target","PS","teams","push","createTeam","unshift","update","team","byKey","undelete","alert","copyFrom","name","format","folder","packedTeam","iconCache","key","endsWith","list","length","PSRoom","TeambuilderPanel","selectFolder","e","room","props","elem","className","getAttribute","parentElement","preventDefault","stopImmediatePropagation","forceUpdate","renderFolderList","folderTable","folders","PSUtils","sortBy","parseInt","charAt","renderedFormatFolders","renderedFolders","gen","newGen","folderOpenIcon","render","deletedTeams","undeleteIndex","splice","filterFolder","filterFormat","filter","map","PSRoomPanel","roomTypes","Model","Component","title"],"sources":["../src/panel-teambuilder.tsx"],"sourcesContent":["/**\n * Teambuilder panel\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\nclass TeambuilderRoom extends PSRoom {\n\treadonly DEFAULT_FORMAT = 'gen8' as ID;\n\n\t/**\n\t * - `\"\"` - all\n\t * - `\"gen[NUMBER][ID]\"` - format folder\n\t * - `\"gen[NUMBER]\"` - uncategorized gen folder\n\t * - `\"[ID]/\"` - folder\n\t * - `\"/\"` - not in folder\n\t */\n\tcurFolder = '';\n\tcurFolderKeep = '';\n\n\t/**\n\t * @return true to prevent line from being sent to server\n\t */\n\thandleMessage(line: string) {\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\n\t\tconst spaceIndex = line.indexOf(' ');\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\n\t\tswitch (cmd) {\n\t\tcase 'newteam': {\n\t\t\tif (target === 'bottom') {\n\t\t\t\tPS.teams.push(this.createTeam());\n\t\t\t} else {\n\t\t\t\tPS.teams.unshift(this.createTeam());\n\t\t\t}\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'deleteteam': {\n\t\t\tconst team = PS.teams.byKey[target];\n\t\t\tif (team) PS.teams.delete(team);\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'undeleteteam': {\n\t\t\tPS.teams.undelete();\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t}}\n\n\t\t// unrecognized command\n\t\talert(`Unrecognized command: ${line}`);\n\t\treturn true;\n\t}\n\n\tcreateTeam(copyFrom?: Team): Team {\n\t\tif (copyFrom) {\n\t\t\treturn {\n\t\t\t\tname: `Copy of ${copyFrom.name}`,\n\t\t\t\tformat: copyFrom.format,\n\t\t\t\tfolder: copyFrom.folder,\n\t\t\t\tpackedTeam: copyFrom.packedTeam,\n\t\t\t\ticonCache: null,\n\t\t\t\tkey: '',\n\t\t\t};\n\t\t} else {\n\t\t\tconst format = this.curFolder && !this.curFolder.endsWith('/') ? this.curFolder as ID : this.DEFAULT_FORMAT;\n\t\t\tconst folder = this.curFolder.endsWith('/') ? this.curFolder.slice(0, -1) : '';\n\t\t\treturn {\n\t\t\t\tname: `Untitled ${PS.teams.list.length + 1}`,\n\t\t\t\tformat,\n\t\t\t\tfolder,\n\t\t\t\tpackedTeam: '',\n\t\t\t\ticonCache: null,\n\t\t\t\tkey: '',\n\t\t\t};\n\t\t}\n\t}\n}\n\nclass TeambuilderPanel extends PSRoomPanel<TeambuilderRoom> {\n\tselectFolder = (e: MouseEvent) => {\n\t\tconst room = this.props.room;\n\t\tlet elem = e.target as HTMLElement | null;\n\t\tlet folder: string | null = null;\n\t\twhile (elem) {\n\t\t\tif (elem.className === 'selectFolder') {\n\t\t\t\tfolder = elem.getAttribute('data-value') || '';\n\t\t\t\tbreak;\n\t\t\t} else if (elem.className === 'folderlist') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telem = elem.parentElement;\n\t\t}\n\t\tif (folder === null) return;\n\t\troom.curFolderKeep = folder;\n\t\troom.curFolder = folder;\n\t\te.preventDefault();\n\t\te.stopImmediatePropagation();\n\t\tthis.forceUpdate();\n\t};\n\trenderFolderList() {\n\t\tconst room = this.props.room;\n\t\t// The folder list isn't actually saved anywhere:\n\t\t// it's regenerated anew from the team list every time.\n\n\t\t// (This is why folders you create will automatically disappear\n\t\t// if you leave them without adding anything to them.)\n\n\t\tconst folderTable: {[folder: string]: 1 | undefined} = {'': 1};\n\t\tconst folders: string[] = [];\n\t\tfor (const team of PS.teams.list) {\n\t\t\tconst folder = team.folder;\n\t\t\tif (folder && !(`${folder}/` in folderTable)) {\n\t\t\t\tfolders.push(`${folder}/`);\n\t\t\t\tfolderTable[`${folder}/`] = 1;\n\t\t\t\tif (!('/' in folderTable)) {\n\t\t\t\t\tfolders.push('/');\n\t\t\t\t\tfolderTable['/'] = 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst format = team.format || room.DEFAULT_FORMAT;\n\t\t\tif (!(format in folderTable)) {\n\t\t\t\tfolders.push(format);\n\t\t\t\tfolderTable[format] = 1;\n\t\t\t}\n\t\t}\n\t\tif (!(room.curFolderKeep in folderTable)) {\n\t\t\tfolderTable[room.curFolderKeep] = 1;\n\t\t\tfolders.push(room.curFolderKeep);\n\t\t}\n\t\tif (!(room.curFolder in folderTable)) {\n\t\t\tfolderTable[room.curFolder] = 1;\n\t\t\tfolders.push(room.curFolder);\n\t\t}\n\n\t\tPSUtils.sortBy(folders, folder => [\n\t\t\tfolder.endsWith('/') ? 10 : -parseInt(folder.charAt(3), 10),\n\t\t\tfolder,\n\t\t]);\n\n\t\tlet renderedFormatFolders = [\n\t\t\t<div class=\"foldersep\"></div>,\n\t\t\t<TeamFolder cur={false} value=\"+\">\n\t\t\t\t<i class=\"fa fa-plus\"></i><em>(add format folder)</em>\n\t\t\t</TeamFolder>,\n\t\t];\n\n\t\tlet renderedFolders: preact.ComponentChild[] = [];\n\n\t\tlet gen = -1;\n\t\tfor (let format of folders) {\n\t\t\tconst newGen = format.endsWith('/') ? 0 : parseInt(format.charAt(3), 10);\n\t\t\tif (gen !== newGen) {\n\t\t\t\tgen = newGen;\n\t\t\t\tif (gen === 0) {\n\t\t\t\t\trenderedFolders.push(...renderedFormatFolders);\n\t\t\t\t\trenderedFormatFolders = [];\n\t\t\t\t\trenderedFolders.push(<div class=\"foldersep\"></div>);\n\t\t\t\t\trenderedFolders.push(<div class=\"folder\"><h3>Folders</h3></div>);\n\t\t\t\t} else {\n\t\t\t\t\trenderedFolders.push(<div class=\"folder\"><h3>Gen {gen}</h3></div>);\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst folderOpenIcon = room.curFolder === format ? 'fa-folder-open' : 'fa-folder';\n\t\t\tif (gen === 0) {\n\t\t\t\trenderedFolders.push(<TeamFolder cur={room.curFolder === format} value={format}>\n\t\t\t\t\t<i class={\n\t\t\t\t\t\t`fa ${folderOpenIcon}${format === '/' ? '-o' : ''}`\n\t\t\t\t\t}></i>\n\t\t\t\t\t{format.slice(0, -1) || '(uncategorized)'}\n\t\t\t\t</TeamFolder>);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\trenderedFolders.push(<TeamFolder cur={room.curFolder === format} value={format}>\n\t\t\t\t<i class={`fa ${folderOpenIcon}-o`}></i>\n\t\t\t\t{format.slice(4) || '(uncategorized)'}\n\t\t\t</TeamFolder>);\n\t\t}\n\t\trenderedFolders.push(...renderedFormatFolders);\n\n\t\treturn <div class=\"folderlist\" onClick={this.selectFolder}>\n\t\t\t<div class=\"folderlistbefore\"></div>\n\n\t\t\t<TeamFolder cur={!room.curFolder} value=\"\">\n\t\t\t\t<em>(all)</em>\n\t\t\t</TeamFolder>\n\t\t\t{renderedFolders}\n\t\t\t<div class=\"foldersep\"></div>\n\t\t\t<TeamFolder cur={false} value=\"++\">\n\t\t\t\t<i class=\"fa fa-plus\"></i><em>(add folder)</em>\n\t\t\t</TeamFolder>\n\n\t\t\t<div class=\"folderlistafter\"></div>\n\t\t</div>;\n\t}\n\n\trender() {\n\t\tconst room = this.props.room;\n\t\tlet teams: (Team | null)[] = PS.teams.list.slice();\n\n\t\tif (PS.teams.deletedTeams.length) {\n\t\t\tconst undeleteIndex = PS.teams.deletedTeams[PS.teams.deletedTeams.length - 1][1];\n\t\t\tteams.splice(undeleteIndex, 0, null);\n\t\t}\n\n\t\tlet filterFolder: string | null = null;\n\t\tlet filterFormat: string | null = null;\n\t\tif (room.curFolder) {\n\t\t\tif (room.curFolder.slice(-1) === '/') {\n\t\t\t\tfilterFolder = room.curFolder.slice(0, -1);\n\t\t\t\tteams = teams.filter(team => !team || team.folder === filterFolder);\n\t\t\t} else {\n\t\t\t\tfilterFormat = room.curFolder;\n\t\t\t\tteams = teams.filter(team => !team || team.format === filterFormat);\n\t\t\t}\n\t\t}\n\n\t\treturn <PSPanelWrapper room={room}>\n\t\t\t<div class=\"folderpane\">\n\t\t\t\t{this.renderFolderList()}\n\t\t\t</div>\n\t\t\t<div class=\"teampane\">\n\t\t\t\t{filterFolder ?\n\t\t\t\t\t<h2>\n\t\t\t\t\t\t<i class=\"fa fa-folder-open\"></i> {filterFolder} {}\n\t\t\t\t\t\t<button class=\"button small\" style=\"margin-left:5px\" name=\"renameFolder\">\n\t\t\t\t\t\t\t<i class=\"fa fa-pencil\"></i> Rename\n\t\t\t\t\t\t</button> {}\n\t\t\t\t\t\t<button class=\"button small\" style=\"margin-left:5px\" name=\"promptDeleteFolder\">\n\t\t\t\t\t\t\t<i class=\"fa fa-times\"></i> Remove\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</h2>\n\t\t\t\t: filterFolder === '' ?\n\t\t\t\t\t<h2><i class=\"fa fa-folder-open-o\"></i> Teams not in any folders</h2>\n\t\t\t\t: filterFormat ?\n\t\t\t\t\t<h2><i class=\"fa fa-folder-open-o\"></i> {filterFormat} <small>({teams.length})</small></h2>\n\t\t\t\t:\n\t\t\t\t\t<h2>All Teams <small>({teams.length})</small></h2>\n\t\t\t\t}\n\t\t\t\t<p>\n\t\t\t\t\t<button name=\"cmd\" value=\"/newteam\" class=\"button big\"><i class=\"fa fa-plus-circle\"></i> New Team</button>\n\t\t\t\t</p>\n\t\t\t\t<ul class=\"teamlist\">\n\t\t\t\t\t{teams.map(team => team ? (\n\t\t\t\t\t\t<li key={team.key}>\n\t\t\t\t\t\t\t<TeamBox team={team} /> {}\n\t\t\t\t\t\t\t<button name=\"cmd\" value={`/deleteteam ${team.key}`}><i class=\"fa fa-trash\"></i> Delete</button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<li key=\"undelete\">\n\t\t\t\t\t\t\t<button name=\"cmd\" value={`/undeleteteam`}><i class=\"fa fa-undo\"></i> Undo delete</button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t))}\n\t\t\t\t</ul>\n\t\t\t\t<p>\n\t\t\t\t\t<button name=\"cmd\" value=\"/newteam bottom\" class=\"button\"><i class=\"fa fa-plus-circle\"></i> New Team</button>\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nPS.roomTypes['teambuilder'] = {\n\tModel: TeambuilderRoom,\n\tComponent: TeambuilderPanel,\n\ttitle: \"Teambuilder\",\n};\n"],"mappings":"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"}