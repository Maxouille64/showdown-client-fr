{"version":3,"file":"panel-battle.js","names":["BattlesRoom","options","classType","format","battles","refresh","setFormat","update","PS","send","toID","PSRoom","BattlesPanel","props","room","changeFormat","e","value","target","renderBattleLink","battle","id","split","minEloMessage","minElo","p1","p2","render","Dex","getPokemonIcon","length","map","PSRoomPanel","BattleRoom","side","request","choices","handleMessage","line","startsWith","spaceIndex","indexOf","cmd","slice","play","pause","turnNum","Number","charAt","turn","isNaN","receiveLine","seekTurn","switchSides","isDone","isEmpty","BattleChoiceBuilder","possibleError","addChoice","toString","ChatRoom","BattleDiv","shouldComponentUpdate","preact","Component","MoveButton","type","tooltip","children","moveData","pp","maxpp","PokemonButton","pokemon","disabled","opacity","hpColorClass","BattleScene","getHPColor","name","noHPBar","fainted","width","Math","round","hp","maxhp","status","BattlePanel","text","focusIfNoSelection","selection","window","getSelection","focus","onKey","keyCode","chatLog","base","getElementsByClassName","scrollTop","offsetHeight","toggleBoostedMove","checkbox","currentTarget","current","mega","checked","ultra","z","max","querySelector","componentDidMount","$elem","$","Battle","$frame","find","$logFrame","scene","tooltips","listen","subscribe","forceUpdate","args","Infinity","receiveRequest","JSON","parse","instantAdd","join","add","fixRequest","myPokemon","setPerspective","renderControls","renderPlayerControls","atEnd","atQueueEnd","paused","renderMoveControls","dex","pokemonIndex","index","active","currentMoveRequest","maxMoves","canDynamax","moves","i","move","get","maxMoveData","gmaxTooltip","zMoves","zMoveData","renderMoveTargetControls","moveTarget","getChosenMove","moveChoice","stringChoice","userSlot","userSlotCross","farSide","abs","reverse","nearSide","renderSwitchControls","numActive","requestLength","trapped","serverPokemon","cantSwitch","alreadySwitchingIn","includes","renderTeamControls","renderTeamList","team","renderChosenTeam","slot","renderOldChoices","requestType","buf","noCancel","choiceString","choice","parseChoice","choiceType","push","canGigantamax","targetLoc","targetPokemon","moveRequest","alreadyMax","canMegaEvo","alreadyMega","canZMove","alreadyZ","moveName","canShift","gameType","canUltraBurst","roomTypes","Model","updateRoomTypes"],"sources":["../src/panel-battle.tsx"],"sourcesContent":["/**\n * Battle panel\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\ntype BattleDesc = {\n\tid: RoomID,\n\tminElo?: number | string,\n\tp1?: string,\n\tp2?: string,\n\tp3?: string,\n\tp4?: string,\n};\n\nclass BattlesRoom extends PSRoom {\n\toverride readonly classType = 'battles';\n\t/** null means still loading */\n\tformat = '';\n\tbattles: BattleDesc[] | null = null;\n\tconstructor(options: RoomOptions) {\n\t\tsuper(options);\n\t\tthis.refresh();\n\t}\n\tsetFormat(format: string) {\n\t\tif (format === this.format) return this.refresh();\n\t\tthis.battles = null;\n\t\tthis.format = format;\n\t\tthis.update(null);\n\t\tthis.refresh();\n\t}\n\trefresh() {\n\t\tPS.send(`|/cmd roomlist ${toID(this.format)}`);\n\t}\n}\n\nclass BattlesPanel extends PSRoomPanel<BattlesRoom> {\n\trefresh = () => {\n\t\tthis.props.room.refresh();\n\t};\n\tchangeFormat = (e: Event) => {\n\t\tconst value = (e.target as HTMLButtonElement).value;\n\t\tthis.props.room.setFormat(value);\n\t};\n\trenderBattleLink(battle: BattleDesc) {\n\t\tconst format = battle.id.split('-')[1];\n\t\tconst minEloMessage = typeof battle.minElo === 'number' ? `rated ${battle.minElo}` : battle.minElo;\n\t\treturn <div><a href={`/${battle.id}`} class=\"blocklink\">\n\t\t\t{minEloMessage && <small style=\"float:right\">({minEloMessage})</small>}\n\t\t\t<small>[{format}]</small><br />\n\t\t\t<em class=\"p1\">{battle.p1}</em> <small class=\"vs\">vs.</small> <em class=\"p2\">{battle.p2}</em>\n\t\t</a></div>;\n\t}\n\trender() {\n\t\tconst room = this.props.room;\n\t\treturn <PSPanelWrapper room={room} scrollable><div class=\"pad\">\n\t\t\t<button class=\"button\" style=\"float:right;font-size:10pt;margin-top:3px\" name=\"close\"><i class=\"fa fa-times\"></i> Close</button>\n\t\t\t<div class=\"roomlist\">\n\t\t\t\t<p>\n\t\t\t\t\t<button class=\"button\" name=\"refresh\" onClick={this.refresh}><i class=\"fa fa-refresh\"></i> Refresh</button> <span style={Dex.getPokemonIcon('meloetta-pirouette') + ';display:inline-block;vertical-align:middle'} class=\"picon\" title=\"Meloetta is PS's mascot! The Pirouette forme is Fighting-type, and represents our battles.\"></span>\n\t\t\t\t</p>\n\n\t\t\t\t<p>\n\t\t\t\t\t<label class=\"label\">Format:</label><FormatDropdown onChange={this.changeFormat} />\n\t\t\t\t</p>\n\t\t\t\t{/* <label>Minimum Elo: <select name=\"elofilter\"><option value=\"none\">None</option><option value=\"1100\">1100</option><option value=\"1300\">1300</option><option value=\"1500\">1500</option><option value=\"1700\">1700</option><option value=\"1900\">1900</option></select></label>\n\n\t\t\t\t<form class=\"search\">\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<input type=\"text\" name=\"prefixsearch\" class=\"textbox\" placeholder=\"Username prefix\"/><button type=\"submit\" class=\"button\">Search</button>\n\t\t\t\t\t</p>\n\t\t\t\t</form> */}\n\t\t\t\t<div class=\"list\">{!room.battles ?\n\t\t\t\t\t<p>Loading...</p>\n\t\t\t\t: !room.battles.length ?\n\t\t\t\t\t<p>No battles are going on</p>\n\t\t\t\t:\n\t\t\t\t\troom.battles.map(battle => this.renderBattleLink(battle))\n\t\t\t\t}</div>\n\t\t\t</div>\n\t\t</div></PSPanelWrapper>;\n\t}\n}\n\nclass BattleRoom extends ChatRoom {\n\toverride readonly classType = 'battle';\n\tdeclare pmTarget: null;\n\tdeclare challengeMenuOpen: false;\n\tdeclare challengingFormat: null;\n\tdeclare challengedFormat: null;\n\n\tbattle: Battle = null!;\n\t/** null if spectator, otherwise current player's info */\n\tside: BattleRequestSideInfo | null = null;\n\trequest: BattleRequest | null = null;\n\tchoices: BattleChoiceBuilder | null = null;\n\n\t/**\n\t * @return true to prevent line from being sent to server\n\t */\n\thandleMessage(line: string) {\n\t\tif (!line.startsWith('/') || line.startsWith('//')) return false;\n\t\tconst spaceIndex = line.indexOf(' ');\n\t\tconst cmd = spaceIndex >= 0 ? line.slice(1, spaceIndex) : line.slice(1);\n\t\tconst target = spaceIndex >= 0 ? line.slice(spaceIndex + 1) : '';\n\t\tswitch (cmd) {\n\t\tcase 'play': {\n\t\t\tthis.battle.play();\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'pause': {\n\t\t\tthis.battle.pause();\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'ffto': case 'fastfowardto': {\n\t\t\tlet turnNum = Number(target);\n\t\t\tif (target.charAt(0) === '+' || turnNum < 0) {\n\t\t\t\tturnNum += this.battle.turn;\n\t\t\t\tif (turnNum < 0) turnNum = 0;\n\t\t\t} else if (target === 'end') {\n\t\t\t\tturnNum = -1;\n\t\t\t}\n\t\t\tif (isNaN(turnNum)) {\n\t\t\t\tthis.receiveLine([`error`, `/ffto - Invalid turn number: ${target}`]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tthis.battle.seekTurn(turnNum);\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'switchsides': {\n\t\t\tthis.battle.switchSides();\n\t\t\treturn true;\n\t\t} case 'cancel': case 'undo': {\n\t\t\tif (!this.choices || !this.request) {\n\t\t\t\tthis.receiveLine([`error`, `/choose - You are not a player in this battle`]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.choices.isDone() || this.choices.isEmpty()) {\n\t\t\t\tthis.send('/undo', true);\n\t\t\t}\n\t\t\tthis.choices = new BattleChoiceBuilder(this.request);\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t} case 'move': case 'switch': case 'team': case 'pass': case 'shift': case 'choose': {\n\t\t\tif (!this.choices) {\n\t\t\t\tthis.receiveLine([`error`, `/choose - You are not a player in this battle`]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tconst possibleError = this.choices.addChoice(line.slice(cmd === 'choose' ? 8 : 1));\n\t\t\tif (possibleError) {\n\t\t\t\tthis.receiveLine([`error`, possibleError]);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (this.choices.isDone()) this.send(`/choose ${this.choices.toString()}`, true);\n\t\t\tthis.update(null);\n\t\t\treturn true;\n\t\t}}\n\t\treturn super.handleMessage(line);\n\t}\n}\n\nclass BattleDiv extends preact.Component {\n\tshouldComponentUpdate() {\n\t\treturn false;\n\t}\n\trender() {\n\t\treturn <div class=\"battle\"></div>;\n\t}\n}\n\nfunction MoveButton(props: {\n\tchildren: string, cmd: string, moveData: {pp: number, maxpp: number}, type: TypeName, tooltip: string,\n}) {\n\treturn <button name=\"cmd\" value={props.cmd} class={`type-${props.type} has-tooltip`} data-tooltip={props.tooltip}>\n\t\t{props.children}<br />\n\t\t<small class=\"type\">{props.type}</small> <small class=\"pp\">{props.moveData.pp}/{props.moveData.maxpp}</small>&nbsp;\n\t</button>;\n}\nfunction PokemonButton(props: {\n\tpokemon: Pokemon | ServerPokemon | null, cmd: string, noHPBar?: boolean, disabled?: boolean | 'fade', tooltip: string,\n}) {\n\tconst pokemon = props.pokemon;\n\tif (!pokemon) {\n\t\treturn <button\n\t\t\tname=\"cmd\" value={props.cmd} class={`${props.disabled ? 'disabled ' : ''}has-tooltip`}\n\t\t\tstyle={{opacity: props.disabled === 'fade' ? 0.5 : 1}} data-tooltip={props.tooltip}\n\t\t>\n\t\t\t(empty slot)\n\t\t</button>;\n\t}\n\n\tlet hpColorClass;\n\tswitch (BattleScene.getHPColor(pokemon)) {\n\tcase 'y': hpColorClass = 'hpbar hpbar-yellow'; break;\n\tcase 'r': hpColorClass = 'hpbar hpbar-red'; break;\n\tdefault: hpColorClass = 'hpbar'; break;\n\t}\n\n\treturn <button\n\t\tname=\"cmd\" value={props.cmd} class={`${props.disabled ? 'disabled ' : ''}has-tooltip`}\n\t\tstyle={{opacity: props.disabled === 'fade' ? 0.5 : 1}} data-tooltip={props.tooltip}\n\t>\n\t\t<span class=\"picon\" style={Dex.getPokemonIcon(pokemon)}></span>\n\t\t{pokemon.name}\n\t\t{\n\t\t\t!props.noHPBar && !pokemon.fainted &&\n\t\t\t<span class={hpColorClass}>\n\t\t\t\t<span style={{width: Math.round(pokemon.hp * 92 / pokemon.maxhp) || 1}}></span>\n\t\t\t</span>\n\t\t}\n\t\t{!props.noHPBar && pokemon.status && <span class={`status ${pokemon.status}`}></span>}\n\t</button>;\n}\n\nclass BattlePanel extends PSRoomPanel<BattleRoom> {\n\tsend = (text: string) => {\n\t\tthis.props.room.send(text);\n\t};\n\tfocus() {\n\t\tthis.base!.querySelector('textarea')!.focus();\n\t}\n\tfocusIfNoSelection = () => {\n\t\tconst selection = window.getSelection()!;\n\t\tif (selection.type === 'Range') return;\n\t\tthis.focus();\n\t};\n\tonKey = (e: KeyboardEvent) => {\n\t\tif (e.keyCode === 33) { // Pg Up key\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\n\t\t\tchatLog.scrollTop = chatLog.scrollTop - chatLog.offsetHeight + 60;\n\t\t\treturn true;\n\t\t} else if (e.keyCode === 34) { // Pg Dn key\n\t\t\tconst chatLog = this.base!.getElementsByClassName('chat-log')[0] as HTMLDivElement;\n\t\t\tchatLog.scrollTop = chatLog.scrollTop + chatLog.offsetHeight - 60;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\ttoggleBoostedMove = (e: Event) => {\n\t\tconst checkbox = e.currentTarget as HTMLInputElement;\n\t\tconst choices = this.props.room.choices;\n\t\tif (!choices) return; // shouldn't happen\n\t\tswitch (checkbox.name) {\n\t\tcase 'mega':\n\t\t\tchoices.current.mega = checkbox.checked;\n\t\t\tbreak;\n\t\tcase 'ultra':\n\t\t\tchoices.current.ultra = checkbox.checked;\n\t\t\tbreak;\n\t\tcase 'z':\n\t\t\tchoices.current.z = checkbox.checked;\n\t\t\tbreak;\n\t\tcase 'max':\n\t\t\tchoices.current.max = checkbox.checked;\n\t\t\tbreak;\n\t\t}\n\t\tthis.props.room.update(null);\n\t};\n\tcomponentDidMount() {\n\t\tconst $elem = $(this.base!);\n\t\tconst battle = new Battle({\n\t\t\t$frame: $elem.find('.battle'),\n\t\t\t$logFrame: $elem.find('.battle-log'),\n\t\t});\n\t\tthis.props.room.battle = battle;\n\t\t(battle.scene as BattleScene).tooltips.listen($elem.find('.battle-controls'));\n\t\tsuper.componentDidMount();\n\t\tbattle.subscribe(() => this.forceUpdate());\n\t}\n\treceiveLine(args: Args) {\n\t\tconst room = this.props.room;\n\t\tswitch (args[0]) {\n\t\tcase 'initdone':\n\t\t\troom.battle.seekTurn(Infinity);\n\t\t\treturn;\n\t\tcase 'request':\n\t\t\tthis.receiveRequest(args[1] ? JSON.parse(args[1]) : null);\n\t\t\treturn;\n\t\tcase 'win': case 'tie':\n\t\t\tthis.receiveRequest(null);\n\t\t\tbreak;\n\t\tcase 'c': case 'c:': case 'chat': case 'chatmsg': case 'inactive':\n\t\t\troom.battle.instantAdd('|' + args.join('|'));\n\t\t\treturn;\n\t\tcase 'error':\n\t\t\tif (args[1].startsWith('[Invalid choice]') && room.request) {\n\t\t\t\troom.choices = new BattleChoiceBuilder(room.request);\n\t\t\t\troom.update(null);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\troom.battle.add('|' + args.join('|'));\n\t}\n\treceiveRequest(request: BattleRequest | null) {\n\t\tconst room = this.props.room;\n\t\tif (!request) {\n\t\t\troom.request = null;\n\t\t\troom.choices = null;\n\t\t\treturn;\n\t\t}\n\n\t\tBattleChoiceBuilder.fixRequest(request, room.battle);\n\n\t\tif (request.side) {\n\t\t\troom.battle.myPokemon = request.side.pokemon;\n\t\t\troom.battle.setPerspective(request.side.id);\n\t\t\troom.side = request.side;\n\t\t}\n\n\t\troom.request = request;\n\t\troom.choices = new BattleChoiceBuilder(request);\n\t\troom.update(null);\n\t}\n\trenderControls() {\n\t\tconst room = this.props.room;\n\t\tif (!room.battle) return null;\n\t\tif (room.side) {\n\t\t\treturn this.renderPlayerControls();\n\t\t}\n\t\tconst atEnd = room.battle.atQueueEnd;\n\t\treturn <div class=\"controls\">\n\t\t\t<p>\n\t\t\t\t{atEnd ?\n\t\t\t\t\t<button class=\"button disabled\" name=\"cmd\" value=\"/play\"><i class=\"fa fa-play\"></i><br />Play</button>\n\t\t\t\t: room.battle.paused ?\n\t\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/play\"><i class=\"fa fa-play\"></i><br />Play</button>\n\t\t\t\t:\n\t\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/pause\"><i class=\"fa fa-pause\"></i><br />Pause</button>\n\t\t\t\t} {}\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/ffto -1\"><i class=\"fa fa-step-backward\"></i><br />Last turn</button>\n\t\t\t\t<button class={\"button\" + (atEnd ? \" disabled\" : \"\")} name=\"cmd\" value=\"/ffto +1\"><i class=\"fa fa-step-forward\"></i><br />Skip turn</button> {}\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/ffto 0\"><i class=\"fa fa-undo\"></i><br />First turn</button>\n\t\t\t\t<button class={\"button\" + (atEnd ? \" disabled\" : \"\")} name=\"cmd\" value=\"/ffto end\"><i class=\"fa fa-fast-forward\"></i><br />Skip to end</button>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t<button class=\"button\" name=\"cmd\" value=\"/switchsides\"><i class=\"fa fa-random\"></i> Switch sides</button>\n\t\t\t</p>\n\t\t</div>;\n\t}\n\trenderMoveControls(request: BattleMoveRequest, choices: BattleChoiceBuilder) {\n\t\tconst dex = this.props.room.battle.dex;\n\t\tconst pokemonIndex = choices.index();\n\t\tconst active = choices.currentMoveRequest();\n\t\tif (!active) return <div class=\"message-error\">Invalid pokemon</div>;\n\n\t\tif (choices.current.max || (active.maxMoves && !active.canDynamax)) {\n\t\t\tif (!active.maxMoves) {\n\t\t\t\treturn <div class=\"message-error\">Maxed with no max moves</div>;\n\t\t\t}\n\t\t\treturn active.moves.map((moveData, i) => {\n\t\t\t\tconst move = dex.moves.get(moveData.name);\n\t\t\t\tconst maxMoveData = active.maxMoves![i];\n\t\t\t\tconst gmaxTooltip = maxMoveData.id.startsWith('gmax') ? `|${maxMoveData.id}` : ``;\n\t\t\t\tconst tooltip = `maxmove|${moveData.name}|${pokemonIndex}${gmaxTooltip}`;\n\t\t\t\treturn <MoveButton cmd={`/move ${i + 1} max`} type={move.type} tooltip={tooltip} moveData={moveData}>\n\t\t\t\t\t{maxMoveData.name}\n\t\t\t\t</MoveButton>;\n\t\t\t});\n\t\t}\n\n\t\tif (choices.current.z) {\n\t\t\tif (!active.zMoves) {\n\t\t\t\treturn <div class=\"message-error\">No Z moves</div>;\n\t\t\t}\n\t\t\treturn active.moves.map((moveData, i) => {\n\t\t\t\tconst move = dex.moves.get(moveData.name);\n\t\t\t\tconst zMoveData = active.zMoves![i];\n\t\t\t\tif (!zMoveData) {\n\t\t\t\t\treturn <button disabled>&nbsp;</button>;\n\t\t\t\t}\n\t\t\t\tconst tooltip = `zmove|${moveData.name}|${pokemonIndex}`;\n\t\t\t\treturn <MoveButton cmd={`/move ${i + 1} zmove`} type={move.type} tooltip={tooltip} moveData={{pp: 1, maxpp: 1}}>\n\t\t\t\t\t{zMoveData.name}\n\t\t\t\t</MoveButton>;\n\t\t\t});\n\t\t}\n\n\t\treturn active.moves.map((moveData, i) => {\n\t\t\tconst move = dex.moves.get(moveData.name);\n\t\t\tconst tooltip = `move|${moveData.name}|${pokemonIndex}`;\n\t\t\treturn <MoveButton cmd={`/move ${i + 1}`} type={move.type} tooltip={tooltip} moveData={moveData}>\n\t\t\t\t{move.name}\n\t\t\t</MoveButton>;\n\t\t});\n\t}\n\trenderMoveTargetControls(request: BattleMoveRequest, choices: BattleChoiceBuilder) {\n\t\tconst battle = this.props.room.battle;\n\t\tconst moveTarget = choices.getChosenMove(choices.current, choices.index()).target;\n\t\tconst moveChoice = choices.stringChoice(choices.current);\n\n\t\tconst userSlot = choices.index();\n\t\tconst userSlotCross = battle.farSide.active.length - 1 - userSlot;\n\n\t\treturn [\n\t\t\tbattle.farSide.active.map((pokemon, i) => {\n\t\t\t\tlet disabled = false;\n\t\t\t\tif (moveTarget === 'adjacentAlly' || moveTarget === 'adjacentAllyOrSelf') {\n\t\t\t\t\tdisabled = true;\n\t\t\t\t} else if (moveTarget === 'normal' || moveTarget === 'adjacentFoe') {\n\t\t\t\t\tif (Math.abs(userSlotCross - i) > 1) disabled = true;\n\t\t\t\t}\n\n\t\t\t\tif (pokemon?.fainted) pokemon = null;\n\t\t\t\treturn <PokemonButton\n\t\t\t\t\tpokemon={pokemon}\n\t\t\t\t\tcmd={disabled ? `` : `/${moveChoice} +${i + 1}`} disabled={disabled && 'fade'} tooltip={`activepokemon|1|${i}`}\n\t\t\t\t/>;\n\t\t\t}).reverse(),\n\t\t\t<div style=\"clear: left\"></div>,\n\t\t\tbattle.nearSide.active.map((pokemon, i) => {\n\t\t\t\tlet disabled = false;\n\t\t\t\tif (moveTarget === 'adjacentFoe') {\n\t\t\t\t\tdisabled = true;\n\t\t\t\t} else if (moveTarget === 'normal' || moveTarget === 'adjacentAlly' || moveTarget === 'adjacentAllyOrSelf') {\n\t\t\t\t\tif (Math.abs(userSlot - i) > 1) disabled = true;\n\t\t\t\t}\n\t\t\t\tif (moveTarget !== 'adjacentAllyOrSelf' && userSlot === i) disabled = true;\n\n\t\t\t\tif (pokemon?.fainted) pokemon = null;\n\t\t\t\treturn <PokemonButton\n\t\t\t\t\tpokemon={pokemon}\n\t\t\t\t\tcmd={disabled ? `` : `/${moveChoice} -${i + 1}`} disabled={disabled && 'fade'} tooltip={`activepokemon|0|${i}`}\n\t\t\t\t/>;\n\t\t\t}),\n\t\t];\n\t}\n\trenderSwitchControls(request: BattleMoveRequest | BattleSwitchRequest, choices: BattleChoiceBuilder) {\n\t\tconst numActive = choices.requestLength();\n\n\t\tconst trapped = choices.currentMoveRequest()?.trapped;\n\n\t\treturn request.side.pokemon.map((serverPokemon, i) => {\n\t\t\tconst cantSwitch = trapped || i < numActive || choices.alreadySwitchingIn.includes(i + 1) || serverPokemon.fainted;\n\t\t\treturn <PokemonButton\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${i + 1}`} disabled={cantSwitch} tooltip={`switchpokemon|${i}`}\n\t\t\t/>;\n\t\t});\n\t}\n\trenderTeamControls(request: | BattleTeamRequest, choices: BattleChoiceBuilder) {\n\t\treturn request.side.pokemon.map((serverPokemon, i) => {\n\t\t\tconst cantSwitch = choices.alreadySwitchingIn.includes(i + 1);\n\t\t\treturn <PokemonButton\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${i + 1}`} noHPBar disabled={cantSwitch && 'fade'} tooltip={`switchpokemon|${i}`}\n\t\t\t/>;\n\t\t});\n\t}\n\trenderTeamList() {\n\t\tconst team = this.props.room.battle.myPokemon;\n\t\tif (!team) return;\n\t\treturn <div class=\"switchcontrols\">\n\t\t\t<h3 class=\"switchselect\">Team</h3>\n\t\t\t<div class=\"switchmenu\">\n\t\t\t\t{team.map((serverPokemon, i) => {\n\t\t\t\t\treturn <PokemonButton\n\t\t\t\t\t\tpokemon={serverPokemon} cmd={``} noHPBar disabled={true} tooltip={`switchpokemon|${i}`}\n\t\t\t\t\t/>;\n\t\t\t\t})}\n\t\t\t</div>\n\t\t</div>;\n\t}\n\trenderChosenTeam(request: BattleTeamRequest, choices: BattleChoiceBuilder) {\n\t\treturn choices.alreadySwitchingIn.map(slot => {\n\t\t\tconst serverPokemon = request.side.pokemon[slot - 1];\n\t\t\treturn <PokemonButton\n\t\t\t\tpokemon={serverPokemon} cmd={`/switch ${slot}`} disabled tooltip={`switchpokemon|${slot - 1}`}\n\t\t\t/>;\n\t\t});\n\t}\n\trenderOldChoices(request: BattleRequest, choices: BattleChoiceBuilder) {\n\t\tif (!choices) return null; // should not happen\n\t\tif (request.requestType !== 'move' && request.requestType !== 'switch') return;\n\t\tif (choices.isEmpty()) return null;\n\n\t\tlet buf: preact.ComponentChild[] = [\n\t\t\t<button name=\"cmd\" value=\"/cancel\" class=\"button\"><i class=\"fa fa-chevron-left\"></i> Back</button>, ' ',\n\t\t];\n\t\tif (choices.isDone() && request.noCancel) {\n\t\t\tbuf = ['Waiting for opponent...'];\n\t\t}\n\n\t\tconst battle = this.props.room.battle;\n\t\tfor (let i = 0; i < choices.choices.length; i++) {\n\t\t\tconst choiceString = choices.choices[i];\n\t\t\tconst choice = choices.parseChoice(choiceString);\n\t\t\tif (!choice) continue;\n\t\t\tconst pokemon = request.side.pokemon[i];\n\t\t\tconst active = request.requestType === 'move' ? request.active[i] : null;\n\t\t\tif (choice.choiceType === 'move') {\n\t\t\t\tbuf.push(`${pokemon.name} will `);\n\t\t\t\tif (choice.mega) buf.push(`Mega Evolve and `);\n\t\t\t\tif (choice.ultra) buf.push(`Ultra Burst and `);\n\t\t\t\tif (choice.max && active?.canDynamax) buf.push(active?.canGigantamax ? `Gigantamax and ` : `Dynamax and `);\n\t\t\t\tbuf.push(`use `, <strong>{choices.getChosenMove(choice, i).name}</strong>);\n\t\t\t\tif (choice.targetLoc > 0) {\n\t\t\t\t\tconst target = battle.farSide.active[choice.targetLoc - 1];\n\t\t\t\t\tif (!target) {\n\t\t\t\t\t\tbuf.push(` at slot ${choice.targetLoc}`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuf.push(` at ${target.name}`);\n\t\t\t\t\t}\n\t\t\t\t} else if (choice.targetLoc < 0) {\n\t\t\t\t\tconst target = battle.nearSide.active[-choice.targetLoc - 1];\n\t\t\t\t\tif (!target) {\n\t\t\t\t\t\tbuf.push(` at ally slot ${choice.targetLoc}`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuf.push(` at ally ${target.name}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (choice.choiceType === 'switch') {\n\t\t\t\tconst target = request.side.pokemon[choice.targetPokemon - 1];\n\t\t\t\tbuf.push(`${pokemon.name} will switch to `, <strong>{target.name}</strong>);\n\t\t\t} else if (choice.choiceType === 'shift') {\n\t\t\t\tbuf.push(`${pokemon.name} will `, <strong>shift</strong>, ` to the center`);\n\t\t\t}\n\t\t\tbuf.push(<br />);\n\t\t}\n\t\treturn buf;\n\t}\n\trenderPlayerControls() {\n\t\tconst room = this.props.room;\n\t\tconst request = room.request;\n\t\tlet choices = room.choices;\n\t\tif (!request) return 'Error: Missing request';\n\t\tif (!choices) return 'Error: Missing BattleChoiceBuilder';\n\t\tif (choices.request !== request) {\n\t\t\tchoices = new BattleChoiceBuilder(request);\n\t\t\troom.choices = choices;\n\t\t}\n\n\t\tif (choices.isDone()) {\n\t\t\treturn <div class=\"controls\">\n\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"pad\">\n\t\t\t\t\t{request.noCancel ? null : <button name=\"cmd\" value=\"/cancel\" class=\"button\">Cancel</button>}\n\t\t\t\t</div>\n\t\t\t\t{this.renderTeamList()}\n\t\t\t</div>;\n\t\t}\n\t\tif (request.side) room.battle.myPokemon = request.side.pokemon;\n\t\tswitch (request.requestType) {\n\t\tcase 'move': {\n\t\t\tconst index = choices.index();\n\t\t\tconst pokemon = request.side.pokemon[index];\n\t\t\tconst moveRequest = choices.currentMoveRequest()!;\n\n\t\t\tconst canDynamax = moveRequest.canDynamax && !choices.alreadyMax;\n\t\t\tconst canMegaEvo = moveRequest.canMegaEvo && !choices.alreadyMega;\n\t\t\tconst canZMove = moveRequest.zMoves && !choices.alreadyZ;\n\n\t\t\tif (choices.current.move) {\n\t\t\t\tconst moveName = choices.getChosenMove(choices.current, choices.index()).name;\n\t\t\t\treturn <div class=\"controls\">\n\t\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t\t{this.renderOldChoices(request, choices)}\n\t\t\t\t\t\t{pokemon.name} should use <strong>{moveName}</strong> at where? {}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t\t{this.renderMoveTargetControls(request, choices)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>;\n\t\t\t}\n\n\t\t\tconst canShift = room.battle.gameType === 'triples' && index !== 1;\n\n\t\t\treturn <div class=\"controls\">\n\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\n\t\t\t\t\tWhat will <strong>{pokemon.name}</strong> do?\n\t\t\t\t</div>\n\t\t\t\t<div class=\"movecontrols\">\n\t\t\t\t\t<h3 class=\"moveselect\">Attack</h3>\n\t\t\t\t\t<div class=\"movemenu\">\n\t\t\t\t\t\t{this.renderMoveControls(request, choices)}\n\t\t\t\t\t\t<div style=\"clear:left\"></div>\n\t\t\t\t\t\t{canDynamax && <label class={`megaevo${choices.current.max ? ' cur' : ''}`}>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"max\" checked={choices.current.max} onChange={this.toggleBoostedMove} /> {}\n\t\t\t\t\t\t\t{moveRequest.canGigantamax ? 'Gigantamax' : 'Dynamax'}\n\t\t\t\t\t\t</label>}\n\t\t\t\t\t\t{canMegaEvo && <label class={`megaevo${choices.current.mega ? ' cur' : ''}`}>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"mega\" checked={choices.current.mega} onChange={this.toggleBoostedMove} /> {}\n\t\t\t\t\t\t\tMega Evolution\n\t\t\t\t\t\t</label>}\n\t\t\t\t\t\t{moveRequest.canUltraBurst && <label class={`megaevo${choices.current.ultra ? ' cur' : ''}`}>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"ultra\" checked={choices.current.ultra} onChange={this.toggleBoostedMove} /> {}\n\t\t\t\t\t\t\tUltra Burst\n\t\t\t\t\t\t</label>}\n\t\t\t\t\t\t{canZMove && <label class={`megaevo${choices.current.z ? ' cur' : ''}`}>\n\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"z\" checked={choices.current.z} onChange={this.toggleBoostedMove} /> {}\n\t\t\t\t\t\t\tZ-Power\n\t\t\t\t\t\t</label>}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t{canShift && [\n\t\t\t\t\t\t<h3 class=\"shiftselect\">Shift</h3>,\n\t\t\t\t\t\t<button name=\"cmd\" value=\"/shift\">Move to center</button>,\n\t\t\t\t\t]}\n\t\t\t\t\t<h3 class=\"switchselect\">Switch</h3>\n\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t{this.renderSwitchControls(request, choices)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t} case 'switch': {\n\t\t\tconst pokemon = request.side.pokemon[choices.index()];\n\t\t\treturn <div class=\"controls\">\n\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t{this.renderOldChoices(request, choices)}\n\t\t\t\t\tWhat will <strong>{pokemon.name}</strong> do?\n\t\t\t\t</div>\n\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t<h3 class=\"switchselect\">Switch</h3>\n\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t{this.renderSwitchControls(request, choices)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t} case 'team': {\n\t\t\treturn <div class=\"controls\">\n\t\t\t\t<div class=\"whatdo\">\n\t\t\t\t\t<button name=\"openTimer\" class=\"button disabled timerbutton\"><i class=\"fa fa-hourglass-start\"></i> Timer</button>\n\t\t\t\t\t{choices.alreadySwitchingIn.length > 0 ?\n\t\t\t\t\t\t[<button name=\"cmd\" value=\"/cancel\" class=\"button\"><i class=\"fa fa-chevron-left\"></i> Back</button>,\n\t\t\t\t\t\t\" What about the rest of your team? \"]\n\t\t\t\t\t:\n\t\t\t\t\t\t\"How will you start the battle? \"\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t<h3 class=\"switchselect\">Choose {choices.alreadySwitchingIn.length <= 0 ? `lead` : `slot ${choices.alreadySwitchingIn.length + 1}`}</h3>\n\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t{this.renderTeamControls(request, choices)}\n\t\t\t\t\t\t<div style=\"clear:left\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"switchcontrols\">\n\t\t\t\t\t{choices.alreadySwitchingIn.length > 0 && <h3 class=\"switchselect\">Team so far</h3>}\n\t\t\t\t\t<div class=\"switchmenu\">\n\t\t\t\t\t\t{this.renderChosenTeam(request, choices)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t}}\n\t}\n\trender() {\n\t\tconst room = this.props.room;\n\n\t\treturn <PSPanelWrapper room={room}>\n\t\t\t<BattleDiv></BattleDiv>\n\t\t\t<ChatLog class=\"battle-log hasuserlist\" room={this.props.room} onClick={this.focusIfNoSelection} left={640} noSubscription>\n\t\t\t\t{}\n\t\t\t</ChatLog>\n\t\t\t<ChatTextEntry room={this.props.room} onMessage={this.send} onKey={this.onKey} left={640} />\n\t\t\t<ChatUserList room={this.props.room} left={640} minimized />\n\t\t\t<div class=\"battle-controls\" role=\"complementary\" aria-label=\"Battle Controls\" style=\"top: 370px;\">\n\t\t\t\t{this.renderControls()}\n\t\t\t</div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nPS.roomTypes['battle'] = {\n\tModel: BattleRoom,\n\tComponent: BattlePanel,\n};\nPS.roomTypes['battles'] = {\n\tModel: BattlesRoom,\n\tComponent: BattlesPanel,\n};\nPS.updateRoomTypes();\n"],"mappings":"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"}