{"version":3,"file":"client-core.js","names":["Array","prototype","indexOf","searchElement","fromIndex","i","length","includes","thing","String","startsWith","slice","endsWith","trim","replace","Object","assign","rest","arguments","source","k","create","proto","F","window","console","log","PSURL","document","location","protocol","Config","routes","client","PSSubscription","observable","listener","unsubscribe","index","subscriptions","splice","PSModel","subscribe","subscription","push","subscribeAndRun","update","PSStreamModel","updates","value","PSBackground","id","curId","attrib","changeCount","menuColors","bg","localStorage","getItem","split","set","save","bgUrl","setItem","join","bgid","host","bgs","Math","floor","random","url","title","artist","charAt","r","parseInt","g","b","hs","getHueSat","extractMenuColors","img","Image","onload","colorThief","ColorThief","colors","getPalette","color","unshift","src","max","min","l","d","s","h","body","style","background","backgroundSize","buttonStyleElem","getElementById","textContent","cssBuf","n","HTMLStyleElement","head","appendChild"],"sources":["../src/client-core.ts"],"sourcesContent":["/**\n * Client core\n *\n * No dependencies.\n * Does three unrelated things:\n * 1. sets up polyfills where necessary\n * 2. sets up PS's model base classes\n * 3. sets up the model and view for PS's backgrounds\n *\n * The background is mostly here so the new background can be loaded ASAP.\n *\n * @author Guangcong Luo <guancongluo@gmail.com>\n * @license AGPLv3\n */\n\n/**********************************************************************\n * Polyfills\n *********************************************************************/\n\nif (!Array.prototype.indexOf) {\n\tArray.prototype.indexOf = function (searchElement, fromIndex) {\n\t\tfor (let i = (fromIndex || 0); i < this.length; i++) {\n\t\t\tif (this[i] === searchElement) return i;\n\t\t}\n\t\treturn -1;\n\t};\n}\nif (!Array.prototype.includes) {\n\tArray.prototype.includes = function (thing) {\n\t\treturn this.indexOf(thing) !== -1;\n\t};\n}\nif (!String.prototype.includes) {\n\tString.prototype.includes = function (thing) {\n\t\treturn this.indexOf(thing) !== -1;\n\t};\n}\nif (!String.prototype.startsWith) {\n\tString.prototype.startsWith = function (thing) {\n\t\treturn this.slice(0, thing.length) === thing;\n\t};\n}\nif (!String.prototype.endsWith) {\n\tString.prototype.endsWith = function (thing) {\n\t\treturn this.slice(-thing.length) === thing;\n\t};\n}\nif (!String.prototype.trim) {\n\tString.prototype.trim = function () {\n\t\treturn this.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n\t};\n}\nif (!Object.assign) {\n\tObject.assign = function (thing: any, rest: any) {\n\t\tfor (let i = 1; i < arguments.length; i++) {\n\t\t\tlet source = arguments[i];\n\t\t\tfor (let k in source) {\n\t\t\t\tthing[k] = source[k];\n\t\t\t}\n\t\t}\n\t\treturn thing;\n\t};\n}\nif (!Object.create) {\n\tObject.create = function (proto: any) {\n\t\tfunction F() {}\n\t\tF.prototype = proto;\n\t\treturn new (F as any)();\n\t};\n}\nif (!window.console) {\n\t// in IE8, the console object is only defined when devtools is open\n\t// I don't actually know if this will cause problems when you open devtools,\n\t// but that's something I can figure out if I ever bother testing in IE8\n\t(window as any).console = {\n\t\tlog() {},\n\t};\n}\n\n/**********************************************************************\n * PS Models\n *********************************************************************/\n// PS's model classes are defined here\n\nconst PSURL = `${document.location!.protocol !== 'http:' ? 'https:' : ''}//${Config.routes.client}/`;\n\nclass PSSubscription {\n\tobservable: PSModel | PSStreamModel<any>;\n\tlistener: (value?: any) => void;\n\tconstructor(observable: PSModel | PSStreamModel<any>, listener: (value?: any) => void) {\n\t\tthis.observable = observable;\n\t\tthis.listener = listener;\n\t}\n\tunsubscribe() {\n\t\tconst index = this.observable.subscriptions.indexOf(this);\n\t\tif (index >= 0) this.observable.subscriptions.splice(index, 1);\n\t}\n}\n\n/**\n * PS Models roughly implement the Observable spec. Not the entire\n * spec - just the parts we use. PSModel just notifies subscribers of\n * updates - a simple model for React.\n */\nclass PSModel {\n\tsubscriptions = [] as PSSubscription[];\n\tsubscribe(listener: () => void) {\n\t\tconst subscription = new PSSubscription(this, listener);\n\t\tthis.subscriptions.push(subscription);\n\t\treturn subscription;\n\t}\n\tsubscribeAndRun(listener: () => void) {\n\t\tconst subscription = this.subscribe(listener);\n\t\tsubscription.listener();\n\t\treturn subscription;\n\t}\n\tupdate() {\n\t\tfor (const subscription of this.subscriptions) {\n\t\t\tsubscription.listener();\n\t\t}\n\t}\n}\n\n/**\n * PS Models roughly implement the Observable spec. PSStreamModel\n * streams some data out. This is very not-React, which generally\n * expects the DOM to be a pure function of state. Instead PSModels\n * which hold state, PSStreamModels give state directly to views,\n * so that the model doesn't need to hold a redundant copy of state.\n */\nclass PSStreamModel<T = string> {\n\tsubscriptions = [] as PSSubscription[];\n\tupdates = [] as T[];\n\tsubscribe(listener: (value: T) => void) {\n\t\t// TypeScript bug\n\t\tconst subscription: PSSubscription = new PSSubscription(this, listener);\n\t\tthis.subscriptions.push(subscription);\n\t\tif (this.updates.length) {\n\t\t\tfor (const update of this.updates) {\n\t\t\t\tsubscription.listener(update);\n\t\t\t}\n\t\t\tthis.updates = [];\n\t\t}\n\t\treturn subscription;\n\t}\n\tsubscribeAndRun(listener: (value: T) => void) {\n\t\tconst subscription = this.subscribe(listener);\n\t\tsubscription.listener(null);\n\t\treturn subscription;\n\t}\n\tupdate(value: T) {\n\t\tif (!this.subscriptions.length) {\n\t\t\t// save updates for later\n\t\t\tthis.updates.push(value);\n\t\t}\n\t\tfor (const subscription of this.subscriptions) {\n\t\t\tsubscription.listener(value);\n\t\t}\n\t}\n}\n\n// type JSONObject = {[k: string]: JSONValue};\n// type JSONArray = JSONValue[];\n// type JSONValue = number | string | boolean | null | JSONObject | JSONArray;\n\n/**********************************************************************\n * Background Model\n *********************************************************************/\n\ndeclare const ColorThief: any;\n\n/**\n * PS background model. Separate from PSPrefs because unlike prefs,\n * backgrounds can be set separately per server, instead of being\n * shared among all servers.\n *\n * Streams the current URL\n */\nconst PSBackground = new class extends PSStreamModel {\n\tid = '';\n\tcurId = '';\n\tattrib: {url: string, title: string, artist: string} | null = null;\n\tchangeCount = 0;\n\tmenuColors: string[] | null = null;\n\n\tconstructor() {\n\t\tsuper();\n\t\ttry {\n\t\t\tlet bg = localStorage.getItem('showdown_bg')!.split('\\n');\n\t\t\tif (bg.length === 1) {\n\t\t\t\tthis.set('', bg[0]);\n\t\t\t} else if (bg.length === 2) {\n\t\t\t\tthis.set(bg[0], bg[1]);\n\t\t\t} else if (bg.length >= 7) {\n\t\t\t\tthis.set(bg[0], bg[1], bg.slice(2));\n\t\t\t}\n\t\t} catch {}\n\t}\n\tsave(bgUrl: string) {\n\t\tif (this.id !== 'custom') {\n\t\t\tlocalStorage.setItem('showdown_bg', this.id);\n\t\t} else if (this.menuColors) {\n\t\t\tlocalStorage.setItem('showdown_bg', bgUrl + '\\n' + this.id + '\\n' + this.menuColors.join('\\n'));\n\t\t}\n\t}\n\n\tset(bgUrl: string, bgid: string, menuColors: string[] | null = null) {\n\t\t// id\n\t\tthis.id = bgid;\n\n\t\t// curid\n\t\tif (!bgid) {\n\t\t\tif (location.host === 'smogtours.psim.us') {\n\t\t\t\tbgid = 'shaymin';\n\t\t\t} else if (location.host === Config.routes.client) {\n\t\t\t\tconst bgs = ['horizon', 'ocean', 'waterfall', 'shaymin', 'charizards'];\n\t\t\t\tbgid = bgs[Math.floor(Math.random() * 5)];\n\t\t\t\tif (bgid === this.curId) bgid = bgs[Math.floor(Math.random() * 5)];\n\t\t\t}\n\t\t}\n\t\tthis.curId = bgid;\n\n\t\tif (!bgUrl) {\n\t\t\tbgUrl = (bgid === 'solidblue' ? '#344b6c' : PSURL + 'fx/client-bg-' + bgid + '.jpg');\n\t\t}\n\n\t\t// April Fool's 2016 - Digimon theme\n\t\t// bgid = 'digimon';\n\t\t// bgUrl = PSURL + 'sprites/afd/digimonbg.jpg';\n\n\t\tthis.changeCount++;\n\n\t\t// menuColors, attrib\n\t\tlet attrib = null;\n\t\tswitch (bgid) {\n\t\tcase 'horizon':\n\t\t\tmenuColors = [\n\t\t\t\t\"318.87640449438203,35.177865612648226%\",\n\t\t\t\t\"216,46.2962962962963%\",\n\t\t\t\t\"221.25,32.25806451612904%\",\n\t\t\t\t\"197.8021978021978,52.60115606936417%\",\n\t\t\t\t\"232.00000000000003,19.480519480519483%\",\n\t\t\t\t\"228.38709677419354,60.7843137254902%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://vtas.deviantart.com/art/Pokemon-Horizon-312267168',\n\t\t\t\ttitle: 'Horizon',\n\t\t\t\tartist: 'Vivian Zou',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'ocean':\n\t\t\tmenuColors = [\n\t\t\t\t\"82.8169014084507,34.63414634146342%\",\n\t\t\t\t\"216.16438356164383,29.55465587044534%\",\n\t\t\t\t\"212.92682926829266,59.42028985507245%\",\n\t\t\t\t\"209.18918918918916,57.51295336787566%\",\n\t\t\t\t\"199.2857142857143,48.275862068965495%\",\n\t\t\t\t\"213.11999999999998,55.06607929515419%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://quanyails.deviantart.com/art/Sunrise-Ocean-402667154',\n\t\t\t\ttitle: 'Sunrise Ocean',\n\t\t\t\tartist: 'Quanyails',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'waterfall':\n\t\t\tmenuColors = [\n\t\t\t\t\"119.31034482758622,37.66233766233767%\",\n\t\t\t\t\"184.36363636363635,23.012552301255226%\",\n\t\t\t\t\"108.92307692307692,37.14285714285714%\",\n\t\t\t\t\"70.34482758620689,20.567375886524818%\",\n\t\t\t\t\"98.39999999999998,36.76470588235296%\",\n\t\t\t\t\"140,38.18181818181818%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://yilx.deviantart.com/art/Irie-372292729',\n\t\t\t\ttitle: 'Irie',\n\t\t\t\tartist: 'Samuel Teo',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'shaymin':\n\t\t\tmenuColors = [\n\t\t\t\t\"39.000000000000064,21.7391304347826%\",\n\t\t\t\t\"170.00000000000003,2.380952380952378%\",\n\t\t\t\t\"157.5,11.88118811881188%\",\n\t\t\t\t\"174.78260869565216,12.041884816753928%\",\n\t\t\t\t\"185.00000000000003,12.76595744680851%\",\n\t\t\t\t\"20,5.660377358490567%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'http://cargocollective.com/bluep',\n\t\t\t\ttitle: 'Shaymin',\n\t\t\t\tartist: 'Daniel Kong',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'charizards':\n\t\t\tmenuColors = [\n\t\t\t\t\"37.159090909090914,74.57627118644066%\",\n\t\t\t\t\"10.874999999999998,70.79646017699115%\",\n\t\t\t\t\"179.51612903225808,52.10084033613446%\",\n\t\t\t\t\"20.833333333333336,36.73469387755102%\",\n\t\t\t\t\"192.3076923076923,80.41237113402063%\",\n\t\t\t\t\"210,29.629629629629633%\",\n\t\t\t];\n\t\t\tattrib = {\n\t\t\t\turl: 'https://seiryuuden.deviantart.com/art/The-Ultimate-Mega-Showdown-Charizards-414587079',\n\t\t\t\ttitle: 'Charizards',\n\t\t\t\tartist: 'Jessica Valencia',\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'digimon':\n\t\t\tmenuColors = [\n\t\t\t\t\"170.45454545454544,27.500000000000004%\",\n\t\t\t\t\"84.70588235294119,13.821138211382115%\",\n\t\t\t\t\"112.50000000000001,7.8431372549019605%\",\n\t\t\t\t\"217.82608695652175,54.761904761904766%\",\n\t\t\t\t\"0,1.6949152542372816%\",\n\t\t\t\t\"\",\n\t\t\t];\n\t\t}\n\t\tif (!menuColors && bgUrl.charAt(0) === '#') {\n\t\t\tconst r = parseInt(bgUrl.slice(1, 3), 16) / 255;\n\t\t\tconst g = parseInt(bgUrl.slice(3, 5), 16) / 255;\n\t\t\tconst b = parseInt(bgUrl.slice(5, 7), 16) / 255;\n\t\t\tconst hs = this.getHueSat(r, g, b);\n\t\t\tmenuColors = [hs, hs, hs, hs, hs, hs];\n\t\t}\n\t\tthis.attrib = attrib;\n\t\tthis.menuColors = menuColors;\n\t\tif (!menuColors) {\n\t\t\tthis.extractMenuColors(bgUrl);\n\t\t} else {\n\t\t\tthis.save(bgUrl);\n\t\t}\n\t}\n\textractMenuColors(bgUrl: string) {\n\t\tconst changeCount = this.changeCount;\n\t\t// We need the image object to load it on a canvas to detect the main color.\n\t\tconst img = new Image();\n\t\timg.onload = () => {\n\t\t\tif (changeCount === PSBackground.changeCount) return;\n\t\t\t// in case ColorThief throws from canvas,\n\t\t\t// or localStorage throws\n\t\t\ttry {\n\t\t\t\tconst colorThief = new ColorThief();\n\t\t\t\tconst colors = colorThief.getPalette(img, 5);\n\n\t\t\t\tlet menuColors = [];\n\t\t\t\tif (!colors) {\n\t\t\t\t\tmenuColors = ['0, 0%', '0, 0%', '0, 0%', '0, 0%', '0, 0%'];\n\t\t\t\t} else {\n\t\t\t\t\tfor (let i = 0; i < 5; i++) {\n\t\t\t\t\t\tconst color = colors[i];\n\t\t\t\t\t\tconst hs = PSBackground.getHueSat(color[0] / 255, color[1] / 255, color[2] / 255);\n\t\t\t\t\t\tmenuColors.unshift(hs);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.menuColors = menuColors;\n\t\t\t\tPSBackground.save(bgUrl);\n\t\t\t} catch {}\n\t\t};\n\t\timg.src = bgUrl;\n\t}\n\tgetHueSat(r: number, g: number, b: number) {\n\t\tconst max = Math.max(r, g, b);\n\t\tconst min = Math.min(r, g, b);\n\t\tif (max === min) {\n\t\t\treturn `0,0%`;\n\t\t}\n\t\tconst l = (max + min) / 2;\n\t\tconst d = max - min;\n\t\tconst s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\t\tlet h = 0;\n\t\tswitch (max) {\n\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\n\t\tcase g: h = (b - r) / d + 2; break;\n\t\tcase b: h = (r - g) / d + 4; break;\n\t\t}\n\t\th /= 6;\n\t\treturn `${h * 360},${s * 100}%`;\n\t}\n};\n\n/**********************************************************************\n * Core Views\n *********************************************************************/\n\nPSBackground.subscribe(bgUrl => {\n\tif (!PSBackground.curId) {\n\t\tdocument.body.style.background = '';\n\t\tdocument.body.style.backgroundSize = '';\n\t\tconst buttonStyleElem = document.getElementById('mainmenubuttoncolors');\n\t\tif (buttonStyleElem) buttonStyleElem.textContent = ``;\n\t\treturn;\n\t}\n\n\tif (bgUrl !== null) {\n\t\tlet background;\n\t\tif (bgUrl.charAt(0) === '#') {\n\t\t\tbackground = bgUrl;\n\t\t} else if (PSBackground.curId !== 'custom') {\n\t\t\tbackground = `#546bac url(${bgUrl}) no-repeat left center fixed`;\n\t\t} else {\n\t\t\tbackground = `#546bac url(${bgUrl}) no-repeat center center fixed`;\n\t\t}\n\t\tdocument.body.style.background = background;\n\t\tdocument.body.style.backgroundSize = 'cover';\n\t}\n\n\t// main menu button colors\n\tlet cssBuf = ``;\n\tlet n = 0;\n\tif (PSBackground.menuColors) {\n\t\tfor (const hs of PSBackground.menuColors) {\n\t\t\tn++;\n\t\t\tcssBuf += `body .button.mainmenu${n} { background: linear-gradient(to bottom,  hsl(${hs},72%),  hsl(${hs},52%)); border-color: hsl(${hs},40%); }\\n`;\n\t\t\tcssBuf += `body .button.mainmenu${n}:hover { background: linear-gradient(to bottom,  hsl(${hs},62%),  hsl(${hs},42%)); border-color: hsl(${hs},21%); }\\n`;\n\t\t\tcssBuf += `body .button.mainmenu${n}:active { background: linear-gradient(to bottom,  hsl(${hs},42%),  hsl(${hs},58%)); border-color: hsl(${hs},21%); }\\n`;\n\t\t}\n\t}\n\tlet buttonStyleElem = document.getElementById('mainmenubuttoncolors');\n\tif (!buttonStyleElem) {\n\t\tif (cssBuf) {\n\t\t\tbuttonStyleElem = new HTMLStyleElement();\n\t\t\tbuttonStyleElem.id = 'mainmenubuttoncolors';\n\t\t\tbuttonStyleElem.textContent = cssBuf;\n\t\t\tdocument.head!.appendChild(buttonStyleElem);\n\t\t}\n\t} else {\n\t\tbuttonStyleElem.textContent = cssBuf;\n\t}\n});\n// '<a href=\"https://vtas.deviantart.com/art/Pokemon-Horizon-312267168\" target=\"_blank\" class=\"subtle\">\"Horizon\" <small>background by Vivian Zou</small></a>';\n// if (attrib) attrib = '<small style=\"display:block;padding-bottom:4px\">' + attrib + '</small>';\n"],"mappings":"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"}