{"version":3,"file":"panels.js","names":["PSRouter","roomid","panelState","currentRoomid","location","pathname","slice","test","subscribeHistory","endsWith","subscribeHash","extractRoomID","url","startsWith","document","origin","length","host","PS","server","id","replace","redirects","hash","join","subscribeAndRun","room","window","addEventListener","e","possibleRoomid","history","leftRoomWidth","leftRoom","rightRoom","pushState","title","replaceState","state","split","leftRoomid","rightRoomid","router","PSRoomPanel","subscriptions","componentDidMount","props","focus","onParentEvent","push","subscribe","args","forceUpdate","receiveLine","base","setDimensions","offsetWidth","offsetHeight","componentDidUpdate","includes","componentWillUnmount","subscription","unsubscribe","chooseParentValue","value","dropdownButton","parentElem","changeEvent","Event","dispatchEvent","closePopup","render","preact","Component","PSPanelWrapper","children","style","PSMain","getPopupStyle","width","posStyle","scrollable","elem","target","className","preventDefault","stopImmediatePropagation","clickedRoom","name","getAttribute","userid","toID","addRoom","parentRoomid","containingRoomid","rightPopup","username","update","tagName","href","getRoom","leave","handleButtonClick","rooms","parentElement","popups","isTextInput","type","modifierKey","ctrlKey","altKey","metaKey","shiftKey","keyCode","arrowKeysUsed","focusLeftRoom","focusRightRoom","colorSchemeQuery","matchMedia","media","cs","prefs","theme","body","matches","key","dark","curElem","mainmenu","send","isEmptyClick","selection","getSelection","err","BattleTooltips","hideTooltip","pos","activePanel","top","right","left","display","height","bottom","RangeError","position","visibility","margin","offset","getBoundingClientRect","sourceWidth","sourceHeight","availableHeight","documentElement","clientHeight","Math","max","offsetLeft","clientWidth","availableWidth","maxWidth","renderRoom","roomType","roomTypes","Panel","renderPopup","map","SanitizedHTML","__html","BattleLog","sanitizeHTML"],"sources":["../src/panels.tsx"],"sourcesContent":["/**\n * Panels\n *\n * Main view - sets up the frame, and the generic panels.\n *\n * Also sets up most global event listeners.\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\nclass PSRouter {\n\troomid = '' as RoomID;\n\tpanelState = '';\n\tconstructor() {\n\t\tconst currentRoomid = location.pathname.slice(1);\n\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\n\t\t\tthis.subscribeHistory();\n\t\t} else if (location.pathname.endsWith('.html')) {\n\t\t\tthis.subscribeHash();\n\t\t}\n\t}\n\textractRoomID(url: string) {\n\t\tif (url.startsWith(document.location.origin)) {\n\t\t\turl = url.slice(document.location.origin.length);\n\t\t} else {\n\t\t\tif (url.startsWith('http://')) {\n\t\t\t\turl = url.slice(7);\n\t\t\t} else if (url.startsWith('https://')) {\n\t\t\t\turl = url.slice(8);\n\t\t\t}\n\t\t\tif (url.startsWith(document.location.host)) {\n\t\t\t\turl = url.slice(document.location.host.length);\n\t\t\t} else if (PS.server.id === 'showdown' && url.startsWith('play.pokemonshowdown.com')) {\n\t\t\t\turl = url.slice(24);\n\t\t\t} else if (PS.server.id === 'showdown' && url.startsWith('psim.us')) {\n\t\t\t\turl = url.slice(7);\n\t\t\t} else if (url.startsWith('replay.pokemonshowdown.com')) {\n\t\t\t\turl = url.slice(26).replace('/', '/battle-');\n\t\t\t}\n\t\t}\n\t\tif (url.startsWith('/')) url = url.slice(1);\n\n\t\tif (!/^[a-z0-9-]*$/.test(url)) return null;\n\n\t\tconst redirects = /^(appeals?|rooms?suggestions?|suggestions?|adminrequests?|bugs?|bugreports?|rules?|faq|credits?|privacy|contact|dex|insecure)$/;\n\t\tif (redirects.test(url)) return null;\n\n\t\treturn url as RoomID;\n\t}\n\tsubscribeHash() {\n\t\tif (location.hash) {\n\t\t\tconst currentRoomid = location.hash.slice(1);\n\t\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\n\t\t\t\tPS.join(currentRoomid as RoomID);\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tPS.subscribeAndRun(() => {\n\t\t\tconst roomid = PS.room.id;\n\t\t\tlocation.hash = roomid ? '#' + roomid : '';\n\t\t});\n\t\twindow.addEventListener('hashchange', e => {\n\t\t\tconst possibleRoomid = location.hash.slice(1);\n\t\t\tlet currentRoomid: RoomID | null = null;\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\n\t\t\t\tcurrentRoomid = possibleRoomid as RoomID;\n\t\t\t}\n\t\t\tif (currentRoomid !== null) {\n\t\t\t\tPS.join(currentRoomid);\n\t\t\t}\n\t\t});\n\t}\n\tsubscribeHistory() {\n\t\tconst currentRoomid = location.pathname.slice(1);\n\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\n\t\t\tPS.join(currentRoomid as RoomID);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\tif (!window.history) return;\n\t\tPS.subscribeAndRun(() => {\n\t\t\tconst room = PS.room;\n\t\t\tconst roomid = room.id;\n\t\t\tconst panelState = (PS.leftRoomWidth ?\n\t\t\t\tPS.leftRoom.id + '..' + PS.rightRoom!.id :\n\t\t\t\troomid);\n\t\t\tif (roomid === this.roomid && panelState === this.panelState) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (panelState === this.panelState) {\n\t\t\t\thistory.pushState(panelState, room.title, '/' + roomid);\n\t\t\t} else {\n\t\t\t\thistory.replaceState(panelState, room.title, '/' + roomid);\n\t\t\t}\n\t\t\tthis.roomid = roomid;\n\t\t\tthis.panelState = panelState;\n\t\t});\n\t\twindow.addEventListener('popstate', e => {\n\t\t\tconst possibleRoomid = location.pathname.slice(1);\n\t\t\tlet roomid: RoomID | null = null;\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\n\t\t\t\troomid = possibleRoomid as RoomID;\n\t\t\t}\n\t\t\tif (typeof e.state === 'string') {\n\t\t\t\tconst [leftRoomid, rightRoomid] = e.state.split('..') as RoomID[];\n\t\t\t\tPS.join(leftRoomid, 'left');\n\t\t\t\tif (rightRoomid) {\n\t\t\t\t\tPS.join(rightRoomid, 'right');\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (roomid !== null) {\n\t\t\t\tPS.join(roomid);\n\t\t\t}\n\t\t});\n\t}\n}\nPS.router = new PSRouter();\n\nclass PSRoomPanel<T extends PSRoom = PSRoom> extends preact.Component<{room: T}> {\n\tsubscriptions: PSSubscription[] = [];\n\tcomponentDidMount() {\n\t\tif (PS.room === this.props.room) this.focus();\n\t\tthis.props.room.onParentEvent = (id: string, e?: Event) => {\n\t\t\tif (id === 'focus') this.focus();\n\t\t};\n\t\tthis.subscriptions.push(this.props.room.subscribe(args => {\n\t\t\tif (!args) this.forceUpdate();\n\t\t\telse this.receiveLine(args);\n\t\t}));\n\t\tif (this.base) {\n\t\t\tthis.props.room.setDimensions(this.base.offsetWidth, this.base.offsetHeight);\n\t\t}\n\t}\n\tcomponentDidUpdate() {\n\t\tif (this.base && ['popup', 'semimodal-popup'].includes(this.props.room.location)) {\n\t\t\tthis.props.room.setDimensions(this.base.offsetWidth, this.base.offsetHeight);\n\t\t}\n\t}\n\tcomponentWillUnmount() {\n\t\tthis.props.room.onParentEvent = null;\n\t\tfor (const subscription of this.subscriptions) {\n\t\t\tsubscription.unsubscribe();\n\t\t}\n\t\tthis.subscriptions = [];\n\t}\n\treceiveLine(args: Args) {}\n\t/**\n\t * PS has \"fake select menus\", buttons that act like <select> dropdowns.\n\t * This function is used by the popups they open to change the button\n\t * values.\n\t */\n\tchooseParentValue(value: string) {\n\t\tconst dropdownButton = this.props.room.parentElem as HTMLButtonElement;\n\t\tdropdownButton.value = value;\n\t\tconst changeEvent = new Event('change');\n\t\tdropdownButton.dispatchEvent(changeEvent);\n\t\tPS.closePopup();\n\t}\n\tfocus() {}\n\trender() {\n\t\treturn <PSPanelWrapper room={this.props.room}>\n\t\t\t<div class=\"mainmessage\"><p>Loading...</p></div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nfunction PSPanelWrapper(props: {\n\troom: PSRoom, children: preact.ComponentChildren, scrollable?: boolean, width?: number | 'auto',\n}) {\n\tconst room = props.room;\n\tif (room.location === 'mini-window') {\n\t\tif (room.id === 'news') {\n\t\t\treturn <div>{props.children}</div>;\n\t\t}\n\t\treturn <div id={`room-${room.id}`} class=\"mini-window-contents ps-room-light\">{props.children}</div>;\n\t}\n\tif (room.location !== 'left' && room.location !== 'right') {\n\t\tconst style = PSMain.getPopupStyle(room, props.width);\n\t\treturn <div class=\"ps-popup\" id={`room-${room.id}`} style={style}>\n\t\t\t{props.children}\n\t\t</div>;\n\t}\n\tconst style = PSMain.posStyle(room);\n\treturn <div\n\t\tclass={'ps-room' + (room.id === '' ? '' : ' ps-room-light') + (props.scrollable ? ' scrollable' : '')}\n\t\tid={`room-${room.id}`}\n\t\tstyle={style}\n\t>\n\t\t{props.children}\n\t</div>;\n}\n\nclass PSMain extends preact.Component {\n\tconstructor() {\n\t\tsuper();\n\t\tPS.subscribe(() => this.forceUpdate());\n\n\t\twindow.addEventListener('click', e => {\n\t\t\tlet elem = e.target as HTMLElement | null;\n\t\t\tif (elem?.className === 'ps-overlay') {\n\t\t\t\tPS.closePopup();\n\t\t\t\te.preventDefault();\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet clickedRoom = null;\n\t\t\twhile (elem) {\n\t\t\t\tif (` ${elem.className} `.includes(' username ')) {\n\t\t\t\t\tconst name = elem.getAttribute('data-name');\n\t\t\t\t\tconst userid = toID(name);\n\t\t\t\t\tconst roomid = `user-${userid}` as RoomID;\n\t\t\t\t\tPS.addRoom({\n\t\t\t\t\t\tid: roomid,\n\t\t\t\t\t\tparentElem: elem,\n\t\t\t\t\t\tparentRoomid: PSMain.containingRoomid(elem),\n\t\t\t\t\t\trightPopup: elem.className === 'userbutton username',\n\t\t\t\t\t\tusername: name,\n\t\t\t\t\t});\n\t\t\t\t\tPS.update();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (elem.tagName === 'A' || elem.getAttribute('data-href')) {\n\t\t\t\t\tconst href = elem.getAttribute('data-href') || (elem as HTMLAnchorElement).href;\n\t\t\t\t\tconst roomid = PS.router.extractRoomID(href);\n\n\t\t\t\t\tif (roomid !== null) {\n\t\t\t\t\t\tif (elem.getAttribute('data-target') === 'replace') {\n\t\t\t\t\t\t\tconst room = this.getRoom(elem);\n\t\t\t\t\t\t\tif (room) PS.leave(room.id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tPS.addRoom({\n\t\t\t\t\t\t\tid: roomid,\n\t\t\t\t\t\t\tparentElem: elem,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tPS.update();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (elem.tagName === 'BUTTON') {\n\t\t\t\t\tif (this.handleButtonClick(elem as HTMLButtonElement)) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (!elem.getAttribute('type')) {\n\t\t\t\t\t\t// the spec says that buttons with no `type` attribute should be\n\t\t\t\t\t\t// submit buttons, but this is a bad default so we're going\n\t\t\t\t\t\t// to just assume they're not\n\n\t\t\t\t\t\t// don't return, to allow <a><button> to make links that look\n\t\t\t\t\t\t// like buttons\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// presumably a different part of the app is handling this button\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (elem.id.startsWith('room-')) {\n\t\t\t\t\tclickedRoom = PS.rooms[elem.id.slice(5)];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telem = elem.parentElement;\n\t\t\t}\n\t\t\tif (PS.room !== clickedRoom) {\n\t\t\t\tif (clickedRoom) PS.room = clickedRoom;\n\t\t\t\twhile (PS.popups.length && (!clickedRoom || clickedRoom.id !== PS.popups[PS.popups.length - 1])) {\n\t\t\t\t\tPS.closePopup();\n\t\t\t\t}\n\t\t\t\tPS.update();\n\t\t\t}\n\t\t});\n\n\t\twindow.addEventListener('keydown', e => {\n\t\t\tlet elem = e.target as HTMLInputElement | null;\n\t\t\tif (elem) {\n\t\t\t\tlet isTextInput = (elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA');\n\t\t\t\tif (isTextInput && ['button', 'radio', 'checkbox', 'file'].includes(elem.type)) {\n\t\t\t\t\tisTextInput = false;\n\t\t\t\t}\n\t\t\t\tif (isTextInput && elem.value) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (PS.room.onParentEvent) {\n\t\t\t\tif (PS.room.onParentEvent('keydown', e) === false) {\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet modifierKey = e.ctrlKey || e.altKey || e.metaKey || e.shiftKey;\n\t\t\tif (modifierKey) return;\n\t\t\tif (e.keyCode === 37) { // left\n\t\t\t\tPS.arrowKeysUsed = true;\n\t\t\t\tPS.focusLeftRoom();\n\t\t\t} else if (e.keyCode === 39) { // right\n\t\t\t\tPS.arrowKeysUsed = true;\n\t\t\t\tPS.focusRightRoom();\n\t\t\t}\n\t\t});\n\n\t\tconst colorSchemeQuery = window.matchMedia?.('(prefers-color-scheme: dark)');\n\t\tif (colorSchemeQuery?.media !== 'not all') {\n\t\t\tcolorSchemeQuery.addEventListener('change', function (cs) {\n\t\t\t\tif (PS.prefs.theme === 'system') document.body.className = cs.matches ? 'dark' : '';\n\t\t\t});\n\t\t}\n\n\t\tPS.prefs.subscribeAndRun(key => {\n\t\t\tif (!key || key === 'theme') {\n\t\t\t\tconst dark = PS.prefs.theme === 'dark' ||\n\t\t\t\t\t(PS.prefs.theme === 'system' && colorSchemeQuery && colorSchemeQuery.matches);\n\t\t\t\tdocument.body.className = dark ? 'dark' : '';\n\t\t\t}\n\t\t});\n\t}\n\tgetRoom(elem: HTMLElement) {\n\t\tlet curElem: HTMLElement | null = elem;\n\t\twhile (curElem) {\n\t\t\tif (curElem.id.startsWith('room-')) {\n\t\t\t\treturn PS.rooms[curElem.id.slice(5)];\n\t\t\t}\n\t\t\tcurElem = curElem.parentElement;\n\t\t}\n\t}\n\thandleButtonClick(elem: HTMLButtonElement) {\n\t\tswitch (elem.name) {\n\t\tcase 'closeRoom':\n\t\t\tPS.leave(elem.value as RoomID);\n\t\t\treturn true;\n\t\tcase 'joinRoom':\n\t\t\tPS.addRoom({\n\t\t\t\tid: elem.value as RoomID,\n\t\t\t\tparentElem: elem,\n\t\t\t});\n\t\t\tPS.update();\n\t\t\treturn true;\n\t\tcase 'send':\n\t\tcase 'cmd':\n\t\t\tconst room = this.getRoom(elem) || PS.mainmenu;\n\t\t\troom.send(elem.value, elem.name === 'send');\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tstatic containingRoomid(elem: HTMLElement) {\n\t\tlet curElem: HTMLElement | null = elem;\n\t\twhile (curElem) {\n\t\t\tif (curElem.id.startsWith('room-')) {\n\t\t\t\treturn curElem.id.slice(5) as RoomID;\n\t\t\t}\n\t\t\tcurElem = curElem.parentElement;\n\t\t}\n\t\treturn null;\n\t}\n\tstatic isEmptyClick(e: MouseEvent) {\n\t\ttry {\n\t\t\tconst selection = window.getSelection()!;\n\t\t\tif (selection.type === 'Range') return false;\n\t\t} catch (err) {}\n\t\tBattleTooltips.hideTooltip();\n\t}\n\tstatic posStyle(room: PSRoom) {\n\t\tlet pos: PanelPosition | null = null;\n\t\tif (PS.leftRoomWidth === 0) {\n\t\t\t// one panel visible\n\t\t\tif (room === PS.activePanel) pos = {top: 56};\n\t\t} else {\n\t\t\t// both panels visible\n\t\t\tif (room === PS.leftRoom) pos = {top: 56, right: PS.leftRoomWidth};\n\t\t\tif (room === PS.rightRoom) pos = {top: 56, left: PS.leftRoomWidth};\n\t\t}\n\n\t\tif (!pos) return {display: 'none'};\n\n\t\tlet top: number | null = (pos.top || 0);\n\t\tlet height: number | null = null;\n\t\tlet bottom: number | null = (pos.bottom || 0);\n\t\tif (bottom > 0 || top < 0) {\n\t\t\theight = bottom - top;\n\t\t\tif (height < 0) throw new RangeError(\"Invalid pos range\");\n\t\t\tif (top < 0) top = null;\n\t\t\telse bottom = null;\n\t\t}\n\n\t\tlet left: number | null = (pos.left || 0);\n\t\tlet width: number | null = null;\n\t\tlet right: number | null = (pos.right || 0);\n\t\tif (right > 0 || left < 0) {\n\t\t\twidth = right - left - 1;\n\t\t\tif (width < 0) throw new RangeError(\"Invalid pos range\");\n\t\t\tif (left < 0) left = null;\n\t\t\telse right = null;\n\t\t}\n\n\t\treturn {\n\t\t\tdisplay: 'block',\n\t\t\ttop: top === null ? `auto` : `${top}px`,\n\t\t\theight: height === null ? `auto` : `${height}px`,\n\t\t\tbottom: bottom === null ? `auto` : `${-bottom}px`,\n\t\t\tleft: left === null ? `auto` : `${left}px`,\n\t\t\twidth: width === null ? `auto` : `${width}px`,\n\t\t\tright: right === null ? `auto` : `${-right}px`,\n\t\t};\n\t}\n\tstatic getPopupStyle(room: PSRoom, width?: number | 'auto'): any {\n\t\tif (room.location === 'modal-popup' || !room.parentElem) {\n\t\t\treturn {width: width || 480};\n\t\t}\n\t\tif (!room.width || !room.height) {\n\t\t\treturn {\n\t\t\t\tposition: 'absolute',\n\t\t\t\tvisibility: 'hidden',\n\t\t\t\tmargin: 0,\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0,\n\t\t\t};\n\t\t}\n\t\t// nonmodal popup: should be positioned near source element\n\t\tlet style: any = {\n\t\t\tposition: 'absolute',\n\t\t\tmargin: 0,\n\t\t};\n\t\tlet offset = room.parentElem.getBoundingClientRect();\n\t\tlet sourceWidth = offset.width;\n\t\tlet sourceHeight = offset.height;\n\n\t\tlet availableHeight = document.documentElement.clientHeight;\n\t\tlet height = room.height;\n\t\twidth = width || room.width;\n\n\t\tif (room.rightPopup) {\n\n\t\t\tif (availableHeight > offset.top + height + 5 &&\n\t\t\t\t(offset.top < availableHeight * 2 / 3 || offset.top + 200 < availableHeight)) {\n\t\t\t\tstyle.top = offset.top;\n\t\t\t} else if (offset.top + sourceHeight >= height) {\n\t\t\t\tstyle.bottom = Math.max(availableHeight - offset.top - sourceHeight, 0);\n\t\t\t} else {\n\t\t\t\tstyle.top = Math.max(0, availableHeight - height);\n\t\t\t}\n\t\t\tlet offsetLeft = offset.left + sourceWidth;\n\t\t\tif (width !== 'auto' && offsetLeft + width > document.documentElement.clientWidth) {\n\t\t\t\tstyle.right = 1;\n\t\t\t} else {\n\t\t\t\tstyle.left = offsetLeft;\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tif (availableHeight > offset.top + sourceHeight + height + 5 &&\n\t\t\t\t(offset.top + sourceHeight < availableHeight * 2 / 3 || offset.top + sourceHeight + 200 < availableHeight)) {\n\t\t\t\tstyle.top = offset.top + sourceHeight;\n\t\t\t} else if (height + 5 <= offset.top) {\n\t\t\t\tstyle.bottom = Math.max(availableHeight - offset.top, 0);\n\t\t\t} else if (height + 10 < availableHeight) {\n\t\t\t\tstyle.bottom = 5;\n\t\t\t} else {\n\t\t\t\tstyle.top = 0;\n\t\t\t}\n\n\t\t\tlet availableWidth = document.documentElement.clientWidth - offset.left;\n\t\t\tif (width !== 'auto' && availableWidth < width + 10) {\n\t\t\t\tstyle.right = 10;\n\t\t\t} else {\n\t\t\t\tstyle.left = offset.left;\n\t\t\t}\n\n\t\t}\n\n\t\tif (width) style.maxWidth = width;\n\n\t\treturn style;\n\t}\n\trenderRoom(room: PSRoom) {\n\t\tconst roomType = PS.roomTypes[room.type];\n\t\tconst Panel = roomType ? roomType.Component : PSRoomPanel;\n\t\treturn <Panel key={room.id} room={room} />;\n\t}\n\trenderPopup(room: PSRoom) {\n\t\tconst roomType = PS.roomTypes[room.type];\n\t\tconst Panel = roomType ? roomType.Component : PSRoomPanel;\n\t\tif (room.location === 'popup' && room.parentElem) {\n\t\t\treturn <Panel key={room.id} room={room} />;\n\t\t}\n\t\treturn <div key={room.id} class=\"ps-overlay\">\n\t\t\t<Panel room={room} />\n\t\t</div>;\n\t}\n\trender() {\n\t\tlet rooms = [] as preact.VNode[];\n\t\tfor (const roomid in PS.rooms) {\n\t\t\tconst room = PS.rooms[roomid]!;\n\t\t\tif (room.location === 'left' || room.location === 'right') {\n\t\t\t\trooms.push(this.renderRoom(room));\n\t\t\t}\n\t\t}\n\t\treturn <div class=\"ps-frame\">\n\t\t\t<PSHeader style={{top: 0, left: 0, right: 0, height: '50px'}} />\n\t\t\t{rooms}\n\t\t\t{PS.popups.map(roomid => this.renderPopup(PS.rooms[roomid]!))}\n\t\t</div>;\n\t}\n}\n\ntype PanelPosition = {top?: number, bottom?: number, left?: number, right?: number} | null;\n\nfunction SanitizedHTML(props: {children: string}) {\n\treturn <div dangerouslySetInnerHTML={{__html: BattleLog.sanitizeHTML(props.children)}}/>;\n}\n"],"mappings":"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"}