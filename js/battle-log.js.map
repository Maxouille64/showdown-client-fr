{"version":3,"file":"battle-log.js","names":["BattleLog","elem","scene","innerElem","preemptElem","atBottom","className","battleParser","joinLeave","lastRename","perspective","onScroll","distanceFromBottom","scrollHeight","scrollTop","clientHeight","setAttribute","innerHTML","document","createElement","appendChild","BattleTextParser","onscroll","reset","destroy","add","args","kwArgs","preempt","silent","divClass","divHTML","noNotify","includes","battle","name","message","rank","charAt","ignoreSpects","ignoreOpponent","toUserid","app","user","get","window","ignore","isHighlighted","rooms","roomid","getHighlight","parseChatMessage","notifyTitle","notifyOnce","parseNameParts","group","formattedUser","isJoin","joins","leaves","element","splice","indexOf","push","buf","length","textList","escapeHTML","toID","to","from","sanitizeHTML","changeUhtml","replace","parseMessage","addDiv","unlinkChatFrom","lineCount","parseInt","hideChatFrom","title","body","addBattleMessage","wait","ruleArgs","split","h2elem","turnMessage","parseArgs","trim","startsWith","endsWith","Error","slice","curLineSection","addSpacer","addNode","line","join","parseLogMessage","list","listNoDuplicates","i","messages","map","filter","sceneMessage","node","updateScroll","el","prependDiv","childNodes","insertBefore","id","htmlSrc","forceAdd","classContains","elements","parentElement","removeChild","userid","showRevealButton","classStart","nodes","style","display","button","value","lastNode","createTextNode","unlinkNodeList","nodeList","linkList","getElementsByTagName","linkNode","parent","childNode","innerNodeList","preemptNodeList","preemptCatchup","firstChild","escapeFormat","formatid","atIndex","BattleFormats","NonBattleGames","str","jsEscapeToo","unescapeHTML","hashColor","usernameColor","colorCache","hash","Config","customcolors","MD5","H","substr","S","L","Math","floor","HSLToRGB","R","G","B","lum","HLmod","Hdist","min","abs","r","g","b","toHex","x","hex","round","toString","C","X","m","R1","G1","B1","prefs","Storage","PS","undefined","timestamp","showMe","hideme","test","colorStyle","clickableName","hlClass","isMine","mineClass","cmd","target","spaceIndex","parsedMessage","toRoomid","formatText","parts","isTrusted","options","hidelinks","hidespoiler","hidegreentext","initSanitizeHTML","tagPolicy","Object","assign","html4","ELEMENTS","marquee","blink","psicon","eflags","username","spotify","youtube","twitch","ATTRIBS","tagName","attribs","getAttrib","key","setAttrib","deleteAttrib","dataUri","targetReplace","src","location","protocol","channelId","exec","height","width","hostname","color","songId","innerWidth","videoId","time","iconType","iconValue","Dex","getPokemonIcon","getItemIcon","getTypeIcon","getCategoryIcon","html","sanitizeAttribs","urlData","scheme_","localizeTime","full","date","timezone","parsedTime","Date","toUpperCase","getTime","formattedTime","Intl","DateTimeFormat","month","day","hour","minute","format","toLocaleString","input","match","attrs","escapedUsername","sanitized","sanitizeWithPolicy","createReplayFile","room","replayid","server","registered","fragment","seekTurn","Infinity","tier","p1","p2","routes","users","stepQueue","log","client","createReplayFileHref","encodeURIComponent","btoa","unescape","interstice","whitelist","patterns","entry","RegExp","isWhitelisted","uri","pattern","getURI","root"],"sources":["../src/battle-log.ts"],"sourcesContent":["/**\n * Battle log\n *\n * An exercise in minimalism! This is a dependency of the client, which\n * requires IE9+ and uses Preact, and the replay player, which requires\n * IE7+ and uses jQuery. Therefore, this has to be compatible with IE7+\n * and use the DOM directly!\n *\n * Special thanks to PPK for QuirksMode.org, one of the few resources\n * available for how to do web development in these conditions.\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license MIT\n */\n\nimport type {BattleScene} from './battle-animations';\n\n// Caja\ndeclare const html4: any;\ndeclare const html: any;\n\n// defined in battle-log-misc\ndeclare function MD5(input: string): string;\ndeclare function formatText(input: string, isTrusted?: boolean): string;\n\nexport class BattleLog {\n\telem: HTMLDivElement;\n\tinnerElem: HTMLDivElement;\n\tscene: BattleScene | null = null;\n\tpreemptElem: HTMLDivElement = null!;\n\tatBottom = true;\n\tclassName: string;\n\tbattleParser: BattleTextParser | null = null;\n\tjoinLeave: {\n\t\tjoins: string[],\n\t\tleaves: string[],\n\t\telement: HTMLDivElement,\n\t} | null = null;\n\tlastRename: {\n\t\tfrom: string,\n\t\tto: string,\n\t\telement: HTMLDivElement,\n\t} | null = null;\n\t/**\n\t * * -1 = spectator: \"Red sent out Pikachu!\" \"Blue's Eevee used Tackle!\"\n\t * * 0 = player 1: \"Go! Pikachu!\" \"The opposing Eevee used Tackle!\"\n\t * * 1 = player 2: \"Red sent out Pikachu!\" \"Eevee used Tackle!\"\n\t */\n\tperspective: -1 | 0 | 1 = -1;\n\tconstructor(elem: HTMLDivElement, scene?: BattleScene | null, innerElem?: HTMLDivElement) {\n\t\tthis.elem = elem;\n\n\t\tif (!innerElem) {\n\t\t\telem.setAttribute('role', 'log');\n\t\t\telem.innerHTML = '';\n\t\t\tinnerElem = document.createElement('div');\n\t\t\tinnerElem.className = 'inner message-log';\n\t\t\telem.appendChild(innerElem);\n\t\t}\n\t\tthis.innerElem = innerElem;\n\n\t\tif (scene) {\n\t\t\tthis.scene = scene;\n\t\t\tconst preemptElem = document.createElement('div');\n\t\t\tpreemptElem.className = 'inner-preempt message-log';\n\t\t\telem.appendChild(preemptElem);\n\t\t\tthis.preemptElem = preemptElem;\n\t\t\tthis.battleParser = new BattleTextParser();\n\t\t}\n\n\t\tthis.className = elem.className;\n\t\telem.onscroll = this.onScroll;\n\t}\n\tonScroll = () => {\n\t\tconst distanceFromBottom = this.elem.scrollHeight - this.elem.scrollTop - this.elem.clientHeight;\n\t\tthis.atBottom = (distanceFromBottom < 30);\n\t};\n\treset() {\n\t\tthis.innerElem.innerHTML = '';\n\t\tthis.atBottom = true;\n\t}\n\tdestroy() {\n\t\tthis.elem.onscroll = null;\n\t}\n\tadd(args: Args, kwArgs?: KWArgs, preempt?: boolean) {\n\t\tif (kwArgs?.silent) return;\n\t\tlet divClass = 'chat';\n\t\tlet divHTML = '';\n\t\tlet noNotify: boolean | undefined;\n\t\tif (!['join', 'j', 'leave', 'l'].includes(args[0])) this.joinLeave = null;\n\t\tif (!['name', 'n'].includes(args[0])) this.lastRename = null;\n\t\tswitch (args[0]) {\n\t\tcase 'chat': case 'c': case 'c:':\n\t\t\tlet battle = this.scene?.battle;\n\t\t\tlet name;\n\t\t\tlet message;\n\t\t\tif (args[0] === 'c:') {\n\t\t\t\tname = args[2];\n\t\t\t\tmessage = args[3];\n\t\t\t} else {\n\t\t\t\tname = args[1];\n\t\t\t\tmessage = args[2];\n\t\t\t}\n\t\t\tlet rank = name.charAt(0);\n\t\t\tif (battle?.ignoreSpects && ' +'.includes(rank)) return;\n\t\t\tif (battle?.ignoreOpponent) {\n\t\t\t\tif ('\\u2605\\u2606'.includes(rank) && toUserid(name) !== app.user.get('userid')) return;\n\t\t\t}\n\t\t\tif (window.app?.ignore?.[toUserid(name)] && ' +\\u2605\\u2606'.includes(rank)) return;\n\t\t\tlet isHighlighted = window.app?.rooms?.[battle!.roomid].getHighlight(message);\n\t\t\t[divClass, divHTML, noNotify] = this.parseChatMessage(message, name, '', isHighlighted);\n\t\t\tif (!noNotify && isHighlighted) {\n\t\t\t\tlet notifyTitle = \"Mentioned by \" + name + \" in \" + battle!.roomid;\n\t\t\t\tapp.rooms[battle!.roomid].notifyOnce(notifyTitle, \"\\\"\" + message + \"\\\"\", 'highlight');\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase 'join': case 'j': case 'leave': case 'l': {\n\t\t\tconst user = BattleTextParser.parseNameParts(args[1]);\n\t\t\tif (battle?.ignoreSpects && ' +'.includes(user.group)) return;\n\t\t\tconst formattedUser = user.group + user.name;\n\t\t\tconst isJoin = (args[0].charAt(0) === 'j');\n\t\t\tif (!this.joinLeave) {\n\t\t\t\tthis.joinLeave = {\n\t\t\t\t\tjoins: [],\n\t\t\t\t\tleaves: [],\n\t\t\t\t\telement: document.createElement('div'),\n\t\t\t\t};\n\t\t\t\tthis.joinLeave.element.className = 'chat';\n\t\t\t}\n\n\t\t\tif (isJoin && this.joinLeave.leaves.includes(formattedUser)) {\n\t\t\t\tthis.joinLeave.leaves.splice(this.joinLeave.leaves.indexOf(formattedUser), 1);\n\t\t\t} else {\n\t\t\t\tthis.joinLeave[isJoin ? \"joins\" : \"leaves\"].push(formattedUser);\n\t\t\t}\n\n\t\t\tlet buf = '';\n\t\t\tif (this.joinLeave.joins.length) {\n\t\t\t\tbuf += `${this.textList(this.joinLeave.joins)} joined`;\n\t\t\t}\n\t\t\tif (this.joinLeave.leaves.length) {\n\t\t\t\tif (this.joinLeave.joins.length) buf += `; `;\n\t\t\t\tbuf += `${this.textList(this.joinLeave.leaves)} left`;\n\t\t\t}\n\t\t\tthis.joinLeave.element.innerHTML = `<small>${BattleLog.escapeHTML(buf)}</small>`;\n\t\t\t(preempt ? this.preemptElem : this.innerElem).appendChild(this.joinLeave.element);\n\t\t\treturn;\n\t\t}\n\n\t\tcase 'name': case 'n': {\n\t\t\tconst user = BattleTextParser.parseNameParts(args[1]);\n\t\t\tif (toID(args[2]) === toID(user.name)) return;\n\t\t\tif (!this.lastRename || toID(this.lastRename.to) !== toID(user.name)) {\n\t\t\t\tthis.lastRename = {\n\t\t\t\t\tfrom: args[2],\n\t\t\t\t\tto: '',\n\t\t\t\t\telement: document.createElement('div'),\n\t\t\t\t};\n\t\t\t\tthis.lastRename.element.className = 'chat';\n\t\t\t}\n\t\t\tthis.lastRename.to = user.group + user.name;\n\t\t\tthis.lastRename.element.innerHTML = `<small>${BattleLog.escapeHTML(this.lastRename.to)} renamed from ${BattleLog.escapeHTML(this.lastRename.from)}.</small>`;\n\t\t\t(preempt ? this.preemptElem : this.innerElem).appendChild(this.lastRename.element);\n\t\t\treturn;\n\t\t}\n\n\t\tcase 'chatmsg': case '':\n\t\t\tdivHTML = BattleLog.escapeHTML(args[1]);\n\t\t\tbreak;\n\n\t\tcase 'chatmsg-raw': case 'raw': case 'html':\n\t\t\tdivHTML = BattleLog.sanitizeHTML(args[1]);\n\t\t\tbreak;\n\n\t\tcase 'uhtml': case 'uhtmlchange':\n\t\t\tthis.changeUhtml(args[1], args[2], args[0] === 'uhtml');\n\t\t\treturn ['', ''];\n\n\t\tcase 'error': case 'inactive': case 'inactiveoff':\n\t\t\tdivClass = 'chat message-error';\n\t\t\tdivHTML = BattleLog.escapeHTML(args[1]);\n\t\t\tbreak;\n\n\t\tcase 'bigerror':\n\t\t\tthis.message('<div class=\"broadcast-red\">' + BattleLog.escapeHTML(args[1]).replace(/\\|/g, '<br />') + '</div>');\n\t\t\treturn;\n\n\t\tcase 'pm':\n\t\t\tdivHTML = '<strong>' + BattleLog.escapeHTML(args[1]) + ':</strong> <span class=\"message-pm\"><i style=\"cursor:pointer\" onclick=\"selectTab(\\'lobby\\');rooms.lobby.popupOpen(\\'' + BattleLog.escapeHTML(args[2], true) + '\\')\">(Private to ' + BattleLog.escapeHTML(args[3]) + ')</i> ' + BattleLog.parseMessage(args[4]) + '</span>';\n\t\t\tbreak;\n\n\t\tcase 'askreg':\n\t\t\tthis.addDiv('chat', '<div class=\"broadcast-blue\"><b>Register an account to protect your ladder rating!</b><br /><button name=\"register\" value=\"' + BattleLog.escapeHTML(args[1]) + '\"><b>Register</b></button></div>');\n\t\t\treturn;\n\n\t\tcase 'unlink': {\n\t\t\t// |unlink| is deprecated in favor of |hidelines|\n\t\t\tconst user = toID(args[2]) || toID(args[1]);\n\t\t\tthis.unlinkChatFrom(user);\n\t\t\tif (args[2]) {\n\t\t\t\tconst lineCount = parseInt(args[3], 10);\n\t\t\t\tthis.hideChatFrom(user, true, lineCount);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tcase 'hidelines': {\n\t\t\tconst user = toID(args[2]);\n\t\t\tthis.unlinkChatFrom(user);\n\t\t\tif (args[1] !== 'unlink') {\n\t\t\t\tconst lineCount = parseInt(args[3], 10);\n\t\t\t\tthis.hideChatFrom(user, args[1] === 'hide', lineCount);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tcase 'debug':\n\t\t\tdivClass = 'debug';\n\t\t\tdivHTML = '<div class=\"chat\"><small style=\"color:#999\">[DEBUG] ' + BattleLog.escapeHTML(args[1]) + '.</small></div>';\n\t\t\tbreak;\n\n\t\tcase 'notify':\n\t\t\tconst title = args[1];\n\t\t\tconst body = args[2];\n\t\t\tconst roomid = this.scene?.battle.roomid;\n\t\t\tif (!roomid) break;\n\t\t\tapp.rooms[roomid].notifyOnce(title, body, 'highlight');\n\t\t\tbreak;\n\n\t\tcase 'seed': case 'choice': case ':': case 'timer': case 't:':\n\t\tcase 'J': case 'L': case 'N': case 'spectator': case 'spectatorleave':\n\t\tcase 'initdone':\n\t\t\treturn;\n\n\t\tdefault:\n\t\t\tthis.addBattleMessage(args, kwArgs);\n\t\t\treturn;\n\t\t}\n\t\tif (divHTML) this.addDiv(divClass, divHTML, preempt);\n\t}\n\taddBattleMessage(args: Args, kwArgs?: KWArgs) {\n\t\tswitch (args[0]) {\n\t\tcase 'warning':\n\t\t\tthis.message('<strong>Warning:</strong> ' + BattleLog.escapeHTML(args[1]));\n\t\t\tthis.message(`Bug? Report it to <a href=\"http://www.smogon.com/forums/showthread.php?t=3453192\">the replay viewer's Smogon thread</a>`);\n\t\t\tif (this.scene) this.scene.wait(1000);\n\t\t\treturn;\n\n\t\tcase 'variation':\n\t\t\tthis.addDiv('', '<small>Variation: <em>' + BattleLog.escapeHTML(args[1]) + '</em></small>');\n\t\t\tbreak;\n\n\t\tcase 'rule':\n\t\t\tconst ruleArgs = args[1].split(': ');\n\t\t\tthis.addDiv('', '<small><em>' + BattleLog.escapeHTML(ruleArgs[0]) + (ruleArgs[1] ? ':' : '') + '</em> ' + BattleLog.escapeHTML(ruleArgs[1] || '') + '</small>');\n\t\t\tbreak;\n\n\t\tcase 'rated':\n\t\t\tthis.addDiv('rated', '<strong>' + (BattleLog.escapeHTML(args[1]) || 'Rated battle') + '</strong>');\n\t\t\tbreak;\n\n\t\tcase 'tier':\n\t\t\tthis.addDiv('', '<small>Format:</small> <br /><strong>' + BattleLog.escapeHTML(args[1]) + '</strong>');\n\t\t\tbreak;\n\n\t\tcase 'turn':\n\t\t\tconst h2elem = document.createElement('h2');\n\t\t\th2elem.className = 'battle-history';\n\t\t\tlet turnMessage;\n\t\t\tif (this.battleParser) {\n\t\t\t\tturnMessage = this.battleParser.parseArgs(args, {}).trim();\n\t\t\t\tif (!turnMessage.startsWith('==') || !turnMessage.endsWith('==')) {\n\t\t\t\t\tthrow new Error(\"Turn message must be a heading.\");\n\t\t\t\t}\n\t\t\t\tturnMessage = turnMessage.slice(2, -2).trim();\n\t\t\t\tthis.battleParser.curLineSection = 'break';\n\t\t\t} else {\n\t\t\t\tturnMessage = `Turn ${args[1]}`;\n\t\t\t}\n\t\t\th2elem.innerHTML = BattleLog.escapeHTML(turnMessage);\n\t\t\tthis.addSpacer();\n\t\t\tthis.addNode(h2elem);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tlet line = null;\n\t\t\tif (this.battleParser) {\n\t\t\t\tline = this.battleParser.parseArgs(args, kwArgs || {}, true);\n\t\t\t}\n\t\t\tif (line === null) {\n\t\t\t\tthis.addDiv('chat message-error', 'Unrecognized: |' + BattleLog.escapeHTML(args.join('|')));\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!line) return;\n\t\t\tthis.message(...this.parseLogMessage(line));\n\t\t\tbreak;\n\t\t}\n\t}\n\ttextList(list: string[]) {\n\t\tlet message = '';\n\t\tconst listNoDuplicates: string[] = [];\n\t\tfor (const user of list) {\n\t\t\tif (!listNoDuplicates.includes(user)) listNoDuplicates.push(user);\n\t\t}\n\t\tlist = listNoDuplicates;\n\n\t\tif (list.length === 1) return list[0];\n\t\tif (list.length === 2) return `${list[0]} and ${list[1]}`;\n\t\tfor (let i = 0; i < list.length - 1; i++) {\n\t\t\tif (i >= 5) {\n\t\t\t\treturn `${message}and ${list.length - 5} others`;\n\t\t\t}\n\t\t\tmessage += `${list[i]}, `;\n\t\t}\n\t\treturn `${message}and ${list[list.length - 1]}`;\n\t\treturn message;\n\t}\n\t/**\n\t * To avoid trolling with nicknames, we can't just run this through\n\t * parseMessage\n\t */\n\tparseLogMessage(message: string): [string, string] {\n\t\tconst messages = message.split('\\n').map(line => {\n\t\t\tline = BattleLog.escapeHTML(line);\n\t\t\tline = line.replace(/\\*\\*(.*)\\*\\*/, '<strong>$1</strong>');\n\t\t\tline = line.replace(/\\|\\|([^\\|]*)\\|\\|([^\\|]*)\\|\\|/, '<abbr title=\"$1\">$2</abbr>');\n\t\t\tif (line.startsWith('  ')) line = '<small>' + line.trim() + '</small>';\n\t\t\treturn line;\n\t\t});\n\t\treturn [\n\t\t\tmessages.join('<br />'),\n\t\t\tmessages.filter(line => !line.startsWith('<small>[')).join('<br />'),\n\t\t];\n\t}\n\tmessage(message: string, sceneMessage = message) {\n\t\tif (this.scene) this.scene.message(sceneMessage);\n\t\tthis.addDiv('battle-history', message);\n\t}\n\taddNode(node: HTMLElement, preempt?: boolean) {\n\t\t(preempt ? this.preemptElem : this.innerElem).appendChild(node);\n\t\tif (this.atBottom) {\n\t\t\tthis.elem.scrollTop = this.elem.scrollHeight;\n\t\t}\n\t}\n\tupdateScroll() {\n\t\tif (this.atBottom) {\n\t\t\tthis.elem.scrollTop = this.elem.scrollHeight;\n\t\t}\n\t}\n\taddDiv(className: string, innerHTML: string, preempt?: boolean) {\n\t\tconst el = document.createElement('div');\n\t\tel.className = className;\n\t\tel.innerHTML = innerHTML;\n\t\tthis.addNode(el, preempt);\n\t}\n\tprependDiv(className: string, innerHTML: string, preempt?: boolean) {\n\t\tconst el = document.createElement('div');\n\t\tel.className = className;\n\t\tel.innerHTML = innerHTML;\n\t\tif (this.innerElem.childNodes.length) {\n\t\t\tthis.innerElem.insertBefore(el, this.innerElem.childNodes[0]);\n\t\t} else {\n\t\t\tthis.innerElem.appendChild(el);\n\t\t}\n\t\tthis.updateScroll();\n\t}\n\taddSpacer() {\n\t\tthis.addDiv('spacer battle-history', '<br />');\n\t}\n\tchangeUhtml(id: string, htmlSrc: string, forceAdd?: boolean) {\n\t\tid = toID(id);\n\t\tconst classContains = ' uhtml-' + id + ' ';\n\t\tlet elements = [] as HTMLDivElement[];\n\t\tfor (const node of this.innerElem.childNodes as any) {\n\t\t\tif (node.className && (' ' + node.className + ' ').includes(classContains)) {\n\t\t\t\telements.push(node);\n\t\t\t}\n\t\t}\n\t\tif (this.preemptElem) {\n\t\t\tfor (const node of this.preemptElem.childNodes as any) {\n\t\t\t\tif (node.className && (' ' + node.className + ' ').includes(classContains)) {\n\t\t\t\t\telements.push(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (htmlSrc && elements.length && !forceAdd) {\n\t\t\tfor (const element of elements) {\n\t\t\t\telement.innerHTML = BattleLog.sanitizeHTML(htmlSrc);\n\t\t\t}\n\t\t\tthis.updateScroll();\n\t\t\treturn;\n\t\t}\n\t\tfor (const element of elements) {\n\t\t\telement.parentElement!.removeChild(element);\n\t\t}\n\t\tif (!htmlSrc) return;\n\t\tif (forceAdd) {\n\t\t\tthis.addDiv('notice uhtml-' + id, BattleLog.sanitizeHTML(htmlSrc));\n\t\t} else {\n\t\t\tthis.prependDiv('notice uhtml-' + id, BattleLog.sanitizeHTML(htmlSrc));\n\t\t}\n\t}\n\thideChatFrom(userid: ID, showRevealButton = true, lineCount = 0) {\n\t\tconst classStart = 'chat chatmessage-' + userid + ' ';\n\t\tlet nodes: HTMLElement[] = [];\n\t\tfor (const node of this.innerElem.childNodes as any as HTMLElement[]) {\n\t\t\tif (node.className && (node.className + ' ').startsWith(classStart)) {\n\t\t\t\tnodes.push(node);\n\t\t\t}\n\t\t}\n\t\tif (this.preemptElem) {\n\t\t\tfor (const node of this.preemptElem.childNodes as any as HTMLElement[]) {\n\t\t\t\tif (node.className && (node.className + ' ').startsWith(classStart)) {\n\t\t\t\t\tnodes.push(node);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (lineCount) nodes = nodes.slice(-lineCount);\n\n\t\tfor (const node of nodes) {\n\t\t\tnode.style.display = 'none';\n\t\t\tnode.className = 'revealed ' + node.className;\n\t\t}\n\t\tif (!nodes.length || !showRevealButton) return;\n\t\tconst button = document.createElement('button');\n\t\tbutton.name = 'toggleMessages';\n\t\tbutton.value = userid;\n\t\tbutton.className = 'subtle';\n\t\tbutton.innerHTML = `<small>(${nodes.length} line${nodes.length > 1 ? 's' : ''} from ${userid} hidden)</small>`;\n\t\tconst lastNode = nodes[nodes.length - 1];\n\t\tlastNode.appendChild(document.createTextNode(' '));\n\t\tlastNode.appendChild(button);\n\t}\n\n\tstatic unlinkNodeList(nodeList: ArrayLike<HTMLElement>, classStart: string) {\n\t\tfor (const node of nodeList as HTMLElement[]) {\n\t\t\tif (node.className && (node.className + ' ').startsWith(classStart)) {\n\t\t\t\tconst linkList = node.getElementsByTagName('a');\n\t\t\t\t// iterate in reverse because linkList will update as links are removed\n\t\t\t\tfor (let i = linkList.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst linkNode = linkList[i];\n\t\t\t\t\tconst parent = linkNode.parentElement;\n\t\t\t\t\tif (!parent) continue;\n\t\t\t\t\tfor (const childNode of linkNode.childNodes as any) {\n\t\t\t\t\t\tparent.insertBefore(childNode, linkNode);\n\t\t\t\t\t}\n\t\t\t\t\tparent.removeChild(linkNode);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tunlinkChatFrom(userid: ID) {\n\t\tconst classStart = 'chat chatmessage-' + userid + ' ';\n\t\tconst innerNodeList = this.innerElem.childNodes;\n\t\tBattleLog.unlinkNodeList(innerNodeList as NodeListOf<HTMLElement>, classStart);\n\n\t\tif (this.preemptElem) {\n\t\t\tconst preemptNodeList = this.preemptElem.childNodes;\n\t\t\tBattleLog.unlinkNodeList(preemptNodeList as NodeListOf<HTMLElement>, classStart);\n\t\t}\n\t}\n\n\tpreemptCatchup() {\n\t\tif (!this.preemptElem.firstChild) return;\n\t\tthis.innerElem.appendChild(this.preemptElem.firstChild);\n\t}\n\n\tstatic escapeFormat(formatid: string): string {\n\t\tlet atIndex = formatid.indexOf('@@@');\n\t\tif (atIndex >= 0) {\n\t\t\treturn this.escapeFormat(formatid.slice(0, atIndex)) +\n\t\t\t\t'<br />Custom rules: ' + this.escapeHTML(formatid.slice(atIndex + 3));\n\t\t}\n\t\tif (window.BattleFormats && BattleFormats[formatid]) {\n\t\t\treturn this.escapeHTML(BattleFormats[formatid].name);\n\t\t}\n\t\tif (window.NonBattleGames && NonBattleGames[formatid]) {\n\t\t\treturn this.escapeHTML(NonBattleGames[formatid]);\n\t\t}\n\t\treturn this.escapeHTML(formatid);\n\t}\n\n\tstatic escapeHTML(str: string, jsEscapeToo?: boolean) {\n\t\tif (typeof str !== 'string') return '';\n\t\tstr = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\t\tif (jsEscapeToo) str = str.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, '\\\\\\'');\n\t\treturn str;\n\t}\n\n\tstatic unescapeHTML(str: string) {\n\t\tstr = (str ? '' + str : '');\n\t\treturn str.replace(/&quot;/g, '\"').replace(/&gt;/g, '>').replace(/&lt;/g, '<').replace(/&amp;/g, '&');\n\t}\n\n\tstatic colorCache: {[userid: string]: string} = {};\n\n\t/** @deprecated */\n\tstatic hashColor(name: ID) {\n\t\treturn `color:${this.usernameColor(name)};`;\n\t}\n\n\tstatic usernameColor(name: ID) {\n\t\tif (this.colorCache[name]) return this.colorCache[name];\n\t\tlet hash;\n\t\tif (Config.customcolors[name]) {\n\t\t\thash = MD5(Config.customcolors[name]);\n\t\t} else {\n\t\t\thash = MD5(name);\n\t\t}\n\t\tlet H = parseInt(hash.substr(4, 4), 16) % 360; // 0 to 360\n\t\tlet S = parseInt(hash.substr(0, 4), 16) % 50 + 40; // 40 to 89\n\t\tlet L = Math.floor(parseInt(hash.substr(8, 4), 16) % 20 + 30); // 30 to 49\n\n\t\tlet {R, G, B} = this.HSLToRGB(H, S, L);\n\t\tlet lum = R * R * R * 0.2126 + G * G * G * 0.7152 + B * B * B * 0.0722; // 0.013 (dark blue) to 0.737 (yellow)\n\n\t\tlet HLmod = (lum - 0.2) * -150; // -80 (yellow) to 28 (dark blue)\n\t\tif (HLmod > 18) HLmod = (HLmod - 18) * 2.5;\n\t\telse if (HLmod < 0) HLmod = (HLmod - 0) / 3;\n\t\telse HLmod = 0;\n\t\t// let mod = ';border-right: ' + Math.abs(HLmod) + 'px solid ' + (HLmod > 0 ? 'red' : '#0088FF');\n\t\tlet Hdist = Math.min(Math.abs(180 - H), Math.abs(240 - H));\n\t\tif (Hdist < 15) {\n\t\t\tHLmod += (15 - Hdist) / 3;\n\t\t}\n\n\t\tL += HLmod;\n\n\t\tlet {R: r, G: g, B: b} = this.HSLToRGB(H, S, L);\n\t\tconst toHex = (x: number) => {\n\t\t\tconst hex = Math.round(x * 255).toString(16);\n\t\t\treturn hex.length === 1 ? '0' + hex : hex;\n\t\t};\n\t\tthis.colorCache[name] = `#${toHex(r)}${toHex(g)}${toHex(b)}`;\n\t\treturn this.colorCache[name];\n\t}\n\n\tstatic HSLToRGB(H: number, S: number, L: number) {\n\t\tlet C = (100 - Math.abs(2 * L - 100)) * S / 100 / 100;\n\t\tlet X = C * (1 - Math.abs((H / 60) % 2 - 1));\n\t\tlet m = L / 100 - C / 2;\n\n\t\tlet R1;\n\t\tlet G1;\n\t\tlet B1;\n\t\tswitch (Math.floor(H / 60)) {\n\t\tcase 1: R1 = X; G1 = C; B1 = 0; break;\n\t\tcase 2: R1 = 0; G1 = C; B1 = X; break;\n\t\tcase 3: R1 = 0; G1 = X; B1 = C; break;\n\t\tcase 4: R1 = X; G1 = 0; B1 = C; break;\n\t\tcase 5: R1 = C; G1 = 0; B1 = X; break;\n\t\tcase 0: default: R1 = C; G1 = X; B1 = 0; break;\n\t\t}\n\t\tlet R = R1 + m;\n\t\tlet G = G1 + m;\n\t\tlet B = B1 + m;\n\t\treturn {R, G, B};\n\t}\n\n\tstatic prefs(name: string) {\n\t\t// @ts-ignore\n\t\tif (window.Storage?.prefs) return Storage.prefs(name);\n\t\t// @ts-ignore\n\t\tif (window.PS) return PS.prefs[name];\n\t\treturn undefined;\n\t}\n\n\tparseChatMessage(\n\t\tmessage: string, name: string, timestamp: string, isHighlighted?: boolean\n\t): [string, string, boolean?] {\n\t\tlet showMe = !BattleLog.prefs('chatformatting')?.hideme;\n\t\tlet group = ' ';\n\t\tif (!/[A-Za-z0-9]/.test(name.charAt(0))) {\n\t\t\t// Backwards compatibility\n\t\t\tgroup = name.charAt(0);\n\t\t\tname = name.substr(1);\n\t\t}\n\t\tconst colorStyle = ` style=\"color:${BattleLog.usernameColor(toID(name))}\"`;\n\t\tconst clickableName = `<small>${BattleLog.escapeHTML(group)}</small><span class=\"username\" data-name=\"${BattleLog.escapeHTML(name)}\">${BattleLog.escapeHTML(name)}</span>`;\n\t\tlet hlClass = isHighlighted ? ' highlighted' : '';\n\t\tlet isMine = (window.app?.user?.get('name') === name) || (window.PS?.user.name === name);\n\t\tlet mineClass = isMine ? ' mine' : '';\n\n\t\tlet cmd = '';\n\t\tlet target = '';\n\t\tif (message.charAt(0) === '/') {\n\t\t\tif (message.charAt(1) === '/') {\n\t\t\t\tmessage = message.slice(1);\n\t\t\t} else {\n\t\t\t\tlet spaceIndex = message.indexOf(' ');\n\t\t\t\tcmd = (spaceIndex >= 0 ? message.slice(1, spaceIndex) : message.slice(1));\n\t\t\t\tif (spaceIndex >= 0) target = message.slice(spaceIndex + 1);\n\t\t\t}\n\t\t}\n\n\t\tswitch (cmd) {\n\t\tcase 'me':\n\t\tcase 'mee':\n\t\t\tlet parsedMessage = BattleLog.parseMessage(' ' + target);\n\t\t\tif (cmd === 'mee') parsedMessage = parsedMessage.slice(1);\n\t\t\tif (!showMe) {\n\t\t\t\treturn [\n\t\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\n\t\t\t\t\t`${timestamp}<strong${colorStyle}>${clickableName}:</strong> <em>/me${parsedMessage}</em>`,\n\t\t\t\t];\n\t\t\t}\n\t\t\treturn [\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\n\t\t\t\t`${timestamp}<em><i><strong${colorStyle}>&bull; ${clickableName}</strong>${parsedMessage}</i></em>`,\n\t\t\t];\n\t\tcase 'invite':\n\t\t\tlet roomid = toRoomid(target);\n\t\t\treturn [\n\t\t\t\t'chat',\n\t\t\t\t`${timestamp}<em>${clickableName} invited you to join the room \"${roomid}\"</em>' +\n\t\t\t\t'<div class=\"notice\"><button name=\"joinRoom\" value=\"${roomid}\">Join ${roomid}</button></div>`,\n\t\t\t];\n\t\tcase 'announce':\n\t\t\treturn [\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\n\t\t\t\t`${timestamp}<strong${colorStyle}>${clickableName}:</strong> <span class=\"message-announce\">${BattleLog.parseMessage(target)}</span>`,\n\t\t\t];\n\t\tcase 'log':\n\t\t\treturn [\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\n\t\t\t\t`${timestamp}<span class=\"message-log\">${BattleLog.parseMessage(target)}</span>`,\n\t\t\t];\n\t\tcase 'data-pokemon':\n\t\tcase 'data-item':\n\t\tcase 'data-ability':\n\t\tcase 'data-move':\n\t\t\treturn ['chat message-error', '[outdated code no longer supported]'];\n\t\tcase 'text':\n\t\t\treturn ['chat', BattleLog.parseMessage(target)];\n\t\tcase 'error':\n\t\t\treturn ['chat message-error', formatText(target, true)];\n\t\tcase 'html':\n\t\t\treturn [\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\n\t\t\t\t`${timestamp}<strong${colorStyle}>${clickableName}:</strong> <em>${BattleLog.sanitizeHTML(target)}</em>`,\n\t\t\t];\n\t\tcase 'uhtml':\n\t\tcase 'uhtmlchange':\n\t\t\tlet parts = target.split(',');\n\t\t\tlet htmlSrc = parts.slice(1).join(',').trim();\n\t\t\tthis.changeUhtml(parts[0], htmlSrc, cmd === 'uhtml');\n\t\t\treturn ['', ''];\n\t\tcase 'raw':\n\t\t\treturn ['chat', BattleLog.sanitizeHTML(target)];\n\t\tcase 'nonotify':\n\t\t\treturn ['chat', BattleLog.sanitizeHTML(target), true];\n\t\tdefault:\n\t\t\t// Not a command or unsupported. Parsed as a normal chat message.\n\t\t\tif (!name) {\n\t\t\t\treturn [\n\t\t\t\t\t'chat' + hlClass,\n\t\t\t\t\t`${timestamp}<em>${BattleLog.parseMessage(message)}</em>`,\n\t\t\t\t];\n\t\t\t}\n\t\t\treturn [\n\t\t\t\t'chat chatmessage-' + toID(name) + hlClass + mineClass,\n\t\t\t\t`${timestamp}<strong${colorStyle}>${clickableName}:</strong> <em>${BattleLog.parseMessage(message)}</em>`,\n\t\t\t];\n\t\t}\n\t}\n\n\tstatic parseMessage(str: string, isTrusted = false) {\n\t\t// Don't format console commands (>>).\n\t\tif (str.substr(0, 3) === '>> ' || str.substr(0, 4) === '>>> ') return this.escapeHTML(str);\n\t\t// Don't format console results (<<).\n\t\tif (str.substr(0, 3) === '<< ') return this.escapeHTML(str);\n\t\tstr = formatText(str, isTrusted);\n\n\t\tlet options = BattleLog.prefs('chatformatting') || {};\n\n\t\tif (options.hidelinks) {\n\t\t\tstr = str.replace(/<a[^>]*>/g, '<u>').replace(/<\\/a>/g, '</u>');\n\t\t}\n\t\tif (options.hidespoiler) {\n\t\t\tstr = str.replace(/<span class=\"spoiler\">/g, '<span class=\"spoiler spoiler-shown\">');\n\t\t}\n\t\tif (options.hidegreentext) {\n\t\t\tstr = str.replace(/<span class=\"greentext\">/g, '<span>');\n\t\t}\n\n\t\treturn str;\n\t}\n\n\tstatic interstice = (() => {\n\t\tconst whitelist: string[] = Config.whitelist;\n\t\tconst patterns = whitelist.map(entry => new RegExp(\n\t\t\t`^(https?:)?//([A-Za-z0-9-]*\\\\.)?${entry.replace(/\\./g, '\\\\.')}(/.*)?`,\n\t\t'i'));\n\t\treturn {\n\t\t\tisWhitelisted(uri: string) {\n\t\t\t\tif (uri[0] === '/' && uri[1] !== '/') {\n\t\t\t\t\t// domain-relative URIs are safe\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tfor (const pattern of patterns) {\n\t\t\t\t\tif (pattern.test(uri)) return true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tgetURI(uri: string) {\n\t\t\t\treturn `http://${Config.routes.root}/interstice?uri=${encodeURIComponent(uri)}`;\n\t\t\t},\n\t\t};\n\t})();\n\n\tstatic tagPolicy: ((tagName: string, attribs: string[]) => any) | null = null;\n\tstatic initSanitizeHTML() {\n\t\tif (this.tagPolicy) return;\n\t\tif (!('html4' in window)) {\n\t\t\tthrow new Error('sanitizeHTML requires caja');\n\t\t}\n\n\t\t// By default, Caja will ban any HTML tags it doesn't recognize.\n\t\t// Additional HTML tags to allow:\n\t\tObject.assign(html4.ELEMENTS, {\n\t\t\tmarquee: 0,\n\t\t\tblink: 0,\n\t\t\tpsicon: html4.eflags['OPTIONAL_ENDTAG'] | html4.eflags['EMPTY'],\n\t\t\tusername: 0,\n\t\t\tspotify: 0,\n\t\t\tyoutube: 0,\n\t\t\ttwitch: 0,\n\t\t});\n\n\t\t// By default, Caja will ban any attributes it doesn't recognize.\n\t\t// Additional attributes to allow:\n\t\tObject.assign(html4.ATTRIBS, {\n\t\t\t// See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/marquee\n\t\t\t'marquee::behavior': 0,\n\t\t\t'marquee::bgcolor': 0,\n\t\t\t'marquee::direction': 0,\n\t\t\t'marquee::height': 0,\n\t\t\t'marquee::hspace': 0,\n\t\t\t'marquee::loop': 0,\n\t\t\t'marquee::scrollamount': 0,\n\t\t\t'marquee::scrolldelay': 0,\n\t\t\t'marquee::truespeed': 0,\n\t\t\t'marquee::vspace': 0,\n\t\t\t'marquee::width': 0,\n\t\t\t'psicon::pokemon': 0,\n\t\t\t'psicon::item': 0,\n\t\t\t'psicon::type': 0,\n\t\t\t'psicon::category': 0,\n\t\t\t'username::name': 0,\n\t\t\t'form::data-submitsend': 0,\n\t\t\t'div::data-server': 0,\n\t\t\t'button::data-send': 0,\n\t\t\t'form::data-delimiter': 0,\n\t\t\t'button::data-delimiter': 0,\n\t\t\t'*::aria-label': 0,\n\t\t\t'*::aria-hidden': 0,\n\t\t});\n\n\t\t// Caja unfortunately doesn't document how `tagPolicy` works, so\n\t\t// here's how it goes:\n\n\t\t// Every opening tag and attributes is filtered through\n\t\t// `tagPolicy`, being replaced by the {tagName, attribs} returned.\n\t\t// Returning `undefined` means that the tag will be removed entirely.\n\n\t\t// We run Caja's built-in tag sanitization in the first line of our\n\t\t// custom tagPolicy, and its attribs sanitization midway through, with\n\t\t// `sanitizeAttribs`.\n\n\t\t// (n.b. tag contents etc can't be modified in this step.)\n\n\t\t/**\n\t\t * @param tagName Lowercase tag name\n\t\t * @param attribs attribs in the form of [key, value, key, value]\n\t\t * @return undefined to remove the tag\n\t\t */\n\t\tthis.tagPolicy = (tagName: string, attribs: string[]) => {\n\t\t\tif (html4.ELEMENTS[tagName] & html4.eflags['UNSAFE']) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfunction getAttrib(key: string) {\n\t\t\t\tfor (let i = 0; i < attribs.length - 1; i += 2) {\n\t\t\t\t\tif (attribs[i] === key) {\n\t\t\t\t\t\treturn attribs[i + 1];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\tfunction setAttrib(key: string, value: string) {\n\t\t\t\tfor (let i = 0; i < attribs.length - 1; i += 2) {\n\t\t\t\t\tif (attribs[i] === key) {\n\t\t\t\t\t\tattribs[i + 1] = value;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tattribs.push(key, value);\n\t\t\t}\n\t\t\tfunction deleteAttrib(key: string) {\n\t\t\t\tfor (let i = 0; i < attribs.length - 1; i += 2) {\n\t\t\t\t\tif (attribs[i] === key) {\n\t\t\t\t\t\tattribs.splice(i, 2);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet dataUri = '';\n\t\t\tlet targetReplace = false;\n\n\t\t\tif (tagName === 'a') {\n\t\t\t\tif (getAttrib('target') === 'replace') {\n\t\t\t\t\ttargetReplace = true;\n\t\t\t\t}\n\t\t\t} else if (tagName === 'img') {\n\t\t\t\tconst src = getAttrib('src') || '';\n\t\t\t\tif (src.startsWith('data:image/')) {\n\t\t\t\t\tdataUri = src;\n\t\t\t\t}\n\t\t\t\tif (src.startsWith('//')) {\n\t\t\t\t\tif (location.protocol !== 'http:' && location.protocol !== 'https:') {\n\t\t\t\t\t\t// in testclient with `file://`, fix src so it still works\n\t\t\t\t\t\tsetAttrib('src', 'https:' + src);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (tagName === 'twitch') {\n\t\t\t\t// <iframe src=\"https://player.twitch.tv/?channel=ninja&parent=www.example.com\" allowfullscreen=\"true\" height=\"378\" width=\"620\"></iframe>\n\t\t\t\tconst src = getAttrib('src') || \"\";\n\t\t\t\tconst channelId = /(https?:\\/\\/)?twitch.tv\\/([A-Za-z0-9]+)/i.exec(src)?.[2];\n\t\t\t\tconst height = parseInt(getAttrib('height') || \"\", 10) || 400;\n\t\t\t\tconst width = parseInt(getAttrib('width') || \"\", 10) || 340;\n\t\t\t\treturn {\n\t\t\t\t\ttagName: 'iframe',\n\t\t\t\t\tattribs: [\n\t\t\t\t\t\t'src', `https://player.twitch.tv/?channel=${channelId}&parent=${location.hostname}&autoplay=false`,\n\t\t\t\t\t\t'allowfullscreen', 'true', 'height', `${height}`, 'width', `${width}`,\n\t\t\t\t\t],\n\t\t\t\t};\n\t\t\t} else if (tagName === 'username') {\n\t\t\t\t// <username> is a custom element that handles namecolors\n\t\t\t\ttagName = 'strong';\n\t\t\t\tconst color = this.usernameColor(toID(getAttrib('name')));\n\t\t\t\tconst style = getAttrib('style');\n\t\t\t\tsetAttrib('style', `${style};color:${color}`);\n\t\t\t} else if (tagName === 'spotify') {\n\t\t\t\t// <iframe src=\"https://open.spotify.com/embed/track/6aSYnCIwcLpnDXngGKAEzZ\" width=\"300\" height=\"380\" frameborder=\"0\" allowtransparency=\"true\" allow=\"encrypted-media\"></iframe>\n\t\t\t\tconst src = getAttrib('src') || '';\n\t\t\t\tconst songId = /(?:\\?v=|\\/track\\/)([A-Za-z0-9]+)/.exec(src)?.[1];\n\n\t\t\t\treturn {\n\t\t\t\t\ttagName: 'iframe',\n\t\t\t\t\tattribs: ['src', `https://open.spotify.com/embed/track/${songId}`, 'width', '300', 'height', '380', 'frameborder', '0', 'allowtransparency', 'true', 'allow', 'encrypted-media'],\n\t\t\t\t};\n\t\t\t} else if (tagName === 'youtube') {\n\t\t\t\t// <iframe width=\"320\" height=\"180\" src=\"https://www.youtube.com/embed/dQw4w9WgXcQ\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n\n\t\t\t\tconst src = getAttrib('src') || '';\n\t\t\t\t// Google's ToS requires a minimum of 200x200\n\t\t\t\tlet width = '320';\n\t\t\t\tlet height = '200';\n\t\t\t\tif (window.innerWidth >= 400) {\n\t\t\t\t\twidth = '400';\n\t\t\t\t\theight = '225';\n\t\t\t\t}\n\t\t\t\tconst videoId = /(?:\\?v=|\\/embed\\/)([A-Za-z0-9_\\-]+)/.exec(src)?.[1];\n\t\t\t\tif (!videoId) return {tagName: 'img', attribs: ['alt', `invalid src for <youtube>`]};\n\n\t\t\t\tconst time = /(?:\\?|&)(?:t|start)=([0-9]+)/.exec(src)?.[1];\n\n\t\t\t\treturn {\n\t\t\t\t\ttagName: 'iframe',\n\t\t\t\t\tattribs: [\n\t\t\t\t\t\t'width', width, 'height', height,\n\t\t\t\t\t\t'src', `https://www.youtube.com/embed/${videoId}${time ? `?start=${time}` : ''}`,\n\t\t\t\t\t\t'frameborder', '0', 'allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture', 'allowfullscreen', 'allowfullscreen',\n\t\t\t\t\t],\n\t\t\t\t};\n\t\t\t} else if (tagName === 'psicon') {\n\t\t\t\t// <psicon> is a custom element which supports a set of mutually incompatible attributes:\n\t\t\t\t// <psicon pokemon> and <psicon item>\n\t\t\t\tlet iconType = null;\n\t\t\t\tlet iconValue = null;\n\t\t\t\tfor (let i = 0; i < attribs.length - 1; i += 2) {\n\t\t\t\t\tif (attribs[i] === 'pokemon' || attribs[i] === 'item' || attribs[i] === 'type' || attribs[i] === 'category') {\n\t\t\t\t\t\t[iconType, iconValue] = attribs.slice(i, i + 2);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\ttagName = 'span';\n\n\t\t\t\tif (iconType) {\n\t\t\t\t\tconst className = getAttrib('class');\n\t\t\t\t\tconst style = getAttrib('style');\n\n\t\t\t\t\tif (iconType === 'pokemon') {\n\t\t\t\t\t\tsetAttrib('class', 'picon' + (className ? ' ' + className : ''));\n\t\t\t\t\t\tsetAttrib('style', Dex.getPokemonIcon(iconValue) + (style ? '; ' + style : ''));\n\t\t\t\t\t} else if (iconType === 'item') {\n\t\t\t\t\t\tsetAttrib('class', 'itemicon' + (className ? ' ' + className : ''));\n\t\t\t\t\t\tsetAttrib('style', Dex.getItemIcon(iconValue) + (style ? '; ' + style : ''));\n\t\t\t\t\t} else if (iconType === 'type') {\n\t\t\t\t\t\ttagName = Dex.getTypeIcon(iconValue).slice(1, -3);\n\t\t\t\t\t} else if (iconType === 'category') {\n\t\t\t\t\t\ttagName = Dex.getCategoryIcon(iconValue).slice(1, -3);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tattribs = html.sanitizeAttribs(tagName, attribs, (urlData: any) => {\n\t\t\t\tif (urlData.scheme_ === 'geo' || urlData.scheme_ === 'sms' || urlData.scheme_ === 'tel') return null;\n\t\t\t\treturn urlData;\n\t\t\t});\n\n\t\t\tif (dataUri && tagName === 'img') {\n\t\t\t\tsetAttrib('src', dataUri);\n\t\t\t}\n\t\t\tif (tagName === 'a' || (tagName === 'form' && !getAttrib('data-submitsend'))) {\n\t\t\t\tif (targetReplace) {\n\t\t\t\t\tsetAttrib('data-target', 'replace');\n\t\t\t\t\tdeleteAttrib('target');\n\t\t\t\t} else {\n\t\t\t\t\tsetAttrib('target', '_blank');\n\t\t\t\t}\n\t\t\t\tif (tagName === 'a') {\n\t\t\t\t\tsetAttrib('rel', 'noopener');\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {tagName, attribs};\n\t\t};\n\t}\n\tstatic localizeTime(full: string, date: string, time: string, timezone?: string) {\n\t\tlet parsedTime = new Date(date + 'T' + time + (timezone || 'Z').toUpperCase());\n\t\t// Very old (pre-ES5) web browsers may be incapable of parsing ISO 8601\n\t\t// dates. In such a case, gracefully continue without replacing the date\n\t\t// format.\n\t\tif (!parsedTime.getTime()) return full;\n\n\t\tlet formattedTime;\n\t\t// Try using Intl API if it exists\n\t\tif ((window as any).Intl?.DateTimeFormat) {\n\t\t\tformattedTime = new Intl.DateTimeFormat(undefined, {\n\t\t\t\tmonth: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric',\n\t\t\t}).format(parsedTime);\n\t\t} else {\n\t\t\t// toLocaleString even exists in ECMAScript 1, so no need to check\n\t\t\t// if it exists.\n\t\t\tformattedTime = parsedTime.toLocaleString();\n\t\t}\n\t\treturn '<time>' + BattleLog.escapeHTML(formattedTime) + '</time>';\n\t}\n\tstatic sanitizeHTML(input: string) {\n\t\tif (typeof input !== 'string') return '';\n\n\t\tthis.initSanitizeHTML();\n\n\t\tinput = input.replace(/<username([^>]*)>([^<]*)<\\/username>/gi, (match, attrs, username) => {\n\t\t\tif (/\\bname\\s*=\\s*\"/.test(attrs)) return match;\n\t\t\tconst escapedUsername = username.replace(/\"/g, '&quot;').replace(/>/g, '&gt;');\n\t\t\treturn `<username${attrs} name=\"${escapedUsername}\">${username}</username>`;\n\t\t});\n\n\t\t// Our custom element support happens in `tagPolicy`, which is set\n\t\t// up in `initSanitizeHTML` above.\n\t\tconst sanitized = html.sanitizeWithPolicy(input, this.tagPolicy) as string;\n\n\t\t// <time> parsing requires ISO 8601 time. While more time formats are\n\t\t// supported by most JavaScript implementations, it isn't required, and\n\t\t// how to exactly enforce ignoring user agent timezone setting is not obvious.\n\t\t// As dates come from the server which isn't aware of client timezone, a\n\t\t// particular timezone is required.\n\t\t//\n\t\t// This regular expression is split into three groups.\n\t\t//\n\t\t// Group 1 - date\n\t\t// Group 2 - time (seconds and milliseconds are optional)\n\t\t// Group 3 - optional timezone\n\t\t//\n\t\t// Group 1 and group 2 are split to allow using space as a separator\n\t\t// instead of T. Stricly speaking ECMAScript 5 specification only\n\t\t// allows T, however it's more practical to also allow spaces.\n\t\treturn sanitized.replace(\n\t\t\t/<time>\\s*([+-]?\\d{4,}-\\d{2}-\\d{2})[T ](\\d{2}:\\d{2}(?::\\d{2}(?:\\.\\d{3})?)?)(Z|[+-]\\d{2}:\\d{2})?\\s*<\\/time>/ig,\n\t\tthis.localizeTime);\n\t}\n\n\t/*********************************************************\n\t * Replay files\n\t *********************************************************/\n\n\t// Replay files are .html files that display a replay for a battle.\n\n\t// The .html files mainly contain replay log data; the actual replay\n\t// player is downloaded online. Also included is a textual log and\n\t// some minimal CSS to make it look pretty, for offline viewing.\n\n\t// This strategy helps keep the replay file reasonably small; of\n\t// the 30 KB or so for a 50-turn battle, around 10 KB is the log\n\t// data, and around 20 KB is the textual log.\n\n\t// The actual replay player is downloaded from replay-embed.js,\n\t// which handles loading all the necessary resources for turning the log\n\t// data into a playable replay.\n\n\t// Battle log data is stored in and loaded from a\n\t// <script type=\"text/plain\" class=\"battle-log-data\"> tag.\n\n\t// replay-embed.js is loaded through a cache-buster that rotates daily.\n\t// This allows pretty much anything about the replay viewer to be\n\t// updated as desired.\n\n\tstatic createReplayFile(room: any) {\n\t\tlet battle = room.battle;\n\t\tlet replayid = room.id;\n\t\tif (replayid) {\n\t\t\t// battle room\n\t\t\treplayid = replayid.slice(7);\n\t\t\tif (Config.server.id !== 'showdown') {\n\t\t\t\tif (!Config.server.registered) {\n\t\t\t\t\treplayid = 'unregisteredserver-' + replayid;\n\t\t\t\t} else {\n\t\t\t\t\treplayid = Config.server.id + '-' + replayid;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// replay panel\n\t\t\treplayid = room.fragment;\n\t\t}\n\t\tbattle.seekTurn(Infinity);\n\t\tlet buf = '<!DOCTYPE html>\\n';\n\t\tbuf += '<meta charset=\"utf-8\" />\\n';\n\t\tbuf += '<!-- version 1 -->\\n';\n\t\tbuf += `<title>${BattleLog.escapeHTML(battle.tier)} replay: ${BattleLog.escapeHTML(battle.p1.name)} vs. ${BattleLog.escapeHTML(battle.p2.name)}</title>\\n`;\n\t\tbuf += '<style>\\n';\n\t\tbuf += 'html,body {font-family:Verdana, sans-serif;font-size:10pt;margin:0;padding:0;}body{padding:12px 0;} .battle-log {font-family:Verdana, sans-serif;font-size:10pt;} .battle-log-inline {border:1px solid #AAAAAA;background:#EEF2F5;color:black;max-width:640px;margin:0 auto 80px;padding-bottom:5px;} .battle-log .inner {padding:4px 8px 0px 8px;} .battle-log .inner-preempt {padding:0 8px 4px 8px;} .battle-log .inner-after {margin-top:0.5em;} .battle-log h2 {margin:0.5em -8px;padding:4px 8px;border:1px solid #AAAAAA;background:#E0E7EA;border-left:0;border-right:0;font-family:Verdana, sans-serif;font-size:13pt;} .battle-log .chat {vertical-align:middle;padding:3px 0 3px 0;font-size:8pt;} .battle-log .chat strong {color:#40576A;} .battle-log .chat em {padding:1px 4px 1px 3px;color:#000000;font-style:normal;} .chat.mine {background:rgba(0,0,0,0.05);margin-left:-8px;margin-right:-8px;padding-left:8px;padding-right:8px;} .spoiler {color:#BBBBBB;background:#BBBBBB;padding:0px 3px;} .spoiler:hover, .spoiler:active, .spoiler-shown {color:#000000;background:#E2E2E2;padding:0px 3px;} .spoiler a {color:#BBBBBB;} .spoiler:hover a, .spoiler:active a, .spoiler-shown a {color:#2288CC;} .chat code, .chat .spoiler:hover code, .chat .spoiler:active code, .chat .spoiler-shown code {border:1px solid #C0C0C0;background:#EEEEEE;color:black;padding:0 2px;} .chat .spoiler code {border:1px solid #CCCCCC;background:#CCCCCC;color:#CCCCCC;} .battle-log .rated {padding:3px 4px;} .battle-log .rated strong {color:white;background:#89A;padding:1px 4px;border-radius:4px;} .spacer {margin-top:0.5em;} .message-announce {background:#6688AA;color:white;padding:1px 4px 2px;} .message-announce a, .broadcast-green a, .broadcast-blue a, .broadcast-red a {color:#DDEEFF;} .broadcast-green {background-color:#559955;color:white;padding:2px 4px;} .broadcast-blue {background-color:#6688AA;color:white;padding:2px 4px;} .infobox {border:1px solid #6688AA;padding:2px 4px;} .infobox-limited {max-height:200px;overflow:auto;overflow-x:hidden;} .broadcast-red {background-color:#AA5544;color:white;padding:2px 4px;} .message-learn-canlearn {font-weight:bold;color:#228822;text-decoration:underline;} .message-learn-cannotlearn {font-weight:bold;color:#CC2222;text-decoration:underline;} .message-effect-weak {font-weight:bold;color:#CC2222;} .message-effect-resist {font-weight:bold;color:#6688AA;} .message-effect-immune {font-weight:bold;color:#666666;} .message-learn-list {margin-top:0;margin-bottom:0;} .message-throttle-notice, .message-error {color:#992222;} .message-overflow, .chat small.message-overflow {font-size:0pt;} .message-overflow::before {font-size:9pt;content:\\'...\\';} .subtle {color:#3A4A66;}\\n';\n\t\tbuf += '</style>\\n';\n\t\tbuf += '<div class=\"wrapper replay-wrapper\" style=\"max-width:1180px;margin:0 auto\">\\n';\n\t\tbuf += '<input type=\"hidden\" name=\"replayid\" value=\"' + replayid + '\" />\\n';\n\t\tbuf += '<div class=\"battle\"></div><div class=\"battle-log\"></div><div class=\"replay-controls\"></div><div class=\"replay-controls-2\"></div>\\n';\n\t\tbuf += `<h1 style=\"font-weight:normal;text-align:center\"><strong>${BattleLog.escapeHTML(battle.tier)}</strong><br /><a href=\"http://${Config.routes.users}/${toID(battle.p1.name)}\" class=\"subtle\" target=\"_blank\">${BattleLog.escapeHTML(battle.p1.name)}</a> vs. <a href=\"http://${Config.routes.users}/${toID(battle.p2.name)}\" class=\"subtle\" target=\"_blank\">${BattleLog.escapeHTML(battle.p2.name)}</a></h1>\\n`;\n\t\tbuf += '<script type=\"text/plain\" class=\"battle-log-data\">' + battle.stepQueue.join('\\n').replace(/\\//g, '\\\\/') + '</script>\\n'; // lgtm [js/incomplete-sanitization]\n\t\tbuf += '</div>\\n';\n\t\tbuf += '<div class=\"battle-log battle-log-inline\"><div class=\"inner\">' + battle.scene.log.elem.innerHTML + '</div></div>\\n';\n\t\tbuf += '</div>\\n';\n\t\tbuf += '<script>\\n';\n\t\tbuf += `let daily = Math.floor(Date.now()/1000/60/60/24);document.write('<script src=\"https://${Config.routes.client}/js/replay-embed.js?version'+daily+'\"></'+'script>');\\n`;\n\t\tbuf += '</script>\\n';\n\t\treturn buf;\n\t}\n\n\tstatic createReplayFileHref(room: any) {\n\t\t// unescape(encodeURIComponent()) is necessary because btoa doesn't support Unicode\n\t\t// @ts-ignore\n\t\treturn 'data:text/plain;base64,' + encodeURIComponent(btoa(unescape(encodeURIComponent(BattleLog.createReplayFile(room)))));\n\t}\n}\n"],"mappings":"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"}