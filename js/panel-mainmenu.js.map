{"version":3,"file":"panel-mainmenu.js","names":["MainMenuRoom","classType","userdetailsCache","roomsCache","receiveLine","args","cmd","challstr","PSLoginServer","query","act","then","res","loggedin","send","username","assertion","fullName","namedCode","avatar","PS","user","setName","challengesBuf","receiveChallenges","queryId","responseJSON","handleQueryResponse","JSON","parse","user1","user2","message","handlePM","parseFormats","alert","replace","lobby","rooms","dataBuf","json","userid","challengesFrom","getPMRoom","toID","challengeTo","to","roomid","room","pmTarget","targetUserid","challengedFormat","challengingFormat","format","update","formatsList","isSection","section","column","window","NonBattleGames","rps","BattleFormats","j","length","entry","teams","usesLocalLadder","charAt","isNaN","Number","slice","parseInt","name","searchShow","challengeShow","tournamentShow","team","teambuilderLevel","lastCommaIndex","lastIndexOf","code","substr","NaN","id","isTeambuilderFormat","teambuilderFormat","teambuilderFormatName","parenPos","indexOf","trim","rated","effectType","multivariantFormats","battleFormat","userid1","userid2","sort","join","addRoom","response","userdetails","Object","assign","userRoom","pspl","roomInfo","spotlight","chat","official","roomsRoom","battlesRoom","battleTable","battles","battleid","push","ladderRoomEntries","entries","filter","startsWith","ladderRoom","PSRoom","NewsPanel","render","props","__html","newsHTML","PSRoomPanel","MainMenuPanel","submit","e","handleDragStart","currentTarget","getAttribute","dragging","type","focus","base","querySelector","renderMiniRoom","roomType","roomTypes","Panel","Component","renderMiniRooms","miniRoomList","map","title","renderSearchButton","down","textAlign","Config","routes","client","isOffline","onlineButton","display","leftRoomWidth","server","dex","replays","root","FormatDropdown","change","value","forceUpdate","onChange","preact","TeamDropdown","teamFormat","teamKey","getDefaultTeam","list","key","formatData","Dex","getPokemonIcon","byKey","TeamForm","state","changeFormat","setState","target","preventDefault","undefined","onSubmit","children","Model"],"sources":["../src/panel-mainmenu.tsx"],"sourcesContent":["/**\n * Main menu panel\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\ntype RoomInfo = {\n\ttitle: string, desc?: string, userCount?: number, section?: string, spotlight?: string, subRooms?: string[],\n};\n\nclass MainMenuRoom extends PSRoom {\n\treadonly classType: string = 'mainmenu';\n\tuserdetailsCache: {[userid: string]: {\n\t\tuserid: ID,\n\t\tavatar?: string | number,\n\t\tstatus?: string,\n\t\tgroup?: string,\n\t\tcustomgroup?: string,\n\t\trooms?: {[roomid: string]: {isPrivate?: true, p1?: string, p2?: string}},\n\t}} = {};\n\troomsCache: {\n\t\tbattleCount?: number,\n\t\tuserCount?: number,\n\t\tchat?: RoomInfo[],\n\t\tsectionTitles?: string[],\n\t} = {};\n\treceiveLine(args: Args) {\n\t\tconst [cmd] = args;\n\t\tswitch (cmd) {\n\t\tcase 'challstr': {\n\t\t\tconst [, challstr] = args;\n\t\t\tPSLoginServer.query({\n\t\t\t\tact: 'upkeep',\n\t\t\t\tchallstr,\n\t\t\t}).then(res => {\n\t\t\t\tif (!res) return;\n\t\t\t\tif (!res.loggedin) return;\n\t\t\t\tthis.send(`/trn ${res.username},0,${res.assertion}`);\n\t\t\t});\n\t\t\treturn;\n\t\t} case 'updateuser': {\n\t\t\tconst [, fullName, namedCode, avatar] = args;\n\t\t\tPS.user.setName(fullName, namedCode === '1', avatar);\n\t\t\treturn;\n\t\t} case 'updatechallenges': {\n\t\t\tconst [, challengesBuf] = args;\n\t\t\tthis.receiveChallenges(challengesBuf);\n\t\t\treturn;\n\t\t} case 'queryresponse': {\n\t\t\tconst [, queryId, responseJSON] = args;\n\t\t\tthis.handleQueryResponse(queryId as ID, JSON.parse(responseJSON));\n\t\t\treturn;\n\t\t} case 'pm': {\n\t\t\tconst [, user1, user2, message] = args;\n\t\t\tthis.handlePM(user1, user2, message);\n\t\t\treturn;\n\t\t} case 'formats': {\n\t\t\tthis.parseFormats(args);\n\t\t\treturn;\n\t\t} case 'popup': {\n\t\t\tconst [, message] = args;\n\t\t\talert(message.replace(/\\|\\|/g, '\\n'));\n\t\t\treturn;\n\t\t}}\n\t\tconst lobby = PS.rooms['lobby'];\n\t\tif (lobby) lobby.receiveLine(args);\n\t}\n\treceiveChallenges(dataBuf: string) {\n\t\tlet json;\n\t\ttry {\n\t\t\tjson = JSON.parse(dataBuf);\n\t\t} catch {}\n\t\tfor (const userid in json.challengesFrom) {\n\t\t\tPS.getPMRoom(toID(userid));\n\t\t}\n\t\tif (json.challengeTo) {\n\t\t\tPS.getPMRoom(toID(json.challengeTo.to));\n\t\t}\n\t\tfor (const roomid in PS.rooms) {\n\t\t\tconst room = PS.rooms[roomid] as ChatRoom;\n\t\t\tif (!room.pmTarget) continue;\n\t\t\tconst targetUserid = toID(room.pmTarget);\n\t\t\tif (!room.challengedFormat && !(targetUserid in json.challengesFrom) &&\n\t\t\t\t!room.challengingFormat && json.challengeTo?.to !== targetUserid) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\troom.challengedFormat = json.challengesFrom[targetUserid] || null;\n\t\t\troom.challengingFormat = json.challengeTo?.to === targetUserid ? json.challengeTo.format : null;\n\t\t\troom.update(null);\n\t\t}\n\t}\n\tparseFormats(formatsList: string[]) {\n\t\tlet isSection = false;\n\t\tlet section = '';\n\n\t\tlet column = 0;\n\n\t\twindow.NonBattleGames = {rps: 'Rock Paper Scissors'};\n\t\twindow.BattleFormats = {};\n\t\tfor (let j = 1; j < formatsList.length; j++) {\n\t\t\tconst entry = formatsList[j];\n\t\t\tif (isSection) {\n\t\t\t\tsection = entry;\n\t\t\t\tisSection = false;\n\t\t\t} else if (entry === ',LL') {\n\t\t\t\tPS.teams.usesLocalLadder = true;\n\t\t\t} else if (entry === '' || (entry.charAt(0) === ',' && !isNaN(Number(entry.slice(1))))) {\n\t\t\t\tisSection = true;\n\n\t\t\t\tif (entry) {\n\t\t\t\t\tcolumn = parseInt(entry.slice(1), 10) || 0;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlet name = entry;\n\t\t\t\tlet searchShow = true;\n\t\t\t\tlet challengeShow = true;\n\t\t\t\tlet tournamentShow = true;\n\t\t\t\tlet team: 'preset' | null = null;\n\t\t\t\tlet teambuilderLevel: number | null = null;\n\t\t\t\tlet lastCommaIndex = name.lastIndexOf(',');\n\t\t\t\tlet code = lastCommaIndex >= 0 ? parseInt(name.substr(lastCommaIndex + 1), 16) : NaN;\n\t\t\t\tif (!isNaN(code)) {\n\t\t\t\t\tname = name.substr(0, lastCommaIndex);\n\t\t\t\t\tif (code & 1) team = 'preset';\n\t\t\t\t\tif (!(code & 2)) searchShow = false;\n\t\t\t\t\tif (!(code & 4)) challengeShow = false;\n\t\t\t\t\tif (!(code & 8)) tournamentShow = false;\n\t\t\t\t\tif (code & 16) teambuilderLevel = 50;\n\t\t\t\t} else {\n\t\t\t\t\t// Backwards compatibility: late 0.9.0 -> 0.10.0\n\t\t\t\t\tif (name.substr(name.length - 2) === ',#') { // preset teams\n\t\t\t\t\t\tteam = 'preset';\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\n\t\t\t\t\t}\n\t\t\t\t\tif (name.substr(name.length - 2) === ',,') { // search-only\n\t\t\t\t\t\tchallengeShow = false;\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\n\t\t\t\t\t} else if (name.substr(name.length - 1) === ',') { // challenge-only\n\t\t\t\t\t\tsearchShow = false;\n\t\t\t\t\t\tname = name.substr(0, name.length - 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet id = toID(name);\n\t\t\t\tlet isTeambuilderFormat = !team && name.slice(-11) !== 'Custom Game';\n\t\t\t\tlet teambuilderFormat = '' as ID;\n\t\t\t\tlet teambuilderFormatName = '';\n\t\t\t\tif (isTeambuilderFormat) {\n\t\t\t\t\tteambuilderFormatName = name;\n\t\t\t\t\tif (id.slice(0, 3) !== 'gen') {\n\t\t\t\t\t\tteambuilderFormatName = '[Gen 6] ' + name;\n\t\t\t\t\t}\n\t\t\t\t\tlet parenPos = teambuilderFormatName.indexOf('(');\n\t\t\t\t\tif (parenPos > 0 && name.slice(-1) === ')') {\n\t\t\t\t\t\t// variation of existing tier\n\t\t\t\t\t\tteambuilderFormatName = teambuilderFormatName.slice(0, parenPos).trim();\n\t\t\t\t\t}\n\t\t\t\t\tif (teambuilderFormatName !== name) {\n\t\t\t\t\t\tteambuilderFormat = toID(teambuilderFormatName);\n\t\t\t\t\t\tif (BattleFormats[teambuilderFormat]) {\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat].isTeambuilderFormat = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat] = {\n\t\t\t\t\t\t\t\tid: teambuilderFormat,\n\t\t\t\t\t\t\t\tname: teambuilderFormatName,\n\t\t\t\t\t\t\t\tteam,\n\t\t\t\t\t\t\t\tsection,\n\t\t\t\t\t\t\t\tcolumn,\n\t\t\t\t\t\t\t\trated: false,\n\t\t\t\t\t\t\t\tisTeambuilderFormat: true,\n\t\t\t\t\t\t\t\teffectType: 'Format',\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tisTeambuilderFormat = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (BattleFormats[id]?.isTeambuilderFormat) {\n\t\t\t\t\tisTeambuilderFormat = true;\n\t\t\t\t}\n\t\t\t\t// make sure formats aren't out-of-order\n\t\t\t\tif (BattleFormats[id]) delete BattleFormats[id];\n\t\t\t\tBattleFormats[id] = {\n\t\t\t\t\tid,\n\t\t\t\t\tname,\n\t\t\t\t\tteam,\n\t\t\t\t\tsection,\n\t\t\t\t\tcolumn,\n\t\t\t\t\tsearchShow,\n\t\t\t\t\tchallengeShow,\n\t\t\t\t\ttournamentShow,\n\t\t\t\t\trated: searchShow && id.substr(4, 7) !== 'unrated',\n\t\t\t\t\tteambuilderLevel,\n\t\t\t\t\tteambuilderFormat,\n\t\t\t\t\tisTeambuilderFormat,\n\t\t\t\t\teffectType: 'Format',\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// Match base formats to their variants, if they are unavailable in the server.\n\t\tlet multivariantFormats: {[id: string]: 1} = {};\n\t\tfor (let id in BattleFormats) {\n\t\t\tlet teambuilderFormat = BattleFormats[BattleFormats[id].teambuilderFormat!];\n\t\t\tif (!teambuilderFormat || multivariantFormats[teambuilderFormat.id]) continue;\n\t\t\tif (!teambuilderFormat.searchShow && !teambuilderFormat.challengeShow && !teambuilderFormat.tournamentShow) {\n\t\t\t\t// The base format is not available.\n\t\t\t\tif (teambuilderFormat.battleFormat) {\n\t\t\t\t\tmultivariantFormats[teambuilderFormat.id] = 1;\n\t\t\t\t\tteambuilderFormat.battleFormat = '';\n\t\t\t\t} else {\n\t\t\t\t\tteambuilderFormat.battleFormat = id;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tPS.teams.update('format');\n\t}\n\thandlePM(user1: string, user2: string, message: string) {\n\t\tconst userid1 = toID(user1);\n\t\tconst userid2 = toID(user2);\n\t\tconst roomid = `pm-${[userid1, userid2].sort().join('-')}` as RoomID;\n\t\tlet room = PS.rooms[roomid];\n\t\tif (!room) {\n\t\t\tconst pmTarget = PS.user.userid === userid1 ? user2 : user1;\n\t\t\tPS.addRoom({\n\t\t\t\tid: roomid,\n\t\t\t\tpmTarget,\n\t\t\t}, true);\n\t\t\troom = PS.rooms[roomid]!;\n\t\t}\n\t\troom.receiveLine([`c`, user1, message]);\n\t\tPS.update();\n\t}\n\thandleQueryResponse(id: ID, response: any) {\n\t\tswitch (id) {\n\t\tcase 'userdetails':\n\t\t\tlet userid = response.userid;\n\t\t\tlet userdetails = this.userdetailsCache[userid];\n\t\t\tif (!userdetails) {\n\t\t\t\tthis.userdetailsCache[userid] = response;\n\t\t\t} else {\n\t\t\t\tObject.assign(userdetails, response);\n\t\t\t}\n\t\t\tconst userRoom = PS.rooms[`user-${userid}`] as UserRoom;\n\t\t\tif (userRoom) userRoom.update(null);\n\t\t\tbreak;\n\t\tcase 'rooms':\n\t\t\tif (response.pspl) {\n\t\t\t\tfor (const roomInfo of response.pspl) roomInfo.spotlight = \"Spotlight\";\n\t\t\t\tresponse.chat = [...response.pspl, ...response.chat];\n\t\t\t\tresponse.pspl = null;\n\t\t\t}\n\t\t\tif (response.official) {\n\t\t\t\tfor (const roomInfo of response.official) roomInfo.section = \"Official\";\n\t\t\t\tresponse.chat = [...response.official, ...response.chat];\n\t\t\t\tresponse.official = null;\n\t\t\t}\n\t\t\tthis.roomsCache = response;\n\t\t\tconst roomsRoom = PS.rooms[`rooms`] as RoomsRoom;\n\t\t\tif (roomsRoom) roomsRoom.update(null);\n\t\t\tbreak;\n\t\tcase 'roomlist':\n\t\t\tconst battlesRoom = PS.rooms[`battles`] as BattlesRoom;\n\t\t\tif (battlesRoom) {\n\t\t\t\tconst battleTable = response.rooms;\n\t\t\t\tconst battles = [];\n\t\t\t\tfor (const battleid in battleTable) {\n\t\t\t\t\tbattleTable[battleid].id = battleid;\n\t\t\t\t\tbattles.push(battleTable[battleid]);\n\t\t\t\t}\n\t\t\t\tbattlesRoom.battles = battles;\n\t\t\t\tbattlesRoom.update(null);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'laddertop':\n\t\t\tconst ladderRoomEntries = Object.entries(PS.rooms).filter(entry => entry[0].startsWith('ladder'));\n\t\t\tfor (const [, ladderRoom] of ladderRoomEntries) {\n\t\t\t\t(ladderRoom as LadderRoom).update(response);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nclass NewsPanel extends PSRoomPanel {\n\trender() {\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable>\n\t\t\t<div class=\"mini-window-body\" dangerouslySetInnerHTML={{__html: PS.newsHTML}}></div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nclass MainMenuPanel extends PSRoomPanel<MainMenuRoom> {\n\tfocus() {\n\t\t(this.base!.querySelector('button.big') as HTMLButtonElement).focus();\n\t}\n\tsubmit = (e: Event) => {\n\t\talert('todo: implement');\n\t};\n\thandleDragStart = (e: DragEvent) => {\n\t\tconst roomid = (e.currentTarget as HTMLElement).getAttribute('data-roomid') as RoomID;\n\t\tPS.dragging = {type: 'room', roomid};\n\t};\n\trenderMiniRoom(room: PSRoom) {\n\t\tconst roomType = PS.roomTypes[room.type];\n\t\tconst Panel = roomType ? roomType.Component : PSRoomPanel;\n\t\treturn <Panel key={room.id} room={room} />;\n\t}\n\trenderMiniRooms() {\n\t\treturn PS.miniRoomList.map(roomid => {\n\t\t\tconst room = PS.rooms[roomid]!;\n\t\t\treturn <div class=\"pmbox\">\n\t\t\t\t<div class=\"mini-window\">\n\t\t\t\t\t<h3 draggable onDragStart={this.handleDragStart} data-roomid={roomid}>\n\t\t\t\t\t\t<button class=\"closebutton\" name=\"closeRoom\" value={roomid} aria-label=\"Close\" tabIndex={-1}><i class=\"fa fa-times-circle\"></i></button>\n\t\t\t\t\t\t<button class=\"minimizebutton\" tabIndex={-1}><i class=\"fa fa-minus-circle\"></i></button>\n\t\t\t\t\t\t{room.title}\n\t\t\t\t\t</h3>\n\t\t\t\t\t{this.renderMiniRoom(room)}\n\t\t\t\t</div>\n\t\t\t</div>;\n\t\t});\n\t}\n\trenderSearchButton() {\n\t\tif (PS.down) {\n\t\t\treturn <div class=\"menugroup\" style=\"background: rgba(10,10,10,.6)\">\n\t\t\t\t{PS.down === 'ddos' ?\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to a DDoS attack!</strong></p>\n\t\t\t\t:\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to technical difficulties!</strong></p>\n\t\t\t\t}\n\t\t\t\t<p>\n\t\t\t\t\t<div style={{textAlign: 'center'}}>\n\t\t\t\t\t\t<img width=\"96\" height=\"96\" src={`//${Config.routes.client}/sprites/gen5/teddiursa.png`} alt=\"\" />\n\t\t\t\t\t</div>\n\t\t\t\t\tBear with us as we freak out.\n\t\t\t\t</p>\n\t\t\t\t<p>(We'll be back up in a few hours.)</p>\n\t\t\t</div>;\n\t\t}\n\n\t\tif (!PS.user.userid || PS.isOffline) {\n\t\t\treturn <TeamForm class=\"menugroup\" onSubmit={this.submit}>\n\t\t\t\t<button class=\"mainmenu1 big button disabled\" name=\"search\">\n\t\t\t\t\t<em>{PS.isOffline ? \"Disconnected\" : \"Connecting...\"}</em>\n\t\t\t\t</button>\n\t\t\t</TeamForm>;\n\t\t}\n\n\t\treturn <TeamForm class=\"menugroup\" onSubmit={this.submit}>\n\t\t\t<button class=\"mainmenu1 big button\" name=\"search\">\n\t\t\t\t<strong>Battle!</strong><br />\n\t\t\t\t<small>Find a random opponent</small>\n\t\t\t</button>\n\t\t</TeamForm>;\n\t}\n\trender() {\n\t\tconst onlineButton = ' button' + (PS.isOffline ? ' disabled' : '');\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable>\n\t\t\t<div class=\"mainmenuwrapper\">\n\t\t\t\t<div class=\"leftmenu\">\n\t\t\t\t\t<div class=\"activitymenu\">\n\t\t\t\t\t\t{this.renderMiniRooms()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"mainmenu\">\n\t\t\t\t\t\t{this.renderSearchButton()}\n\n\t\t\t\t\t\t<div class=\"menugroup\">\n\t\t\t\t\t\t\t<p><button class=\"mainmenu2 button\" name=\"joinRoom\" value=\"teambuilder\">Teambuilder</button></p>\n\t\t\t\t\t\t\t<p><button class={\"mainmenu3\" + onlineButton} name=\"joinRoom\" value=\"ladder\">Ladder</button></p>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"menugroup\">\n\t\t\t\t\t\t\t<p><button class={\"mainmenu4\" + onlineButton} name=\"joinRoom\" value=\"battles\">Watch a battle</button></p>\n\t\t\t\t\t\t\t<p><button class={\"mainmenu5\" + onlineButton} name=\"finduser\">Find a user</button></p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"rightmenu\" style={{display: PS.leftRoomWidth ? 'none' : 'block'}}>\n\t\t\t\t\t<div class=\"menugroup\">\n\t\t\t\t\t\t{PS.server.id === 'showdown' ?\n\t\t\t\t\t\t\t<p><button class={\"mainmenu1\" + onlineButton} name=\"joinRoom\" value=\"rooms\">Join chat</button></p>\n\t\t\t\t\t\t:\n\t\t\t\t\t\t\t<p><button class={\"mainmenu1\" + onlineButton} name=\"joinRoom\" value=\"lobby\">Join lobby chat</button></p>\n\t\t\t\t\t\t}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mainmenufooter\">\n\t\t\t\t\t<div class=\"bgcredit\"></div>\n\t\t\t\t\t<small>\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/`} target=\"_blank\">Pok&eacute;dex</a> | {}\n\t\t\t\t\t\t<a href={`//${Config.routes.replays}/`} target=\"_blank\">Replays</a> | {}\n\t\t\t\t\t\t<a href={`//${Config.routes.root}/rules`} target=\"_blank\">Rules</a> | {}\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/credits`} target=\"_blank\">Credits</a> | {}\n\t\t\t\t\t\t<a href=\"//smogon.com/forums/\" target=\"_blank\">Forum</a>\n\t\t\t\t\t</small>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nclass FormatDropdown extends preact.Component<{format?: string, onChange?: JSX.EventHandler<Event>}> {\n\tdeclare base?: HTMLButtonElement;\n\tformat = '[Gen 7] Random Battle';\n\tchange = (e: Event) => {\n\t\tif (!this.base) return;\n\t\tthis.format = this.base.value;\n\t\tthis.forceUpdate();\n\t\tif (this.props.onChange) this.props.onChange(e);\n\t};\n\trender() {\n\t\tif (this.props.format) {\n\t\t\treturn <button\n\t\t\tname=\"format\" value={this.props.format} class=\"select formatselect preselected\" disabled\n\t\t\t>{this.props.format}</button>;\n\t\t}\n\t\treturn <button\n\t\t\tname=\"format\" value={this.format}\n\t\t\tclass=\"select formatselect\" data-href=\"/formatdropdown\" onChange={this.change}\n\t\t>\n\t\t\t{this.format}\n\t\t</button>;\n\t}\n}\n\nclass TeamDropdown extends preact.Component<{format: string}> {\n\tteamFormat = '';\n\tteamKey = '';\n\tchange = () => {\n\t\tif (!this.base) return;\n\t\tthis.teamKey = (this.base as HTMLButtonElement).value;\n\t\tthis.forceUpdate();\n\t};\n\tgetDefaultTeam(teambuilderFormat: string) {\n\t\tfor (const team of PS.teams.list) {\n\t\t\tif (team.format === teambuilderFormat) return team.key;\n\t\t}\n\t\treturn '';\n\t}\n\trender() {\n\t\tconst teamFormat = PS.teams.teambuilderFormat(this.props.format);\n\t\tconst formatData = window.BattleFormats?.[teamFormat];\n\t\tif (formatData && formatData.team) {\n\t\t\treturn <button class=\"select teamselect preselected\" name=\"team\" value=\"random\" disabled>\n\t\t\t\t<div class=\"team\">\n\t\t\t\t\t<strong>Random team</strong>\n\t\t\t\t\t<small>\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\n\t\t\t\t\t\t<span class=\"picon\" style={Dex.getPokemonIcon(null)}></span>\n\t\t\t\t\t</small>\n\t\t\t\t</div>\n\t\t\t</button>;\n\t\t}\n\t\tif (teamFormat !== this.teamFormat) {\n\t\t\tthis.teamFormat = teamFormat;\n\t\t\tthis.teamKey = this.getDefaultTeam(teamFormat);\n\t\t}\n\t\tconst team = PS.teams.byKey[this.teamKey] || null;\n\t\treturn <button\n\t\t\tname=\"team\" value={this.teamKey}\n\t\t\tclass=\"select teamselect\" data-href=\"/teamdropdown\" data-format={teamFormat} onChange={this.change}\n\t\t>\n\t\t\t{PS.roomTypes['teamdropdown'] && <TeamBox team={team} noLink />}\n\t\t</button>;\n\t}\n}\n\nclass TeamForm extends preact.Component<{\n\tchildren: preact.ComponentChildren, class?: string, format?: string,\n\tonSubmit: null | ((e: Event, format: string, team?: Team) => void),\n}> {\n\tstate = {format: '[Gen 7] Random Battle'};\n\tchangeFormat = (e: Event) => {\n\t\tthis.setState({format: (e.target as HTMLButtonElement).value});\n\t};\n\tsubmit = (e: Event) => {\n\t\te.preventDefault();\n\t\tconst format = (this.base!.querySelector('button[name=format]') as HTMLButtonElement).value;\n\t\tconst teamKey = (this.base!.querySelector('button[name=team]') as HTMLButtonElement).value;\n\t\tconst team = teamKey ? PS.teams.byKey[teamKey] : undefined;\n\t\tif (this.props.onSubmit) this.props.onSubmit(e, format, team);\n\t};\n\trender() {\n\t\treturn <form class={this.props.class} onSubmit={this.submit}>\n\t\t\t<p>\n\t\t\t\t<label class=\"label\">\n\t\t\t\t\tFormat:<br />\n\t\t\t\t\t<FormatDropdown onChange={this.changeFormat} format={this.props.format} />\n\t\t\t\t</label>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t<label class=\"label\">\n\t\t\t\t\tTeam:<br />\n\t\t\t\t\t<TeamDropdown format={this.state.format} />\n\t\t\t\t</label>\n\t\t\t</p>\n\t\t\t<p>{this.props.children}</p>\n\t\t</form>;\n\t}\n}\n\nPS.roomTypes['news'] = {\n\tComponent: NewsPanel,\n};\n\nPS.roomTypes['mainmenu'] = {\n\tModel: MainMenuRoom,\n\tComponent: MainMenuPanel,\n};\n"],"mappings":"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"}