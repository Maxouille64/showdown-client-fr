{"version":3,"file":"battle-dex.js","names":["window","global","exports","nodewebkit","process","versions","toID","text","id","userid","toLowerCase","replace","toUserid","PSUtils","splitFirst","str","delimiter","limit","splitStr","length","delimiterIndex","indexOf","push","slice","compare","a","b","localeCompare","Array","isArray","i","comparison","reverse","Error","sortBy","array","callback","sort","toRoomid","roomid","toName","name","trim","substr","Dex","gen","modid","cache","statNames","statNamesExceptHP","pokeballs","resourcePrefix","prefix","document","location","protocol","Config","routes","client","fxPrefix","loadedSpriteData","xy","bw","moddedDexes","moves","get","nameOrMove","BattleAliases","BattleMovedex","data","exists","exec","hpWithType","hpPower","basePower","Number","move","Move","items","nameOrItem","BattleItems","item","Item","abilities","nameOrAbility","BattleAbilities","ability","Ability","species","nameOrSpecies","formid","BattlePokedexAltForms","BattlePokedex","BattleBaseSpeciesChart","baseSpeciesId","startsWith","tier","baseSpecies","Species","cosmeticFormes","forme","baseForme","otherFormes","types","allCache","type","toUpperCase","BattleTypeChart","damageTaken","effectType","all","isName","hasOwnProperty","mod","BattleTeambuilderTable","ModdedDex","forGen","resolveAvatar","avatar","BattleAvatarNumbers","charAt","includes","server","registered","port","host","encodeURIComponent","sanitizeName","prefs","prop","Storage","getShortName","shortName","getEffect","PureEffect","getGen3Category","hasAbility","loadSpriteData","path","$","attr","qs","split","match","el","createElement","src","getElementsByTagName","appendChild","getSpriteData","pokemon","isFront","options","mechanicsGen","isDynamax","dynamax","Pokemon","volatiles","transform","shiny","gender","isGigantamax","getSpeciesForme","endsWith","spriteData","w","h","y","url","pixelated","isFrontSprite","cryurl","spriteid","dir","facing","graphicsGen","Math","max","min","baseDir","animationData","miscData","speciesid","isTotem","BattlePokemonSprites","BattlePokemonSpritesBW","num","baseSpeciesid","formeid","isMega","afd","noScale","allowAnim","getPokemonIconNum","isFemale","facingLeft","BattlePokemonIconIndexes","BattlePokemonIconIndexesLeft","getPokemonIcon","speciesForme","formechange","top","floor","left","fainted","getTeambuilderSpriteData","spriteDir","x","xydexExists","isNonstandard","getTeambuilderSprite","getItemIcon","spritenum","getTypeIcon","sanitizedType","getCategoryIcon","category","categoryID","sanitizedCategory","getPokeballs","Object","values","isPokeball","Moves","Items","Abilities","Types","table","overrideMoveData","assign","overrideItemDesc","shortDesc","overrideAbilityData","overrideSpeciesData","overrideTier","removeType","overrideTypeChart","parseInt","require"],"sources":["../src/battle-dex.ts"],"sourcesContent":["/**\n * Pokemon Showdown Dex\n *\n * Roughly equivalent to sim/dex.js in a Pokemon Showdown server, but\n * designed for use in browsers rather than in Node.\n *\n * This is a generic utility library for Pokemon Showdown code: any\n * code shared between the replay viewer and the client usually ends up\n * here.\n *\n * Licensing note: PS's client has complicated licensing:\n * - The client as a whole is AGPLv3\n * - The battle replay/animation engine (battle-*.ts) by itself is MIT\n *\n * Compiled into battledata.js which includes all dependencies\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license MIT\n */\n\ndeclare var require: any;\ndeclare var global: any;\n\nif (typeof window === 'undefined') {\n\t// Node\n\t(global as any).window = global;\n} else {\n\t// browser (possibly NW.js!)\n\twindow.exports = window;\n}\n\n// @ts-ignore\nwindow.nodewebkit = !!(typeof process !== 'undefined' && process.versions && process.versions['node-webkit']);\n\nfunction toID(text: any) {\n\tif (text?.id) {\n\t\ttext = text.id;\n\t} else if (text?.userid) {\n\t\ttext = text.userid;\n\t}\n\tif (typeof text !== 'string' && typeof text !== 'number') return '' as ID;\n\treturn ('' + text).toLowerCase().replace(/[^a-z0-9]+/g, '') as ID;\n}\n\nfunction toUserid(text: any) {\n\treturn toID(text);\n}\n\ntype Comparable = number | string | boolean | Comparable[] | {reverse: Comparable};\nconst PSUtils = new class {\n\t/**\n\t * Like string.split(delimiter), but only recognizes the first `limit`\n\t * delimiters (default 1).\n\t *\n\t * `\"1 2 3 4\".split(\" \", 2) => [\"1\", \"2\"]`\n\t *\n\t * `splitFirst(\"1 2 3 4\", \" \", 1) => [\"1\", \"2 3 4\"]`\n\t *\n\t * Returns an array of length exactly limit + 1.\n\t */\n\tsplitFirst(str: string, delimiter: string, limit: number = 1) {\n\t\tlet splitStr: string[] = [];\n\t\twhile (splitStr.length < limit) {\n\t\t\tlet delimiterIndex = str.indexOf(delimiter);\n\t\t\tif (delimiterIndex >= 0) {\n\t\t\t\tsplitStr.push(str.slice(0, delimiterIndex));\n\t\t\t\tstr = str.slice(delimiterIndex + delimiter.length);\n\t\t\t} else {\n\t\t\t\tsplitStr.push(str);\n\t\t\t\tstr = '';\n\t\t\t}\n\t\t}\n\t\tsplitStr.push(str);\n\t\treturn splitStr;\n\t}\n\n\t/**\n\t * Compares two variables; intended to be used as a smarter comparator.\n\t * The two variables must be the same type (TypeScript will not check this).\n\t *\n\t * - Numbers are sorted low-to-high, use `-val` to reverse\n\t * - Strings are sorted A to Z case-semi-insensitively, use `{reverse: val}` to reverse\n\t * - Booleans are sorted true-first (REVERSE of casting to numbers), use `!val` to reverse\n\t * - Arrays are sorted lexically in the order of their elements\n\t *\n\t * In other words: `[num, str]` will be sorted A to Z, `[num, {reverse: str}]` will be sorted Z to A.\n\t */\n\tcompare(a: Comparable, b: Comparable): number {\n\t\tif (typeof a === 'number') {\n\t\t\treturn a - (b as number);\n\t\t}\n\t\tif (typeof a === 'string') {\n\t\t\treturn a.localeCompare(b as string);\n\t\t}\n\t\tif (typeof a === 'boolean') {\n\t\t\treturn (a ? 1 : 2) - (b ? 1 : 2);\n\t\t}\n\t\tif (Array.isArray(a)) {\n\t\t\tfor (let i = 0; i < a.length; i++) {\n\t\t\t\tconst comparison = PSUtils.compare(a[i], (b as Comparable[])[i]);\n\t\t\t\tif (comparison) return comparison;\n\t\t\t}\n\t\t\treturn 0;\n\t\t}\n\t\tif (a.reverse) {\n\t\t\treturn PSUtils.compare((b as {reverse: string}).reverse, a.reverse);\n\t\t}\n\t\tthrow new Error(`Passed value ${a} is not comparable`);\n\t}\n\t/**\n\t * Sorts an array according to the callback's output on its elements.\n\t *\n\t * The callback's output is compared according to `PSUtils.compare` (in\n\t * particular, it supports arrays so you can sort by multiple things).\n\t */\n\tsortBy<T>(array: T[], callback: (a: T) => Comparable): T[];\n\t/**\n\t * Sorts an array according to `PSUtils.compare`. (Correctly sorts numbers,\n\t * unlike `array.sort`)\n\t */\n\tsortBy<T extends Comparable>(array: T[]): T[];\n\tsortBy<T>(array: T[], callback?: (a: T) => Comparable) {\n\t\tif (!callback) return (array as any[]).sort(PSUtils.compare);\n\t\treturn array.sort((a, b) => PSUtils.compare(callback(a), callback(b)));\n\t}\n};\n\n/**\n * Sanitize a room ID by removing anything that isn't alphanumeric or `-`.\n * Shouldn't actually do anything except against malicious input.\n */\nfunction toRoomid(roomid: string) {\n\treturn roomid.replace(/[^a-zA-Z0-9-]+/g, '').toLowerCase();\n}\n\nfunction toName(name: any) {\n\tif (typeof name !== 'string' && typeof name !== 'number') return '';\n\tname = ('' + name).replace(/[\\|\\s\\[\\]\\,\\u202e]+/g, ' ').trim();\n\tif (name.length > 18) name = name.substr(0, 18).trim();\n\n\t// remove zalgo\n\tname = name.replace(\n\t\t/[\\u0300-\\u036f\\u0483-\\u0489\\u0610-\\u0615\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06ED\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E]{3,}/g,\n\t\t''\n\t);\n\tname = name.replace(/[\\u239b-\\u23b9]/g, '');\n\n\treturn name;\n}\n\ninterface SpriteData {\n\tw: number;\n\th: number;\n\ty?: number;\n\tgen?: number;\n\turl?: string;\n\trawHTML?: string;\n\tpixelated?: boolean;\n\tisFrontSprite?: boolean;\n\tcryurl?: string;\n\tshiny?: boolean;\n}\n\ninterface TeambuilderSpriteData {\n\tx: number;\n\ty: number;\n\tspriteDir: string;\n\tspriteid: string;\n\tshiny?: boolean;\n}\n\nconst Dex = new class implements ModdedDex {\n\treadonly gen = 9;\n\treadonly modid = 'gen9' as ID;\n\treadonly cache = null!;\n\n\treadonly statNames: ReadonlyArray<StatName> = ['hp', 'atk', 'def', 'spa', 'spd', 'spe'];\n\treadonly statNamesExceptHP: ReadonlyArray<StatNameExceptHP> = ['atk', 'def', 'spa', 'spd', 'spe'];\n\n\tpokeballs: string[] | null = null;\n\n\tresourcePrefix = (() => {\n\t\tlet prefix = '';\n\t\tif (window.document?.location?.protocol !== 'http:') prefix = 'https:';\n\t\treturn `${prefix}//${window.Config ? Config.routes.client : 'play.pokemonshowdown.com'}/`;\n\t})();\n\n\tfxPrefix = (() => {\n\t\tconst protocol = (window.document?.location?.protocol !== 'http:') ? 'https:' : '';\n\t\treturn `${protocol}//${window.Config ? Config.routes.client : 'play.pokemonshowdown.com'}/fx/`;\n\t})();\n\n\tloadedSpriteData = {xy: 1, bw: 0};\n\tmoddedDexes: {[mod: string]: ModdedDex} = {};\n\n\tmod(modid: ID): ModdedDex {\n\t\tif (modid === 'gen9') return this;\n\t\tif (!window.BattleTeambuilderTable) return this;\n\t\tif (modid in this.moddedDexes) {\n\t\t\treturn this.moddedDexes[modid];\n\t\t}\n\t\tthis.moddedDexes[modid] = new ModdedDex(modid);\n\t\treturn this.moddedDexes[modid];\n\t}\n\tforGen(gen: number) {\n\t\tif (!gen) return this;\n\t\treturn this.mod(`gen${gen}` as ID);\n\t}\n\n\tresolveAvatar(avatar: string): string {\n\t\tif (window.BattleAvatarNumbers && avatar in BattleAvatarNumbers) {\n\t\t\tavatar = BattleAvatarNumbers[avatar];\n\t\t}\n\t\tif (avatar.charAt(0) === '#') {\n\t\t\treturn Dex.resourcePrefix + 'sprites/trainers-custom/' + toID(avatar.substr(1)) + '.png';\n\t\t}\n\t\tif (avatar.includes('.') && window.Config?.server?.registered) {\n\t\t\t// custom avatar served by the server\n\t\t\tlet protocol = (Config.server.port === 443) ? 'https' : 'http';\n\t\t\treturn protocol + '://' + Config.server.host + ':' + Config.server.port +\n\t\t\t\t'/avatars/' + encodeURIComponent(avatar).replace(/\\%3F/g, '?');\n\t\t}\n\t\treturn Dex.resourcePrefix + 'sprites/trainers/' + Dex.sanitizeName(avatar || 'unknown') + '.png';\n\t}\n\n\t/**\n\t * This is used to sanitize strings from data files like `moves.js` and\n\t * `teambuilder-tables.js`.\n\t *\n\t * This makes sure untrusted strings can't wreak havoc if someone forgets to\n\t * escape it before putting it in HTML.\n\t *\n\t * None of these characters belong in these files, anyway. (They can be used\n\t * in move descriptions, but those are served from `text.js`, which are\n\t * definitely always treated as unsanitized.)\n\t */\n\tsanitizeName(name: any) {\n\t\tif (!name) return '';\n\t\treturn ('' + name)\n\t\t\t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;')\n\t\t\t.slice(0, 50);\n\t}\n\n\tprefs(prop: string) {\n\t\t// @ts-ignore\n\t\treturn window.Storage?.prefs?.(prop);\n\t}\n\n\tgetShortName(name: string) {\n\t\tlet shortName = name.replace(/[^A-Za-z0-9]+$/, '');\n\t\tif (shortName.indexOf('(') >= 0) {\n\t\t\tshortName += name.slice(shortName.length).replace(/[^\\(\\)]+/g, '').replace(/\\(\\)/g, '');\n\t\t}\n\t\treturn shortName;\n\t}\n\n\tgetEffect(name: string | null | undefined): PureEffect | Item | Ability | Move {\n\t\tname = (name || '').trim();\n\t\tif (name.substr(0, 5) === 'item:') {\n\t\t\treturn Dex.items.get(name.substr(5).trim());\n\t\t} else if (name.substr(0, 8) === 'ability:') {\n\t\t\treturn Dex.abilities.get(name.substr(8).trim());\n\t\t} else if (name.substr(0, 5) === 'move:') {\n\t\t\treturn Dex.moves.get(name.substr(5).trim());\n\t\t}\n\t\tlet id = toID(name);\n\t\treturn new PureEffect(id, name);\n\t}\n\n\tmoves = {\n\t\tget: (nameOrMove: string | Move | null | undefined): Move => {\n\t\t\tif (nameOrMove && typeof nameOrMove !== 'string') {\n\t\t\t\t// TODO: don't accept Moves here\n\t\t\t\treturn nameOrMove;\n\t\t\t}\n\t\t\tlet name = nameOrMove || '';\n\t\t\tlet id = toID(nameOrMove);\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\t\tname = BattleAliases[id];\n\t\t\t\tid = toID(name);\n\t\t\t}\n\t\t\tif (!window.BattleMovedex) window.BattleMovedex = {};\n\t\t\tlet data = window.BattleMovedex[id];\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\n\n\t\t\tif (!data && id.substr(0, 11) === 'hiddenpower' && id.length > 11) {\n\t\t\t\tlet [, hpWithType, hpPower] = /([a-z]*)([0-9]*)/.exec(id)!;\n\t\t\t\tdata = {\n\t\t\t\t\t...(window.BattleMovedex[hpWithType] || {}),\n\t\t\t\t\tbasePower: Number(hpPower) || 60,\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (!data && id.substr(0, 6) === 'return' && id.length > 6) {\n\t\t\t\tdata = {\n\t\t\t\t\t...(window.BattleMovedex['return'] || {}),\n\t\t\t\t\tbasePower: Number(id.slice(6)),\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (!data && id.substr(0, 11) === 'frustration' && id.length > 11) {\n\t\t\t\tdata = {\n\t\t\t\t\t...(window.BattleMovedex['frustration'] || {}),\n\t\t\t\t\tbasePower: Number(id.slice(11)),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!data) data = {exists: false};\n\t\t\tlet move = new Move(id, name, data);\n\t\t\twindow.BattleMovedex[id] = move;\n\t\t\treturn move;\n\t\t},\n\t};\n\n\tgetGen3Category(type: string) {\n\t\treturn [\n\t\t\t'Fire', 'Water', 'Grass', 'Electric', 'Ice', 'Psychic', 'Dark', 'Dragon',\n\t\t].includes(type) ? 'Special' : 'Physical';\n\t}\n\n\titems = {\n\t\tget: (nameOrItem: string | Item | null | undefined): Item => {\n\t\t\tif (nameOrItem && typeof nameOrItem !== 'string') {\n\t\t\t\t// TODO: don't accept Items here\n\t\t\t\treturn nameOrItem;\n\t\t\t}\n\t\t\tlet name = nameOrItem || '';\n\t\t\tlet id = toID(nameOrItem);\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\t\tname = BattleAliases[id];\n\t\t\t\tid = toID(name);\n\t\t\t}\n\t\t\tif (!window.BattleItems) window.BattleItems = {};\n\t\t\tlet data = window.BattleItems[id];\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\n\t\t\tif (!data) data = {exists: false};\n\t\t\tlet item = new Item(id, name, data);\n\t\t\twindow.BattleItems[id] = item;\n\t\t\treturn item;\n\t\t},\n\t};\n\n\tabilities = {\n\t\tget: (nameOrAbility: string | Ability | null | undefined): Ability => {\n\t\t\tif (nameOrAbility && typeof nameOrAbility !== 'string') {\n\t\t\t\t// TODO: don't accept Abilities here\n\t\t\t\treturn nameOrAbility;\n\t\t\t}\n\t\t\tlet name = nameOrAbility || '';\n\t\t\tlet id = toID(nameOrAbility);\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\t\tname = BattleAliases[id];\n\t\t\t\tid = toID(name);\n\t\t\t}\n\t\t\tif (!window.BattleAbilities) window.BattleAbilities = {};\n\t\t\tlet data = window.BattleAbilities[id];\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\n\t\t\tif (!data) data = {exists: false};\n\t\t\tlet ability = new Ability(id, name, data);\n\t\t\twindow.BattleAbilities[id] = ability;\n\t\t\treturn ability;\n\t\t},\n\t};\n\n\tspecies = {\n\t\tget: (nameOrSpecies: string | Species | null | undefined): Species => {\n\t\t\tif (nameOrSpecies && typeof nameOrSpecies !== 'string') {\n\t\t\t\t// TODO: don't accept Species' here\n\t\t\t\treturn nameOrSpecies;\n\t\t\t}\n\t\t\tlet name = nameOrSpecies || '';\n\t\t\tlet id = toID(nameOrSpecies);\n\t\t\tlet formid = id;\n\t\t\tif (!window.BattlePokedexAltForms) window.BattlePokedexAltForms = {};\n\t\t\tif (formid in window.BattlePokedexAltForms) return window.BattlePokedexAltForms[formid];\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\t\tname = BattleAliases[id];\n\t\t\t\tid = toID(name);\n\t\t\t} else if (window.BattlePokedex && !(id in BattlePokedex) && window.BattleBaseSpeciesChart) {\n\t\t\t\tfor (const baseSpeciesId of BattleBaseSpeciesChart) {\n\t\t\t\t\tif (formid.startsWith(baseSpeciesId)) {\n\t\t\t\t\t\tid = baseSpeciesId;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!window.BattlePokedex) window.BattlePokedex = {};\n\t\t\tlet data = window.BattlePokedex[id];\n\n\t\t\tlet species: Species;\n\t\t\tif (data && typeof data.exists === 'boolean') {\n\t\t\t\tspecies = data;\n\t\t\t} else {\n\t\t\t\tif (!data) data = {exists: false};\n\t\t\t\tif (!data.tier && id.slice(-5) === 'totem') {\n\t\t\t\t\tdata.tier = this.species.get(id.slice(0, -5)).tier;\n\t\t\t\t}\n\t\t\t\tif (!data.tier && data.baseSpecies && toID(data.baseSpecies) !== id) {\n\t\t\t\t\tdata.tier = this.species.get(data.baseSpecies).tier;\n\t\t\t\t}\n\t\t\t\tspecies = new Species(id, name, data);\n\t\t\t\twindow.BattlePokedex[id] = species;\n\t\t\t}\n\n\t\t\tif (species.cosmeticFormes) {\n\t\t\t\tfor (const forme of species.cosmeticFormes) {\n\t\t\t\t\tif (toID(forme) === formid) {\n\t\t\t\t\t\tspecies = new Species(formid, name, {\n\t\t\t\t\t\t\t...species,\n\t\t\t\t\t\t\tname: forme,\n\t\t\t\t\t\t\tforme: forme.slice(species.name.length + 1),\n\t\t\t\t\t\t\tbaseForme: \"\",\n\t\t\t\t\t\t\tbaseSpecies: species.name,\n\t\t\t\t\t\t\totherFormes: null,\n\t\t\t\t\t\t});\n\t\t\t\t\t\twindow.BattlePokedexAltForms[formid] = species;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn species;\n\t\t},\n\t};\n\n\ttypes = {\n\t\tallCache: null as Type[] | null,\n\t\tget: (type: any): Type => {\n\t\t\tif (!type || typeof type === 'string') {\n\t\t\t\tconst id = toID(type) as string;\n\t\t\t\tconst name = id.substr(0, 1).toUpperCase() + id.substr(1);\n\t\t\t\ttype = (window.BattleTypeChart && window.BattleTypeChart[id]) || {};\n\t\t\t\tif (type.damageTaken) type.exists = true;\n\t\t\t\tif (!type.id) type.id = id;\n\t\t\t\tif (!type.name) type.name = name;\n\t\t\t\tif (!type.effectType) {\n\t\t\t\t\ttype.effectType = 'Type';\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn type;\n\t\t},\n\t\tall: (): readonly Type[] => {\n\t\t\tif (this.types.allCache) return this.types.allCache;\n\t\t\tconst types = [];\n\t\t\tfor (const id in (window.BattleTypeChart || {})) {\n\t\t\t\ttypes.push(Dex.types.get(id));\n\t\t\t}\n\t\t\tif (types.length) this.types.allCache = types;\n\t\t\treturn types;\n\t\t},\n\t\tisName: (name: string | null): boolean => {\n\t\t\tconst id = toID(name);\n\t\t\tif (name !== id.substr(0, 1).toUpperCase() + id.substr(1)) return false;\n\t\t\treturn (window.BattleTypeChart || {}).hasOwnProperty(id);\n\t\t},\n\t};\n\n\thasAbility(species: Species, ability: string) {\n\t\tfor (const i in species.abilities) {\n\t\t\t// @ts-ignore\n\t\t\tif (ability === species.abilities[i]) return true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tloadSpriteData(gen: 'xy' | 'bw') {\n\t\tif (this.loadedSpriteData[gen]) return;\n\t\tthis.loadedSpriteData[gen] = 1;\n\n\t\tlet path = $('script[src*=\"pokedex-mini.js\"]').attr('src') || '';\n\t\tlet qs = '?' + (path.split('?')[1] || '');\n\t\tpath = (path.match(/.+?(?=data\\/pokedex-mini\\.js)/) || [])[0] || '';\n\n\t\tlet el = document.createElement('script');\n\t\tel.src = path + 'data/pokedex-mini-bw.js' + qs;\n\t\tdocument.getElementsByTagName('body')[0].appendChild(el);\n\t}\n\tgetSpriteData(pokemon: Pokemon | Species | string, isFront: boolean, options: {\n\t\tgen?: number,\n\t\tshiny?: boolean,\n\t\tgender?: GenderName,\n\t\tafd?: boolean,\n\t\tnoScale?: boolean,\n\t\tmod?: string,\n\t\tdynamax?: boolean,\n\t} = {gen: 6}) {\n\t\tconst mechanicsGen = options.gen || 6;\n\t\tlet isDynamax = !!options.dynamax;\n\t\tif (pokemon instanceof Pokemon) {\n\t\t\tif (pokemon.volatiles.transform) {\n\t\t\t\toptions.shiny = pokemon.volatiles.transform[2];\n\t\t\t\toptions.gender = pokemon.volatiles.transform[3];\n\t\t\t} else {\n\t\t\t\toptions.shiny = pokemon.shiny;\n\t\t\t\toptions.gender = pokemon.gender;\n\t\t\t}\n\t\t\tlet isGigantamax = false;\n\t\t\tif (pokemon.volatiles.dynamax) {\n\t\t\t\tif (pokemon.volatiles.dynamax[1]) {\n\t\t\t\t\tisGigantamax = true;\n\t\t\t\t} else if (options.dynamax !== false) {\n\t\t\t\t\tisDynamax = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tpokemon = pokemon.getSpeciesForme() + (isGigantamax ? '-Gmax' : '');\n\t\t}\n\t\tconst species = Dex.species.get(pokemon);\n\t\t// Gmax sprites are already extremely large, so we don't need to double.\n\t\tif (species.name.endsWith('-Gmax')) isDynamax = false;\n\t\tlet spriteData = {\n\t\t\tgen: mechanicsGen,\n\t\t\tw: 96,\n\t\t\th: 96,\n\t\t\ty: 0,\n\t\t\turl: Dex.resourcePrefix + 'sprites/',\n\t\t\tpixelated: true,\n\t\t\tisFrontSprite: false,\n\t\t\tcryurl: '',\n\t\t\tshiny: options.shiny,\n\t\t};\n\t\tlet name = species.spriteid;\n\t\tlet dir;\n\t\tlet facing;\n\t\tif (isFront) {\n\t\t\tspriteData.isFrontSprite = true;\n\t\t\tdir = '';\n\t\t\tfacing = 'front';\n\t\t} else {\n\t\t\tdir = '-back';\n\t\t\tfacing = 'back';\n\t\t}\n\n\t\t// Decide which gen sprites to use.\n\t\t//\n\t\t// There are several different generations we care about here:\n\t\t//\n\t\t//   - mechanicsGen: the generation number of the mechanics and battle (options.gen)\n\t\t//   - graphicsGen: the generation number of sprite/field graphics the user has requested.\n\t\t//     This will default to mechanicsGen, but may be altered depending on user preferences.\n\t\t//   - spriteData.gen: the generation number of a the specific Pokemon sprite in question.\n\t\t//     This defaults to graphicsGen, but if the graphicsGen doesn't have a sprite for the Pokemon\n\t\t//     (eg. Darmanitan in graphicsGen 2) then we go up gens until it exists.\n\t\t//\n\t\tlet graphicsGen = mechanicsGen;\n\t\tif (Dex.prefs('nopastgens')) graphicsGen = 6;\n\t\tif (Dex.prefs('bwgfx') && graphicsGen >= 6) graphicsGen = 5;\n\t\tspriteData.gen = Math.max(graphicsGen, Math.min(species.gen, 5));\n\t\tconst baseDir = ['', 'gen1', 'gen2', 'gen3', 'gen4', 'gen5', '', '', '', ''][spriteData.gen];\n\n\t\tlet animationData = null;\n\t\tlet miscData = null;\n\t\tlet speciesid = species.id;\n\t\tif (species.isTotem) speciesid = toID(name);\n\t\tif (baseDir === '' && window.BattlePokemonSprites) {\n\t\t\tanimationData = BattlePokemonSprites[speciesid];\n\t\t}\n\t\tif (baseDir === 'gen5' && window.BattlePokemonSpritesBW) {\n\t\t\tanimationData = BattlePokemonSpritesBW[speciesid];\n\t\t}\n\t\tif (window.BattlePokemonSprites) miscData = BattlePokemonSprites[speciesid];\n\t\tif (!miscData && window.BattlePokemonSpritesBW) miscData = BattlePokemonSpritesBW[speciesid];\n\t\tif (!animationData) animationData = {};\n\t\tif (!miscData) miscData = {};\n\n\t\tif (miscData.num !== 0 && miscData.num > -5000) {\n\t\t\tlet baseSpeciesid = toID(species.baseSpecies);\n\t\t\tspriteData.cryurl = 'audio/cries/' + baseSpeciesid;\n\t\t\tlet formeid = species.formeid;\n\t\t\tif (species.isMega || formeid && (\n\t\t\t\tformeid === '-crowned' ||\n\t\t\t\tformeid === '-eternal' ||\n\t\t\t\tformeid === '-eternamax' ||\n\t\t\t\tformeid === '-hangry' ||\n\t\t\t\tformeid === '-lowkey' ||\n\t\t\t\tformeid === '-noice' ||\n\t\t\t\tformeid === '-primal' ||\n\t\t\t\tformeid === '-rapidstrike' ||\n\t\t\t\tformeid === '-school' ||\n\t\t\t\tformeid === '-sky' ||\n\t\t\t\tformeid === '-starter' ||\n\t\t\t\tformeid === '-super' ||\n\t\t\t\tformeid === '-therian' ||\n\t\t\t\tformeid === '-unbound' ||\n\t\t\t\tbaseSpeciesid === 'calyrex' ||\n\t\t\t\tbaseSpeciesid === 'kyurem' ||\n\t\t\t\tbaseSpeciesid === 'cramorant' ||\n\t\t\t\tbaseSpeciesid === 'indeedee' ||\n\t\t\t\tbaseSpeciesid === 'lycanroc' ||\n\t\t\t\tbaseSpeciesid === 'necrozma' ||\n\t\t\t\tbaseSpeciesid === 'oricorio' ||\n\t\t\t\tbaseSpeciesid === 'slowpoke' ||\n\t\t\t\tbaseSpeciesid === 'zygarde'\n\t\t\t)) {\n\t\t\t\tspriteData.cryurl += formeid;\n\t\t\t}\n\t\t\tspriteData.cryurl += '.mp3';\n\t\t}\n\n\t\tif (options.shiny && mechanicsGen > 1) dir += '-shiny';\n\n\t\t// April Fool's 2014\n\t\tif (window.Config && Config.server && Config.server.afd || options.afd) {\n\t\t\tdir = 'afd' + dir;\n\t\t\tspriteData.url += dir + '/' + name + '.png';\n\t\t\t// Duplicate code but needed to make AFD tinymax work\n\t\t\t// April Fool's 2020\n\t\t\tif (isDynamax && !options.noScale) {\n\t\t\t\tspriteData.w *= 0.25;\n\t\t\t\tspriteData.h *= 0.25;\n\t\t\t\tspriteData.y += -22;\n\t\t\t} else if (species.isTotem && !options.noScale) {\n\t\t\t\tspriteData.w *= 0.5;\n\t\t\t\tspriteData.h *= 0.5;\n\t\t\t\tspriteData.y += -11;\n\t\t\t}\n\t\t\treturn spriteData;\n\t\t}\n\n\t\t// Mod Cries\n\t\tif (options.mod) {\n\t\t\tspriteData.cryurl = `sprites/${options.mod}/audio/${toID(species.baseSpecies)}`;\n\t\t\tspriteData.cryurl += '.mp3';\n\t\t}\n\n\t\tif (animationData[facing + 'f'] && options.gender === 'F') facing += 'f';\n\t\tlet allowAnim = !Dex.prefs('noanim') && !Dex.prefs('nogif');\n\t\tif (allowAnim && spriteData.gen >= 6) spriteData.pixelated = false;\n\t\tif (allowAnim && animationData[facing] && spriteData.gen >= 5) {\n\t\t\tif (facing.slice(-1) === 'f') name += '-f';\n\t\t\tdir = baseDir + 'ani' + dir;\n\n\t\t\tspriteData.w = animationData[facing].w;\n\t\t\tspriteData.h = animationData[facing].h;\n\t\t\tspriteData.url += dir + '/' + name + '.gif';\n\t\t} else {\n\t\t\t// There is no entry or enough data in pokedex-mini.js\n\t\t\t// Handle these in case-by-case basis; either using BW sprites or matching the played gen.\n\t\t\tdir = (baseDir || 'gen5') + dir;\n\n\t\t\t// Gender differences don't exist prior to Gen 4,\n\t\t\t// so there are no sprites for it\n\t\t\tif (spriteData.gen >= 4 && miscData['frontf'] && options.gender === 'F') {\n\t\t\t\tname += '-f';\n\t\t\t}\n\n\t\t\tspriteData.url += dir + '/' + name + '.png';\n\t\t}\n\n\t\tif (!options.noScale) {\n\t\t\tif (graphicsGen > 4) {\n\t\t\t\t// no scaling\n\t\t\t} else if (spriteData.isFrontSprite) {\n\t\t\t\tspriteData.w *= 2;\n\t\t\t\tspriteData.h *= 2;\n\t\t\t\tspriteData.y += -16;\n\t\t\t} else {\n\t\t\t\t// old gen backsprites are multiplied by 1.5x by the 3D engine\n\t\t\t\tspriteData.w *= 2 / 1.5;\n\t\t\t\tspriteData.h *= 2 / 1.5;\n\t\t\t\tspriteData.y += -11;\n\t\t\t}\n\t\t\tif (spriteData.gen <= 2) spriteData.y += 2;\n\t\t}\n\t\tif (isDynamax && !options.noScale) {\n\t\t\tspriteData.w *= 2;\n\t\t\tspriteData.h *= 2;\n\t\t\tspriteData.y += -22;\n\t\t} else if (species.isTotem && !options.noScale) {\n\t\t\tspriteData.w *= 1.5;\n\t\t\tspriteData.h *= 1.5;\n\t\t\tspriteData.y += -11;\n\t\t}\n\n\t\treturn spriteData;\n\t}\n\n\tgetPokemonIconNum(id: ID, isFemale?: boolean, facingLeft?: boolean) {\n\t\tlet num = 0;\n\t\tif (window.BattlePokemonSprites?.[id]?.num) {\n\t\t\tnum = BattlePokemonSprites[id].num;\n\t\t} else if (window.BattlePokedex?.[id]?.num) {\n\t\t\tnum = BattlePokedex[id].num;\n\t\t}\n\t\tif (num < 0) num = 0;\n\t\tif (num > 1010) num = 0;\n\n\t\tif (window.BattlePokemonIconIndexes?.[id]) {\n\t\t\tnum = BattlePokemonIconIndexes[id];\n\t\t}\n\n\t\tif (isFemale) {\n\t\t\tif (['unfezant', 'frillish', 'jellicent', 'meowstic', 'pyroar'].includes(id)) {\n\t\t\t\tnum = BattlePokemonIconIndexes[id + 'f'];\n\t\t\t}\n\t\t}\n\t\tif (facingLeft) {\n\t\t\tif (BattlePokemonIconIndexesLeft[id]) {\n\t\t\t\tnum = BattlePokemonIconIndexesLeft[id];\n\t\t\t}\n\t\t}\n\t\treturn num;\n\t}\n\n\tgetPokemonIcon(pokemon: string | Pokemon | ServerPokemon | PokemonSet | null, facingLeft?: boolean) {\n\t\tif (pokemon === 'pokeball') {\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -0px 4px`;\n\t\t} else if (pokemon === 'pokeball-statused') {\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -40px 4px`;\n\t\t} else if (pokemon === 'pokeball-fainted') {\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -80px 4px;opacity:.4;filter:contrast(0)`;\n\t\t} else if (pokemon === 'pokeball-none') {\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -80px 4px`;\n\t\t}\n\n\t\tlet id = toID(pokemon);\n\t\tif (!pokemon || typeof pokemon === 'string') pokemon = null;\n\t\t// @ts-ignore\n\t\tif (pokemon?.speciesForme) id = toID(pokemon.speciesForme);\n\t\t// @ts-ignore\n\t\tif (pokemon?.species) id = toID(pokemon.species);\n\t\t// @ts-ignore\n\t\tif (pokemon?.volatiles?.formechange && !pokemon.volatiles.transform) {\n\t\t\t// @ts-ignore\n\t\t\tid = toID(pokemon.volatiles.formechange[1]);\n\t\t}\n\t\tlet num = this.getPokemonIconNum(id, pokemon?.gender === 'F', facingLeft);\n\n\t\tlet top = Math.floor(num / 12) * 30;\n\t\tlet left = (num % 12) * 40;\n\t\tlet fainted = ((pokemon as Pokemon | ServerPokemon)?.fainted ? `;opacity:.3;filter:grayscale(100%) brightness(.5)` : ``);\n\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-sheet.png?v10) no-repeat scroll -${left}px -${top}px${fainted}`;\n\t}\n\n\tgetTeambuilderSpriteData(pokemon: any, gen: number = 0): TeambuilderSpriteData {\n\t\tlet id = toID(pokemon.species);\n\t\tlet spriteid = pokemon.spriteid;\n\t\tlet species = Dex.species.get(pokemon.species);\n\t\tif (pokemon.species && !spriteid) {\n\t\t\tspriteid = species.spriteid || toID(pokemon.species);\n\t\t}\n\t\tif (species.exists === false) return { spriteDir: 'sprites/gen5', spriteid: '0', x: 10, y: 5 };\n\t\tconst spriteData: TeambuilderSpriteData = {\n\t\t\tspriteid,\n\t\t\tspriteDir: 'sprites/dex',\n\t\t\tx: -2,\n\t\t\ty: -3,\n\t\t};\n\t\tif (pokemon.shiny) spriteData.shiny = true;\n\t\tif (Dex.prefs('nopastgens')) gen = 6;\n\t\tif (Dex.prefs('bwgfx') && gen > 5) gen = 5;\n\t\tlet xydexExists = (!species.isNonstandard || species.isNonstandard === 'Past' || species.isNonstandard === 'CAP') || [\n\t\t\t\"pikachustarter\", \"eeveestarter\", \"meltan\", \"melmetal\", \"pokestarufo\", \"pokestarufo2\", \"pokestarbrycenman\", \"pokestarmt\", \"pokestarmt2\", \"pokestargiant\", \"pokestarhumanoid\", \"pokestarmonster\", \"pokestarf00\", \"pokestarf002\", \"pokestarspirit\",\n\t\t].includes(species.id);\n\t\tif (species.gen === 8 && species.isNonstandard !== 'CAP') xydexExists = false;\n\t\tif ((!gen || gen >= 6) && xydexExists) {\n\t\t\tif (species.gen >= 7) {\n\t\t\t\tspriteData.x = -6;\n\t\t\t\tspriteData.y = -7;\n\t\t\t} else if (id.substr(0, 6) === 'arceus') {\n\t\t\t\tspriteData.x = -2;\n\t\t\t\tspriteData.y = 7;\n\t\t\t} else if (id === 'garchomp') {\n\t\t\t\tspriteData.x = -2;\n\t\t\t\tspriteData.y = 2;\n\t\t\t} else if (id === 'garchompmega') {\n\t\t\t\tspriteData.x = -2;\n\t\t\t\tspriteData.y = 0;\n\t\t\t}\n\t\t\treturn spriteData;\n\t\t}\n\t\tspriteData.spriteDir = 'sprites/gen5';\n\t\tif (gen <= 1 && species.gen <= 1) spriteData.spriteDir = 'sprites/gen1';\n\t\telse if (gen <= 2 && species.gen <= 2) spriteData.spriteDir = 'sprites/gen2';\n\t\telse if (gen <= 3 && species.gen <= 3) spriteData.spriteDir = 'sprites/gen3';\n\t\telse if (gen <= 4 && species.gen <= 4) spriteData.spriteDir = 'sprites/gen4';\n\t\tspriteData.x = 10;\n\t\tspriteData.y = 5;\n\t\treturn spriteData;\n\t}\n\n\tgetTeambuilderSprite(pokemon: any, gen: number = 0) {\n\t\tif (!pokemon) return '';\n\t\tconst data = this.getTeambuilderSpriteData(pokemon, gen);\n\t\tconst shiny = (data.shiny ? '-shiny' : '');\n\t\treturn 'background-image:url(' + Dex.resourcePrefix + data.spriteDir + shiny + '/' + data.spriteid + '.png);background-position:' + data.x + 'px ' + data.y + 'px;background-repeat:no-repeat';\n\t}\n\n\tgetItemIcon(item: any) {\n\t\tlet num = 0;\n\t\tif (typeof item === 'string' && exports.BattleItems) item = exports.BattleItems[toID(item)];\n\t\tif (item?.spritenum) num = item.spritenum;\n\n\t\tlet top = Math.floor(num / 16) * 24;\n\t\tlet left = (num % 16) * 24;\n\t\treturn 'background:transparent url(' + Dex.resourcePrefix + 'sprites/itemicons-sheet.png?g9) no-repeat scroll -' + left + 'px -' + top + 'px';\n\t}\n\n\tgetTypeIcon(type: string | null, b?: boolean) { // b is just for utilichart.js\n\t\ttype = this.types.get(type).name;\n\t\tif (!type) type = '???';\n\t\tlet sanitizedType = type.replace(/\\?/g, '%3f');\n\t\treturn `<img src=\"${Dex.resourcePrefix}sprites/types/${sanitizedType}.png\" alt=\"${type}\" height=\"14\" width=\"32\" class=\"pixelated${b ? ' b' : ''}\" />`;\n\t}\n\n\tgetCategoryIcon(category: string | null) {\n\t\tconst categoryID = toID(category);\n\t\tlet sanitizedCategory = '';\n\t\tswitch (categoryID) {\n\t\tcase 'physical':\n\t\tcase 'special':\n\t\tcase 'status':\n\t\t\tsanitizedCategory = categoryID.charAt(0).toUpperCase() + categoryID.slice(1);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tsanitizedCategory = 'undefined';\n\t\t\tbreak;\n\t\t}\n\t\treturn `<img src=\"${Dex.resourcePrefix}sprites/categories/${sanitizedCategory}.png\" alt=\"${sanitizedCategory}\" height=\"14\" width=\"32\" class=\"pixelated\" />`;\n\t}\n\n\tgetPokeballs() {\n\t\tif (this.pokeballs) return this.pokeballs;\n\t\tthis.pokeballs = [];\n\t\tif (!window.BattleItems) window.BattleItems = {};\n\t\tfor (const data of Object.values(window.BattleItems) as AnyObject[]) {\n\t\t\tif (!data.isPokeball) continue;\n\t\t\tthis.pokeballs.push(data.name);\n\t\t}\n\t\treturn this.pokeballs;\n\t}\n};\n\nclass ModdedDex {\n\treadonly gen: number;\n\treadonly modid: ID;\n\treadonly cache = {\n\t\tMoves: {} as any as {[k: string]: Move},\n\t\tItems: {} as any as {[k: string]: Item},\n\t\tAbilities: {} as any as {[k: string]: Ability},\n\t\tSpecies: {} as any as {[k: string]: Species},\n\t\tTypes: {} as any as {[k: string]: Effect},\n\t};\n\tpokeballs: string[] | null = null;\n\tconstructor(modid: ID) {\n\t\tthis.modid = modid;\n\t\tconst gen = parseInt(modid.substr(3, 1), 10);\n\t\tif (!modid.startsWith('gen') || !gen) throw new Error(\"Unsupported modid\");\n\t\tthis.gen = gen;\n\t}\n\tmoves = {\n\t\tget: (name: string): Move => {\n\t\t\tlet id = toID(name);\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\t\tname = BattleAliases[id];\n\t\t\t\tid = toID(name);\n\t\t\t}\n\t\t\tif (this.cache.Moves.hasOwnProperty(id)) return this.cache.Moves[id];\n\n\t\t\tlet data = {...Dex.moves.get(name)};\n\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\n\t\t\t\tif (id in table.overrideMoveData) {\n\t\t\t\t\tObject.assign(data, table.overrideMoveData[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.modid !== `gen${this.gen}`) {\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\n\t\t\t\tif (id in table.overrideMoveData) {\n\t\t\t\t\tObject.assign(data, table.overrideMoveData[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.gen <= 3 && data.category !== 'Status') {\n\t\t\t\tdata.category = Dex.getGen3Category(data.type);\n\t\t\t}\n\n\t\t\tconst move = new Move(id, name, data);\n\t\t\tthis.cache.Moves[id] = move;\n\t\t\treturn move;\n\t\t},\n\t};\n\n\titems = {\n\t\tget: (name: string): Item => {\n\t\t\tlet id = toID(name);\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\t\tname = BattleAliases[id];\n\t\t\t\tid = toID(name);\n\t\t\t}\n\t\t\tif (this.cache.Items.hasOwnProperty(id)) return this.cache.Items[id];\n\n\t\t\tlet data = {...Dex.items.get(name)};\n\n\t\t\tfor (let i = this.gen; i < 9; i++) {\n\t\t\t\tconst table = window.BattleTeambuilderTable['gen' + i];\n\t\t\t\tif (id in table.overrideItemDesc) {\n\t\t\t\t\tdata.shortDesc = table.overrideItemDesc[id];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst item = new Item(id, name, data);\n\t\t\tthis.cache.Items[id] = item;\n\t\t\treturn item;\n\t\t},\n\t};\n\n\tabilities = {\n\t\tget: (name: string): Ability => {\n\t\t\tlet id = toID(name);\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\t\tname = BattleAliases[id];\n\t\t\t\tid = toID(name);\n\t\t\t}\n\t\t\tif (this.cache.Abilities.hasOwnProperty(id)) return this.cache.Abilities[id];\n\n\t\t\tlet data = {...Dex.abilities.get(name)};\n\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\n\t\t\t\tif (id in table.overrideAbilityData) {\n\t\t\t\t\tObject.assign(data, table.overrideAbilityData[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.modid !== `gen${this.gen}`) {\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\n\t\t\t\tif (id in table.overrideAbilityData) {\n\t\t\t\t\tObject.assign(data, table.overrideAbilityData[id]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst ability = new Ability(id, name, data);\n\t\t\tthis.cache.Abilities[id] = ability;\n\t\t\treturn ability;\n\t\t},\n\t};\n\n\tspecies = {\n\t\tget: (name: string): Species => {\n\t\t\tlet id = toID(name);\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\n\t\t\t\tname = BattleAliases[id];\n\t\t\t\tid = toID(name);\n\t\t\t}\n\t\t\tif (this.cache.Species.hasOwnProperty(id)) return this.cache.Species[id];\n\n\t\t\tlet data = {...Dex.species.get(name)};\n\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\n\t\t\t\tif (id in table.overrideSpeciesData) {\n\t\t\t\t\tObject.assign(data, table.overrideSpeciesData[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.modid !== `gen${this.gen}`) {\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\n\t\t\t\tif (id in table.overrideSpeciesData) {\n\t\t\t\t\tObject.assign(data, table.overrideSpeciesData[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.gen < 3 || this.modid === 'gen7letsgo') {\n\t\t\t\tdata.abilities = {0: \"No Ability\"};\n\t\t\t}\n\n\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\n\t\t\tif (id in table.overrideTier) data.tier = table.overrideTier[id];\n\t\t\tif (!data.tier && id.slice(-5) === 'totem') {\n\t\t\t\tdata.tier = this.species.get(id.slice(0, -5)).tier;\n\t\t\t}\n\t\t\tif (!data.tier && data.baseSpecies && toID(data.baseSpecies) !== id) {\n\t\t\t\tdata.tier = this.species.get(data.baseSpecies).tier;\n\t\t\t}\n\t\t\tif (data.gen > this.gen) data.tier = 'Illegal';\n\n\t\t\tconst species = new Species(id, name, data);\n\t\t\tthis.cache.Species[id] = species;\n\t\t\treturn species;\n\t\t},\n\t};\n\n\ttypes = {\n\t\tget: (name: string): Effect => {\n\t\t\tconst id = toID(name) as ID;\n\t\t\tname = id.substr(0, 1).toUpperCase() + id.substr(1);\n\n\t\t\tif (this.cache.Types.hasOwnProperty(id)) return this.cache.Types[id];\n\n\t\t\tlet data = {...Dex.types.get(name)};\n\n\t\t\tfor (let i = 7; i >= this.gen; i--) {\n\t\t\t\tconst table = window.BattleTeambuilderTable['gen' + i];\n\t\t\t\tif (id in table.removeType) {\n\t\t\t\t\tdata.exists = false;\n\t\t\t\t\t// don't bother correcting its attributes given it doesn't exist\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (id in table.overrideTypeChart) {\n\t\t\t\t\tdata = {...data, ...table.overrideTypeChart[id]};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.cache.Types[id] = data;\n\t\t\treturn data;\n\t\t},\n\t};\n\n\tgetPokeballs() {\n\t\tif (this.pokeballs) return this.pokeballs;\n\t\tthis.pokeballs = [];\n\t\tif (!window.BattleItems) window.BattleItems = {};\n\t\tfor (const data of Object.values(window.BattleItems) as AnyObject[]) {\n\t\t\tif (data.gen && data.gen > this.gen) continue;\n\t\t\tif (!data.isPokeball) continue;\n\t\t\tthis.pokeballs.push(data.name);\n\t\t}\n\t\treturn this.pokeballs;\n\t}\n}\n\nif (typeof require === 'function') {\n\t// in Node\n\t(global as any).Dex = Dex;\n\t(global as any).toID = toID;\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA,GAAI,MAAOA,OAAM,GAAK,WAAW,CAAE;;AAEjCC,MAAM,CAASD,MAAM,CAAGC,MAAM;AAChC,CAAC,IAAM;;AAEND,MAAM,CAACE,OAAO,CAAGF,MAAM;AACxB;;;AAGAA,MAAM,CAACG,UAAU,CAAG,CAAC,EAAE,MAAOC,QAAO,GAAK,WAAW,EAAIA,OAAO,CAACC,QAAQ,EAAID,OAAO,CAACC,QAAQ,CAAC,aAAa,CAAC,CAAC;;AAE7G,QAASC,KAAI,CAACC,IAAS,CAAE;AACxB,UAAIA,IAAI,SAAJ,MAAMC,EAAE,CAAE;AACbD,IAAI,CAAGA,IAAI,CAACC,EAAE;AACf,CAAC,IAAM,YAAID,IAAI,SAAJ,OAAME,MAAM,CAAE;AACxBF,IAAI,CAAGA,IAAI,CAACE,MAAM;AACnB;AACA,GAAI,MAAOF,KAAI,GAAK,QAAQ,EAAI,MAAOA,KAAI,GAAK,QAAQ,CAAE,MAAO,EAAE;AACnE,MAAO,CAAC,EAAE,CAAGA,IAAI,EAAEG,WAAW,EAAE,CAACC,OAAO,CAAC,aAAa,CAAE,EAAE,CAAC;AAC5D;;AAEA,QAASC,SAAQ,CAACL,IAAS,CAAE;AAC5B,MAAOD,KAAI,CAACC,IAAI,CAAC;AAClB;;;AAGA,GAAMM,QAAO,CAAG;;;;;;;;;;;AAWfC,UAAU,CAAV,oBAAWC,GAAW,CAAEC,SAAiB,CAAqB,IAAnBC,MAAa,2DAAG,CAAC;AAC3D,GAAIC,SAAkB,CAAG,EAAE;AAC3B,MAAOA,QAAQ,CAACC,MAAM,CAAGF,KAAK,CAAE;AAC/B,GAAIG,eAAc,CAAGL,GAAG,CAACM,OAAO,CAACL,SAAS,CAAC;AAC3C,GAAII,cAAc,EAAI,CAAC,CAAE;AACxBF,QAAQ,CAACI,IAAI,CAACP,GAAG,CAACQ,KAAK,CAAC,CAAC,CAAEH,cAAc,CAAC,CAAC;AAC3CL,GAAG,CAAGA,GAAG,CAACQ,KAAK,CAACH,cAAc,CAAGJ,SAAS,CAACG,MAAM,CAAC;AACnD,CAAC,IAAM;AACND,QAAQ,CAACI,IAAI,CAACP,GAAG,CAAC;AAClBA,GAAG,CAAG,EAAE;AACT;AACD;AACAG,QAAQ,CAACI,IAAI,CAACP,GAAG,CAAC;AAClB,MAAOG,SAAQ;AAChB,CAAC;;;;;;;;;;;;;AAaDM,OAAO,CAAP,iBAAQC,CAAa,CAAEC,CAAa,CAAU;AAC7C,GAAI,MAAOD,EAAC,GAAK,QAAQ,CAAE;AAC1B,MAAOA,EAAC,CAAIC,CAAY;AACzB;AACA,GAAI,MAAOD,EAAC,GAAK,QAAQ,CAAE;AAC1B,MAAOA,EAAC,CAACE,aAAa,CAACD,CAAC,CAAW;AACpC;AACA,GAAI,MAAOD,EAAC,GAAK,SAAS,CAAE;AAC3B,MAAO,CAACA,CAAC,CAAG,CAAC,CAAG,CAAC,GAAKC,CAAC,CAAG,CAAC,CAAG,CAAC,CAAC;AACjC;AACA,GAAIE,KAAK,CAACC,OAAO,CAACJ,CAAC,CAAC,CAAE;AACrB,IAAK,GAAIK,EAAC,CAAG,CAAC,CAAEA,CAAC,CAAGL,CAAC,CAACN,MAAM,CAAEW,CAAC,EAAE,CAAE;AAClC,GAAMC,WAAU,CAAGlB,OAAO,CAACW,OAAO,CAACC,CAAC,CAACK,CAAC,CAAC,CAAGJ,CAAC,CAAkBI,CAAC,CAAC,CAAC;AAChE,GAAIC,UAAU,CAAE,MAAOA,WAAU;AAClC;AACA,MAAO,EAAC;AACT;AACA,GAAIN,CAAC,CAACO,OAAO,CAAE;AACd,MAAOnB,QAAO,CAACW,OAAO,CAAEE,CAAC,CAAuBM,OAAO,CAAEP,CAAC,CAACO,OAAO,CAAC;AACpE;AACA,KAAM,IAAIC,MAAK,iBAAiBR,CAAC,sBAAqB;AACvD,CAAC;;;;;;;;;;;;;AAaDS,MAAM,CAAN,gBAAUC,KAAU,CAAEC,QAA+B,CAAE;AACtD,GAAI,CAACA,QAAQ,CAAE,MAAQD,MAAK,CAAWE,IAAI,CAACxB,OAAO,CAACW,OAAO,CAAC;AAC5D,MAAOW,MAAK,CAACE,IAAI,CAAC,SAACZ,CAAC,CAAEC,CAAC,QAAKb,QAAO,CAACW,OAAO,CAACY,QAAQ,CAACX,CAAC,CAAC,CAAEW,QAAQ,CAACV,CAAC,CAAC,CAAC,GAAC;AACvE,CAAC,qBACD;;;;;;;AAMD,QAASY,SAAQ,CAACC,MAAc,CAAE;AACjC,MAAOA,OAAM,CAAC5B,OAAO,CAAC,iBAAiB,CAAE,EAAE,CAAC,CAACD,WAAW,EAAE;AAC3D;;AAEA,QAAS8B,OAAM,CAACC,IAAS,CAAE;AAC1B,GAAI,MAAOA,KAAI,GAAK,QAAQ,EAAI,MAAOA,KAAI,GAAK,QAAQ,CAAE,MAAO,EAAE;AACnEA,IAAI,CAAG,CAAC,EAAE,CAAGA,IAAI,EAAE9B,OAAO,CAAC,sBAAsB,CAAE,GAAG,CAAC,CAAC+B,IAAI,EAAE;AAC9D,GAAID,IAAI,CAACtB,MAAM,CAAG,EAAE,CAAEsB,IAAI,CAAGA,IAAI,CAACE,MAAM,CAAC,CAAC,CAAE,EAAE,CAAC,CAACD,IAAI,EAAE;;;AAGtDD,IAAI,CAAGA,IAAI,CAAC9B,OAAO;AAClB,6HAA6H;AAC7H,EAAE,CACF;;AACD8B,IAAI,CAAGA,IAAI,CAAC9B,OAAO,CAAC,kBAAkB,CAAE,EAAE,CAAC;;AAE3C,MAAO8B,KAAI;AACZ;;;;;;;;;;;;;;;;;;;;;;;AAuBA,GAAMG,IAAG,CAAG;AACFC,GAAG,CAAG,CAAC;AACPC,KAAK,CAAG,MAAM;AACdC,KAAK,CAAG,IAAI;;AAEZC,SAAS,CAA4B,CAAC,IAAI,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAC;AAC9EC,iBAAiB,CAAoC,CAAC,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAC;;AAEjGC,SAAS,CAAoB,IAAI;;AAEjCC,cAAc,CAAI,UAAM;AACvB,GAAIC,OAAM,CAAG,EAAE;AACf,GAAI,mBAAApD,MAAM,CAACqD,QAAQ,sCAAf,iBAAiBC,QAAQ,eAAzB,sBAA2BC,QAAQ,IAAK,OAAO,CAAEH,MAAM,CAAG,QAAQ;AACtE,MAAUA,OAAM,OAAKpD,MAAM,CAACwD,MAAM,CAAGA,MAAM,CAACC,MAAM,CAACC,MAAM,CAAG,0BAA0B;AACvF,CAAC,EAAG;;AAEJC,QAAQ,CAAI,UAAM;AACjB,GAAMJ,SAAQ,CAAI,oBAAAvD,MAAM,CAACqD,QAAQ,sCAAf,kBAAiBC,QAAQ,eAAzB,sBAA2BC,QAAQ,IAAK,OAAO,CAAI,QAAQ,CAAG,EAAE;AAClF,MAAUA,SAAQ,OAAKvD,MAAM,CAACwD,MAAM,CAAGA,MAAM,CAACC,MAAM,CAACC,MAAM,CAAG,0BAA0B;AACzF,CAAC,EAAG;;AAEJE,gBAAgB,CAAG,CAACC,EAAE,CAAE,CAAC,CAAEC,EAAE,CAAE,CAAC,CAAC;AACjCC,WAAW,CAA+B,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4E5CC,KAAK,CAAG;AACPC,GAAG,CAAE,SAACC,UAA4C,CAAW;AAC5D,GAAIA,UAAU,EAAI,MAAOA,WAAU,GAAK,QAAQ,CAAE;;AAEjD,MAAOA,WAAU;AAClB;AACA,GAAIzB,KAAI,CAAGyB,UAAU,EAAI,EAAE;AAC3B,GAAI1D,GAAE,CAAGF,IAAI,CAAC4D,UAAU,CAAC;AACzB,GAAIlE,MAAM,CAACmE,aAAa,EAAI3D,EAAE,GAAI2D,cAAa,CAAE;AAChD1B,IAAI,CAAG0B,aAAa,CAAC3D,EAAE,CAAC;AACxBA,EAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AAChB;AACA,GAAI,CAACzC,MAAM,CAACoE,aAAa,CAAEpE,MAAM,CAACoE,aAAa,CAAG,CAAC,CAAC;AACpD,GAAIC,KAAI,CAAGrE,MAAM,CAACoE,aAAa,CAAC5D,EAAE,CAAC;AACnC,GAAI6D,IAAI,EAAI,MAAOA,KAAI,CAACC,MAAM,GAAK,SAAS,CAAE,MAAOD,KAAI;;AAEzD,GAAI,CAACA,IAAI,EAAI7D,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAE,EAAE,CAAC,GAAK,aAAa,EAAInC,EAAE,CAACW,MAAM,CAAG,EAAE,CAAE;AAClE,SAA8B,kBAAkB,CAACoD,IAAI,CAAC/D,EAAE,CAAC,CAAlDgE,UAAU,SAAEC,OAAO;AAC1BJ,IAAI;AACCrE,MAAM,CAACoE,aAAa,CAACI,UAAU,CAAC,EAAI,CAAC,CAAC;AAC1CE,SAAS,CAAEC,MAAM,CAACF,OAAO,CAAC,EAAI,EAAE,EAChC;;AACF;AACA,GAAI,CAACJ,IAAI,EAAI7D,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,GAAK,QAAQ,EAAInC,EAAE,CAACW,MAAM,CAAG,CAAC,CAAE;AAC3DkD,IAAI;AACCrE,MAAM,CAACoE,aAAa,CAAC,QAAQ,CAAC,EAAI,CAAC,CAAC;AACxCM,SAAS,CAAEC,MAAM,CAACnE,EAAE,CAACe,KAAK,CAAC,CAAC,CAAC,CAAC,EAC9B;;AACF;AACA,GAAI,CAAC8C,IAAI,EAAI7D,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAE,EAAE,CAAC,GAAK,aAAa,EAAInC,EAAE,CAACW,MAAM,CAAG,EAAE,CAAE;AAClEkD,IAAI;AACCrE,MAAM,CAACoE,aAAa,CAAC,aAAa,CAAC,EAAI,CAAC,CAAC;AAC7CM,SAAS,CAAEC,MAAM,CAACnE,EAAE,CAACe,KAAK,CAAC,EAAE,CAAC,CAAC,EAC/B;;AACF;;AAEA,GAAI,CAAC8C,IAAI,CAAEA,IAAI,CAAG,CAACC,MAAM,CAAE,KAAK,CAAC;AACjC,GAAIM,KAAI,CAAG,GAAIC,KAAI,CAACrE,EAAE,CAAEiC,IAAI,CAAE4B,IAAI,CAAC;AACnCrE,MAAM,CAACoE,aAAa,CAAC5D,EAAE,CAAC,CAAGoE,IAAI;AAC/B,MAAOA,KAAI;AACZ;AACD,CAAC;;;;;;;;AAQDE,KAAK,CAAG;AACPb,GAAG,CAAE,SAACc,UAA4C,CAAW;AAC5D,GAAIA,UAAU,EAAI,MAAOA,WAAU,GAAK,QAAQ,CAAE;;AAEjD,MAAOA,WAAU;AAClB;AACA,GAAItC,KAAI,CAAGsC,UAAU,EAAI,EAAE;AAC3B,GAAIvE,GAAE,CAAGF,IAAI,CAACyE,UAAU,CAAC;AACzB,GAAI/E,MAAM,CAACmE,aAAa,EAAI3D,EAAE,GAAI2D,cAAa,CAAE;AAChD1B,IAAI,CAAG0B,aAAa,CAAC3D,EAAE,CAAC;AACxBA,EAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AAChB;AACA,GAAI,CAACzC,MAAM,CAACgF,WAAW,CAAEhF,MAAM,CAACgF,WAAW,CAAG,CAAC,CAAC;AAChD,GAAIX,KAAI,CAAGrE,MAAM,CAACgF,WAAW,CAACxE,EAAE,CAAC;AACjC,GAAI6D,IAAI,EAAI,MAAOA,KAAI,CAACC,MAAM,GAAK,SAAS,CAAE,MAAOD,KAAI;AACzD,GAAI,CAACA,IAAI,CAAEA,IAAI,CAAG,CAACC,MAAM,CAAE,KAAK,CAAC;AACjC,GAAIW,KAAI,CAAG,GAAIC,KAAI,CAAC1E,EAAE,CAAEiC,IAAI,CAAE4B,IAAI,CAAC;AACnCrE,MAAM,CAACgF,WAAW,CAACxE,EAAE,CAAC,CAAGyE,IAAI;AAC7B,MAAOA,KAAI;AACZ;AACD,CAAC;;AAEDE,SAAS,CAAG;AACXlB,GAAG,CAAE,SAACmB,aAAkD,CAAc;AACrE,GAAIA,aAAa,EAAI,MAAOA,cAAa,GAAK,QAAQ,CAAE;;AAEvD,MAAOA,cAAa;AACrB;AACA,GAAI3C,KAAI,CAAG2C,aAAa,EAAI,EAAE;AAC9B,GAAI5E,GAAE,CAAGF,IAAI,CAAC8E,aAAa,CAAC;AAC5B,GAAIpF,MAAM,CAACmE,aAAa,EAAI3D,EAAE,GAAI2D,cAAa,CAAE;AAChD1B,IAAI,CAAG0B,aAAa,CAAC3D,EAAE,CAAC;AACxBA,EAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AAChB;AACA,GAAI,CAACzC,MAAM,CAACqF,eAAe,CAAErF,MAAM,CAACqF,eAAe,CAAG,CAAC,CAAC;AACxD,GAAIhB,KAAI,CAAGrE,MAAM,CAACqF,eAAe,CAAC7E,EAAE,CAAC;AACrC,GAAI6D,IAAI,EAAI,MAAOA,KAAI,CAACC,MAAM,GAAK,SAAS,CAAE,MAAOD,KAAI;AACzD,GAAI,CAACA,IAAI,CAAEA,IAAI,CAAG,CAACC,MAAM,CAAE,KAAK,CAAC;AACjC,GAAIgB,QAAO,CAAG,GAAIC,QAAO,CAAC/E,EAAE,CAAEiC,IAAI,CAAE4B,IAAI,CAAC;AACzCrE,MAAM,CAACqF,eAAe,CAAC7E,EAAE,CAAC,CAAG8E,OAAO;AACpC,MAAOA,QAAO;AACf;AACD,CAAC;;AAEDE,OAAO,CAAG;AACTvB,GAAG,CAAE,SAACwB,aAAkD,CAAc;AACrE,GAAIA,aAAa,EAAI,MAAOA,cAAa,GAAK,QAAQ,CAAE;;AAEvD,MAAOA,cAAa;AACrB;AACA,GAAIhD,KAAI,CAAGgD,aAAa,EAAI,EAAE;AAC9B,GAAIjF,GAAE,CAAGF,IAAI,CAACmF,aAAa,CAAC;AAC5B,GAAIC,OAAM,CAAGlF,EAAE;AACf,GAAI,CAACR,MAAM,CAAC2F,qBAAqB,CAAE3F,MAAM,CAAC2F,qBAAqB,CAAG,CAAC,CAAC;AACpE,GAAID,MAAM,GAAI1F,OAAM,CAAC2F,qBAAqB,CAAE,MAAO3F,OAAM,CAAC2F,qBAAqB,CAACD,MAAM,CAAC;AACvF,GAAI1F,MAAM,CAACmE,aAAa,EAAI3D,EAAE,GAAI2D,cAAa,CAAE;AAChD1B,IAAI,CAAG0B,aAAa,CAAC3D,EAAE,CAAC;AACxBA,EAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AAChB,CAAC,IAAM,IAAIzC,MAAM,CAAC4F,aAAa,EAAI,EAAEpF,EAAE,GAAIoF,cAAa,CAAC,EAAI5F,MAAM,CAAC6F,sBAAsB,CAAE;AAC/DA,sBAAsB,sCAAE,CAA/C,GAAMC,cAAa;AACvB,GAAIJ,MAAM,CAACK,UAAU,CAACD,aAAa,CAAC,CAAE;AACrCtF,EAAE,CAAGsF,aAAa;AAClB;AACD;AACD;AACD;AACA,GAAI,CAAC9F,MAAM,CAAC4F,aAAa,CAAE5F,MAAM,CAAC4F,aAAa,CAAG,CAAC,CAAC;AACpD,GAAIvB,KAAI,CAAGrE,MAAM,CAAC4F,aAAa,CAACpF,EAAE,CAAC;;AAEnC,GAAIgF,QAAgB;AACpB,GAAInB,IAAI,EAAI,MAAOA,KAAI,CAACC,MAAM,GAAK,SAAS,CAAE;AAC7CkB,OAAO,CAAGnB,IAAI;AACf,CAAC,IAAM;AACN,GAAI,CAACA,IAAI,CAAEA,IAAI,CAAG,CAACC,MAAM,CAAE,KAAK,CAAC;AACjC,GAAI,CAACD,IAAI,CAAC2B,IAAI,EAAIxF,EAAE,CAACe,KAAK,CAAC,CAAC,CAAC,CAAC,GAAK,OAAO,CAAE;AAC3C8C,IAAI,CAAC2B,IAAI,CAAG,KAAI,CAACR,OAAO,CAACvB,GAAG,CAACzD,EAAE,CAACe,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,CAAC,CAACyE,IAAI;AACnD;AACA,GAAI,CAAC3B,IAAI,CAAC2B,IAAI,EAAI3B,IAAI,CAAC4B,WAAW,EAAI3F,IAAI,CAAC+D,IAAI,CAAC4B,WAAW,CAAC,GAAKzF,EAAE,CAAE;AACpE6D,IAAI,CAAC2B,IAAI,CAAG,KAAI,CAACR,OAAO,CAACvB,GAAG,CAACI,IAAI,CAAC4B,WAAW,CAAC,CAACD,IAAI;AACpD;AACAR,OAAO,CAAG,GAAIU,QAAO,CAAC1F,EAAE,CAAEiC,IAAI,CAAE4B,IAAI,CAAC;AACrCrE,MAAM,CAAC4F,aAAa,CAACpF,EAAE,CAAC,CAAGgF,OAAO;AACnC;;AAEA,GAAIA,OAAO,CAACW,cAAc,CAAE;AACPX,OAAO,CAACW,cAAc,wCAAE,CAAvC,GAAMC,MAAK;AACf,GAAI9F,IAAI,CAAC8F,KAAK,CAAC,GAAKV,MAAM,CAAE;AAC3BF,OAAO,CAAG,GAAIU,QAAO,CAACR,MAAM,CAAEjD,IAAI;AAC9B+C,OAAO;AACV/C,IAAI,CAAE2D,KAAK;AACXA,KAAK,CAAEA,KAAK,CAAC7E,KAAK,CAACiE,OAAO,CAAC/C,IAAI,CAACtB,MAAM,CAAG,CAAC,CAAC;AAC3CkF,SAAS,CAAE,EAAE;AACbJ,WAAW,CAAET,OAAO,CAAC/C,IAAI;AACzB6D,WAAW,CAAE,IAAI,GAChB;;AACFtG,MAAM,CAAC2F,qBAAqB,CAACD,MAAM,CAAC,CAAGF,OAAO;AAC9C;AACD;AACD;AACD;;AAEA,MAAOA,QAAO;AACf;AACD,CAAC;;AAEDe,KAAK,CAAG;AACPC,QAAQ,CAAE,IAAqB;AAC/BvC,GAAG,CAAE,SAACwC,IAAS,CAAW;AACzB,GAAI,CAACA,IAAI,EAAI,MAAOA,KAAI,GAAK,QAAQ,CAAE;AACtC,GAAMjG,GAAE,CAAGF,IAAI,CAACmG,IAAI,CAAW;AAC/B,GAAMhE,KAAI,CAAGjC,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC+D,WAAW,EAAE,CAAGlG,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAC;AACzD8D,IAAI,CAAIzG,MAAM,CAAC2G,eAAe,EAAI3G,MAAM,CAAC2G,eAAe,CAACnG,EAAE,CAAC,EAAK,CAAC,CAAC;AACnE,GAAIiG,IAAI,CAACG,WAAW,CAAEH,IAAI,CAACnC,MAAM,CAAG,IAAI;AACxC,GAAI,CAACmC,IAAI,CAACjG,EAAE,CAAEiG,IAAI,CAACjG,EAAE,CAAGA,EAAE;AAC1B,GAAI,CAACiG,IAAI,CAAChE,IAAI,CAAEgE,IAAI,CAAChE,IAAI,CAAGA,IAAI;AAChC,GAAI,CAACgE,IAAI,CAACI,UAAU,CAAE;AACrBJ,IAAI,CAACI,UAAU,CAAG,MAAM;AACzB;AACD;AACA,MAAOJ,KAAI;AACZ,CAAC;AACDK,GAAG,CAAE,UAAuB;AAC3B,GAAI,KAAI,CAACP,KAAK,CAACC,QAAQ,CAAE,MAAO,MAAI,CAACD,KAAK,CAACC,QAAQ;AACnD,GAAMD,MAAK,CAAG,EAAE;AAChB,IAAK,GAAM/F,GAAE,GAAKR,OAAM,CAAC2G,eAAe,EAAI,CAAC,CAAC,CAAG;AAChDJ,KAAK,CAACjF,IAAI,CAACsB,GAAG,CAAC2D,KAAK,CAACtC,GAAG,CAACzD,EAAE,CAAC,CAAC;AAC9B;AACA,GAAI+F,KAAK,CAACpF,MAAM,CAAE,KAAI,CAACoF,KAAK,CAACC,QAAQ,CAAGD,KAAK;AAC7C,MAAOA,MAAK;AACb,CAAC;AACDQ,MAAM,CAAE,SAACtE,IAAmB,CAAc;AACzC,GAAMjC,GAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AACrB,GAAIA,IAAI,GAAKjC,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC+D,WAAW,EAAE,CAAGlG,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAC,CAAE,MAAO,MAAK;AACvE,MAAO,CAAC3C,MAAM,CAAC2G,eAAe,EAAI,CAAC,CAAC,EAAEK,cAAc,CAACxG,EAAE,CAAC;AACzD;AACD,CAAC,wCAlQDyG,GAAG,CAAH,aAAInE,KAAS,CAAa,CACzB,GAAIA,KAAK,GAAK,MAAM,CAAE,MAAO,KAAI,CACjC,GAAI,CAAC9C,MAAM,CAACkH,sBAAsB,CAAE,MAAO,KAAI,CAC/C,GAAIpE,KAAK,GAAI,KAAI,CAACiB,WAAW,CAAE,CAC9B,MAAO,KAAI,CAACA,WAAW,CAACjB,KAAK,CAAC,CAC/B,CACA,IAAI,CAACiB,WAAW,CAACjB,KAAK,CAAC,CAAG,GAAIqE,UAAS,CAACrE,KAAK,CAAC,CAC9C,MAAO,KAAI,CAACiB,WAAW,CAACjB,KAAK,CAAC,CAC/B,CAAC,SACDsE,MAAM,CAAN,gBAAOvE,GAAW,CAAE,CACnB,GAAI,CAACA,GAAG,CAAE,MAAO,KAAI,CACrB,MAAO,KAAI,CAACoE,GAAG,OAAOpE,GAAG,CAAS,CACnC,CAAC,SAEDwE,aAAa,CAAb,uBAAcC,MAAc,CAAU,0CACrC,GAAItH,MAAM,CAACuH,mBAAmB,EAAID,MAAM,GAAIC,oBAAmB,CAAE,CAChED,MAAM,CAAGC,mBAAmB,CAACD,MAAM,CAAC,CACrC,CACA,GAAIA,MAAM,CAACE,MAAM,CAAC,CAAC,CAAC,GAAK,GAAG,CAAE,CAC7B,MAAO5E,IAAG,CAACO,cAAc,CAAG,0BAA0B,CAAG7C,IAAI,CAACgH,MAAM,CAAC3E,MAAM,CAAC,CAAC,CAAC,CAAC,CAAG,MAAM,CACzF,CACA,GAAI2E,MAAM,CAACG,QAAQ,CAAC,GAAG,CAAC,kBAAIzH,MAAM,CAACwD,MAAM,gCAAb,eAAekE,MAAM,SAArB,sBAAuBC,UAAU,CAAE,CAE9D,GAAIpE,SAAQ,CAAIC,MAAM,CAACkE,MAAM,CAACE,IAAI,GAAK,GAAG,CAAI,OAAO,CAAG,MAAM,CAC9D,MAAOrE,SAAQ,CAAG,KAAK,CAAGC,MAAM,CAACkE,MAAM,CAACG,IAAI,CAAG,GAAG,CAAGrE,MAAM,CAACkE,MAAM,CAACE,IAAI,CACtE,WAAW,CAAGE,kBAAkB,CAACR,MAAM,CAAC,CAAC3G,OAAO,CAAC,OAAO,CAAE,GAAG,CAAC,CAChE,CACA,MAAOiC,IAAG,CAACO,cAAc,CAAG,mBAAmB,CAAGP,GAAG,CAACmF,YAAY,CAACT,MAAM,EAAI,SAAS,CAAC,CAAG,MAAM,CACjG,CAAC,SAaDS,YAAY,CAAZ,sBAAatF,IAAS,CAAE,CACvB,GAAI,CAACA,IAAI,CAAE,MAAO,EAAE,CACpB,MAAO,CAAC,EAAE,CAAGA,IAAI,EACf9B,OAAO,CAAC,IAAI,CAAE,OAAO,CAAC,CAACA,OAAO,CAAC,IAAI,CAAE,MAAM,CAAC,CAACA,OAAO,CAAC,IAAI,CAAE,MAAM,CAAC,CAACA,OAAO,CAAC,IAAI,CAAE,QAAQ,CAAC,CAC1FY,KAAK,CAAC,CAAC,CAAE,EAAE,CAAC,CACf,CAAC,SAEDyG,KAAK,CAAL,eAAMC,IAAY,CAAE,qBAEnB,uBAAOjI,MAAM,CAACkI,OAAO,eAAd,gBAAgBF,KAAK,cAArB,gBAAgBA,KAAK,CAAGC,IAAI,CAAC,CACrC,CAAC,SAEDE,YAAY,CAAZ,sBAAa1F,IAAY,CAAE,CAC1B,GAAI2F,UAAS,CAAG3F,IAAI,CAAC9B,OAAO,CAAC,gBAAgB,CAAE,EAAE,CAAC,CAClD,GAAIyH,SAAS,CAAC/G,OAAO,CAAC,GAAG,CAAC,EAAI,CAAC,CAAE,CAChC+G,SAAS,EAAI3F,IAAI,CAAClB,KAAK,CAAC6G,SAAS,CAACjH,MAAM,CAAC,CAACR,OAAO,CAAC,WAAW,CAAE,EAAE,CAAC,CAACA,OAAO,CAAC,OAAO,CAAE,EAAE,CAAC,CACxF,CACA,MAAOyH,UAAS,CACjB,CAAC,SAEDC,SAAS,CAAT,mBAAU5F,IAA+B,CAAsC,CAC9EA,IAAI,CAAG,CAACA,IAAI,EAAI,EAAE,EAAEC,IAAI,EAAE,CAC1B,GAAID,IAAI,CAACE,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,GAAK,OAAO,CAAE,CAClC,MAAOC,IAAG,CAACkC,KAAK,CAACb,GAAG,CAACxB,IAAI,CAACE,MAAM,CAAC,CAAC,CAAC,CAACD,IAAI,EAAE,CAAC,CAC5C,CAAC,IAAM,IAAID,IAAI,CAACE,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,GAAK,UAAU,CAAE,CAC5C,MAAOC,IAAG,CAACuC,SAAS,CAAClB,GAAG,CAACxB,IAAI,CAACE,MAAM,CAAC,CAAC,CAAC,CAACD,IAAI,EAAE,CAAC,CAChD,CAAC,IAAM,IAAID,IAAI,CAACE,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,GAAK,OAAO,CAAE,CACzC,MAAOC,IAAG,CAACoB,KAAK,CAACC,GAAG,CAACxB,IAAI,CAACE,MAAM,CAAC,CAAC,CAAC,CAACD,IAAI,EAAE,CAAC,CAC5C,CACA,GAAIlC,GAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC,CACnB,MAAO,IAAI6F,WAAU,CAAC9H,EAAE,CAAEiC,IAAI,CAAC,CAChC,CAAC,SA6CD8F,eAAe,CAAf,yBAAgB9B,IAAY,CAAE,CAC7B,MAAO,CACN,MAAM,CAAE,OAAO,CAAE,OAAO,CAAE,UAAU,CAAE,KAAK,CAAE,SAAS,CAAE,MAAM,CAAE,QAAQ,CACxE,CAACgB,QAAQ,CAAChB,IAAI,CAAC,CAAG,SAAS,CAAG,UAAU,CAC1C,CAAC;;AA2ID+B,UAAU,CAAV,oBAAWhD,OAAgB,CAAEF,OAAe,CAAE;AAC7C,IAAK,GAAMxD,EAAC,GAAI0D,QAAO,CAACL,SAAS,CAAE;;AAElC,GAAIG,OAAO,GAAKE,OAAO,CAACL,SAAS,CAACrD,CAAC,CAAC,CAAE,MAAO,KAAI;AAClD;AACA,MAAO,MAAK;AACb,CAAC;;AAED2G,cAAc,CAAd,wBAAe5F,GAAgB,CAAE;AAChC,GAAI,IAAI,CAACe,gBAAgB,CAACf,GAAG,CAAC,CAAE;AAChC,IAAI,CAACe,gBAAgB,CAACf,GAAG,CAAC,CAAG,CAAC;;AAE9B,GAAI6F,KAAI,CAAGC,CAAC,CAAC,gCAAgC,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC,EAAI,EAAE;AAChE,GAAIC,GAAE,CAAG,GAAG,EAAIH,IAAI,CAACI,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,EAAI,EAAE,CAAC;AACzCJ,IAAI,CAAG,CAACA,IAAI,CAACK,KAAK,CAAC,+BAA+B,CAAC,EAAI,EAAE,EAAE,CAAC,CAAC,EAAI,EAAE;;AAEnE,GAAIC,GAAE,CAAG3F,QAAQ,CAAC4F,aAAa,CAAC,QAAQ,CAAC;AACzCD,EAAE,CAACE,GAAG,CAAGR,IAAI,CAAG,yBAAyB,CAAGG,EAAE;AAC9CxF,QAAQ,CAAC8F,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAACC,WAAW,CAACJ,EAAE,CAAC;AACzD,CAAC;AACDK,aAAa,CAAb,uBAAcC,OAAmC,CAAEC,OAAgB;;;;;;;;AAQrD,IARuDC,QAQpE,2DAAG,CAAC3G,GAAG,CAAE,CAAC,CAAC;AACX,GAAM4G,aAAY,CAAGD,OAAO,CAAC3G,GAAG,EAAI,CAAC;AACrC,GAAI6G,UAAS,CAAG,CAAC,CAACF,OAAO,CAACG,OAAO;AACjC,GAAIL,OAAO,WAAYM,QAAO,CAAE;AAC/B,GAAIN,OAAO,CAACO,SAAS,CAACC,SAAS,CAAE;AAChCN,OAAO,CAACO,KAAK,CAAGT,OAAO,CAACO,SAAS,CAACC,SAAS,CAAC,CAAC,CAAC;AAC9CN,OAAO,CAACQ,MAAM,CAAGV,OAAO,CAACO,SAAS,CAACC,SAAS,CAAC,CAAC,CAAC;AAChD,CAAC,IAAM;AACNN,OAAO,CAACO,KAAK,CAAGT,OAAO,CAACS,KAAK;AAC7BP,OAAO,CAACQ,MAAM,CAAGV,OAAO,CAACU,MAAM;AAChC;AACA,GAAIC,aAAY,CAAG,KAAK;AACxB,GAAIX,OAAO,CAACO,SAAS,CAACF,OAAO,CAAE;AAC9B,GAAIL,OAAO,CAACO,SAAS,CAACF,OAAO,CAAC,CAAC,CAAC,CAAE;AACjCM,YAAY,CAAG,IAAI;AACpB,CAAC,IAAM,IAAIT,OAAO,CAACG,OAAO,GAAK,KAAK,CAAE;AACrCD,SAAS,CAAG,IAAI;AACjB;AACD;AACAJ,OAAO,CAAGA,OAAO,CAACY,eAAe,EAAE,EAAID,YAAY,CAAG,OAAO,CAAG,EAAE,CAAC;AACpE;AACA,GAAMzE,QAAO,CAAG5C,GAAG,CAAC4C,OAAO,CAACvB,GAAG,CAACqF,OAAO,CAAC;;AAExC,GAAI9D,OAAO,CAAC/C,IAAI,CAAC0H,QAAQ,CAAC,OAAO,CAAC,CAAET,SAAS,CAAG,KAAK;AACrD,GAAIU,WAAU,CAAG;AAChBvH,GAAG,CAAE4G,YAAY;AACjBY,CAAC,CAAE,EAAE;AACLC,CAAC,CAAE,EAAE;AACLC,CAAC,CAAE,CAAC;AACJC,GAAG,CAAE5H,GAAG,CAACO,cAAc,CAAG,UAAU;AACpCsH,SAAS,CAAE,IAAI;AACfC,aAAa,CAAE,KAAK;AACpBC,MAAM,CAAE,EAAE;AACVZ,KAAK,CAAEP,OAAO,CAACO;AAChB,CAAC;AACD,GAAItH,KAAI,CAAG+C,OAAO,CAACoF,QAAQ;AAC3B,GAAIC,IAAG;AACP,GAAIC,OAAM;AACV,GAAIvB,OAAO,CAAE;AACZa,UAAU,CAACM,aAAa,CAAG,IAAI;AAC/BG,GAAG,CAAG,EAAE;AACRC,MAAM,CAAG,OAAO;AACjB,CAAC,IAAM;AACND,GAAG,CAAG,OAAO;AACbC,MAAM,CAAG,MAAM;AAChB;;;;;;;;;;;;;AAaA,GAAIC,YAAW,CAAGtB,YAAY;AAC9B,GAAI7G,GAAG,CAACoF,KAAK,CAAC,YAAY,CAAC,CAAE+C,WAAW,CAAG,CAAC;AAC5C,GAAInI,GAAG,CAACoF,KAAK,CAAC,OAAO,CAAC,EAAI+C,WAAW,EAAI,CAAC,CAAEA,WAAW,CAAG,CAAC;AAC3DX,UAAU,CAACvH,GAAG,CAAGmI,IAAI,CAACC,GAAG,CAACF,WAAW,CAAEC,IAAI,CAACE,GAAG,CAAC1F,OAAO,CAAC3C,GAAG,CAAE,CAAC,CAAC,CAAC;AAChE,GAAMsI,QAAO,CAAG,CAAC,EAAE,CAAE,MAAM,CAAE,MAAM,CAAE,MAAM,CAAE,MAAM,CAAE,MAAM,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAE,EAAE,CAAC,CAACf,UAAU,CAACvH,GAAG,CAAC;;AAE5F,GAAIuI,cAAa,CAAG,IAAI;AACxB,GAAIC,SAAQ,CAAG,IAAI;AACnB,GAAIC,UAAS,CAAG9F,OAAO,CAAChF,EAAE;AAC1B,GAAIgF,OAAO,CAAC+F,OAAO,CAAED,SAAS,CAAGhL,IAAI,CAACmC,IAAI,CAAC;AAC3C,GAAI0I,OAAO,GAAK,EAAE,EAAInL,MAAM,CAACwL,oBAAoB,CAAE;AAClDJ,aAAa,CAAGI,oBAAoB,CAACF,SAAS,CAAC;AAChD;AACA,GAAIH,OAAO,GAAK,MAAM,EAAInL,MAAM,CAACyL,sBAAsB,CAAE;AACxDL,aAAa,CAAGK,sBAAsB,CAACH,SAAS,CAAC;AAClD;AACA,GAAItL,MAAM,CAACwL,oBAAoB,CAAEH,QAAQ,CAAGG,oBAAoB,CAACF,SAAS,CAAC;AAC3E,GAAI,CAACD,QAAQ,EAAIrL,MAAM,CAACyL,sBAAsB,CAAEJ,QAAQ,CAAGI,sBAAsB,CAACH,SAAS,CAAC;AAC5F,GAAI,CAACF,aAAa,CAAEA,aAAa,CAAG,CAAC,CAAC;AACtC,GAAI,CAACC,QAAQ,CAAEA,QAAQ,CAAG,CAAC,CAAC;;AAE5B,GAAIA,QAAQ,CAACK,GAAG,GAAK,CAAC,EAAIL,QAAQ,CAACK,GAAG,CAAG,CAAC,IAAI,CAAE;AAC/C,GAAIC,cAAa,CAAGrL,IAAI,CAACkF,OAAO,CAACS,WAAW,CAAC;AAC7CmE,UAAU,CAACO,MAAM,CAAG,cAAc,CAAGgB,aAAa;AAClD,GAAIC,QAAO,CAAGpG,OAAO,CAACoG,OAAO;AAC7B,GAAIpG,OAAO,CAACqG,MAAM,EAAID,OAAO;AAC5BA,OAAO,GAAK,UAAU;AACtBA,OAAO,GAAK,UAAU;AACtBA,OAAO,GAAK,YAAY;AACxBA,OAAO,GAAK,SAAS;AACrBA,OAAO,GAAK,SAAS;AACrBA,OAAO,GAAK,QAAQ;AACpBA,OAAO,GAAK,SAAS;AACrBA,OAAO,GAAK,cAAc;AAC1BA,OAAO,GAAK,SAAS;AACrBA,OAAO,GAAK,MAAM;AAClBA,OAAO,GAAK,UAAU;AACtBA,OAAO,GAAK,QAAQ;AACpBA,OAAO,GAAK,UAAU;AACtBA,OAAO,GAAK,UAAU;AACtBD,aAAa,GAAK,SAAS;AAC3BA,aAAa,GAAK,QAAQ;AAC1BA,aAAa,GAAK,WAAW;AAC7BA,aAAa,GAAK,UAAU;AAC5BA,aAAa,GAAK,UAAU;AAC5BA,aAAa,GAAK,UAAU;AAC5BA,aAAa,GAAK,UAAU;AAC5BA,aAAa,GAAK,UAAU;AAC5BA,aAAa,GAAK,SAAS,CAC3B;AAAE;AACFvB,UAAU,CAACO,MAAM,EAAIiB,OAAO;AAC7B;AACAxB,UAAU,CAACO,MAAM,EAAI,MAAM;AAC5B;;AAEA,GAAInB,OAAO,CAACO,KAAK,EAAIN,YAAY,CAAG,CAAC,CAAEoB,GAAG,EAAI,QAAQ;;;AAGtD,GAAI7K,MAAM,CAACwD,MAAM,EAAIA,MAAM,CAACkE,MAAM,EAAIlE,MAAM,CAACkE,MAAM,CAACoE,GAAG,EAAItC,OAAO,CAACsC,GAAG,CAAE;AACvEjB,GAAG,CAAG,KAAK,CAAGA,GAAG;AACjBT,UAAU,CAACI,GAAG,EAAIK,GAAG,CAAG,GAAG,CAAGpI,IAAI,CAAG,MAAM;;;AAG3C,GAAIiH,SAAS,EAAI,CAACF,OAAO,CAACuC,OAAO,CAAE;AAClC3B,UAAU,CAACC,CAAC,EAAI,IAAI;AACpBD,UAAU,CAACE,CAAC,EAAI,IAAI;AACpBF,UAAU,CAACG,CAAC,EAAI,CAAC,EAAE;AACpB,CAAC,IAAM,IAAI/E,OAAO,CAAC+F,OAAO,EAAI,CAAC/B,OAAO,CAACuC,OAAO,CAAE;AAC/C3B,UAAU,CAACC,CAAC,EAAI,GAAG;AACnBD,UAAU,CAACE,CAAC,EAAI,GAAG;AACnBF,UAAU,CAACG,CAAC,EAAI,CAAC,EAAE;AACpB;AACA,MAAOH,WAAU;AAClB;;;AAGA,GAAIZ,OAAO,CAACvC,GAAG,CAAE;AAChBmD,UAAU,CAACO,MAAM,YAAcnB,OAAO,CAACvC,GAAG,WAAU3G,IAAI,CAACkF,OAAO,CAACS,WAAW,CAAG;AAC/EmE,UAAU,CAACO,MAAM,EAAI,MAAM;AAC5B;;AAEA,GAAIS,aAAa,CAACN,MAAM,CAAG,GAAG,CAAC,EAAItB,OAAO,CAACQ,MAAM,GAAK,GAAG,CAAEc,MAAM,EAAI,GAAG;AACxE,GAAIkB,UAAS,CAAG,CAACpJ,GAAG,CAACoF,KAAK,CAAC,QAAQ,CAAC,EAAI,CAACpF,GAAG,CAACoF,KAAK,CAAC,OAAO,CAAC;AAC3D,GAAIgE,SAAS,EAAI5B,UAAU,CAACvH,GAAG,EAAI,CAAC,CAAEuH,UAAU,CAACK,SAAS,CAAG,KAAK;AAClE,GAAIuB,SAAS,EAAIZ,aAAa,CAACN,MAAM,CAAC,EAAIV,UAAU,CAACvH,GAAG,EAAI,CAAC,CAAE;AAC9D,GAAIiI,MAAM,CAACvJ,KAAK,CAAC,CAAC,CAAC,CAAC,GAAK,GAAG,CAAEkB,IAAI,EAAI,IAAI;AAC1CoI,GAAG,CAAGM,OAAO,CAAG,KAAK,CAAGN,GAAG;;AAE3BT,UAAU,CAACC,CAAC,CAAGe,aAAa,CAACN,MAAM,CAAC,CAACT,CAAC;AACtCD,UAAU,CAACE,CAAC,CAAGc,aAAa,CAACN,MAAM,CAAC,CAACR,CAAC;AACtCF,UAAU,CAACI,GAAG,EAAIK,GAAG,CAAG,GAAG,CAAGpI,IAAI,CAAG,MAAM;AAC5C,CAAC,IAAM;;;AAGNoI,GAAG,CAAG,CAACM,OAAO,EAAI,MAAM,EAAIN,GAAG;;;;AAI/B,GAAIT,UAAU,CAACvH,GAAG,EAAI,CAAC,EAAIwI,QAAQ,CAAC,QAAQ,CAAC,EAAI7B,OAAO,CAACQ,MAAM,GAAK,GAAG,CAAE;AACxEvH,IAAI,EAAI,IAAI;AACb;;AAEA2H,UAAU,CAACI,GAAG,EAAIK,GAAG,CAAG,GAAG,CAAGpI,IAAI,CAAG,MAAM;AAC5C;;AAEA,GAAI,CAAC+G,OAAO,CAACuC,OAAO,CAAE;AACrB,GAAIhB,WAAW,CAAG,CAAC,CAAE;;AAErB,CAAC,IAAM,IAAIX,UAAU,CAACM,aAAa,CAAE;AACpCN,UAAU,CAACC,CAAC,EAAI,CAAC;AACjBD,UAAU,CAACE,CAAC,EAAI,CAAC;AACjBF,UAAU,CAACG,CAAC,EAAI,CAAC,EAAE;AACpB,CAAC,IAAM;;AAENH,UAAU,CAACC,CAAC,EAAI,CAAC,CAAG,GAAG;AACvBD,UAAU,CAACE,CAAC,EAAI,CAAC,CAAG,GAAG;AACvBF,UAAU,CAACG,CAAC,EAAI,CAAC,EAAE;AACpB;AACA,GAAIH,UAAU,CAACvH,GAAG,EAAI,CAAC,CAAEuH,UAAU,CAACG,CAAC,EAAI,CAAC;AAC3C;AACA,GAAIb,SAAS,EAAI,CAACF,OAAO,CAACuC,OAAO,CAAE;AAClC3B,UAAU,CAACC,CAAC,EAAI,CAAC;AACjBD,UAAU,CAACE,CAAC,EAAI,CAAC;AACjBF,UAAU,CAACG,CAAC,EAAI,CAAC,EAAE;AACpB,CAAC,IAAM,IAAI/E,OAAO,CAAC+F,OAAO,EAAI,CAAC/B,OAAO,CAACuC,OAAO,CAAE;AAC/C3B,UAAU,CAACC,CAAC,EAAI,GAAG;AACnBD,UAAU,CAACE,CAAC,EAAI,GAAG;AACnBF,UAAU,CAACG,CAAC,EAAI,CAAC,EAAE;AACpB;;AAEA,MAAOH,WAAU;AAClB,CAAC;;AAED6B,iBAAiB,CAAjB,2BAAkBzL,EAAM,CAAE0L,QAAkB,CAAEC,UAAoB,CAAE;AACnE,GAAIT,IAAG,CAAG,CAAC;AACX,0BAAI1L,MAAM,CAACwL,oBAAoB,iCAA3B,sBAA8BhL,EAAE,CAAC,SAAjC,uBAAmCkL,GAAG,CAAE;AAC3CA,GAAG,CAAGF,oBAAoB,CAAChL,EAAE,CAAC,CAACkL,GAAG;AACnC,CAAC,IAAM,2BAAI1L,MAAM,CAAC4F,aAAa,iCAApB,sBAAuBpF,EAAE,CAAC,SAA1B,uBAA4BkL,GAAG,CAAE;AAC3CA,GAAG,CAAG9F,aAAa,CAACpF,EAAE,CAAC,CAACkL,GAAG;AAC5B;AACA,GAAIA,GAAG,CAAG,CAAC,CAAEA,GAAG,CAAG,CAAC;AACpB,GAAIA,GAAG,CAAG,IAAI,CAAEA,GAAG,CAAG,CAAC;;AAEvB,2BAAI1L,MAAM,CAACoM,wBAAwB,SAA/B,uBAAkC5L,EAAE,CAAC,CAAE;AAC1CkL,GAAG,CAAGU,wBAAwB,CAAC5L,EAAE,CAAC;AACnC;;AAEA,GAAI0L,QAAQ,CAAE;AACb,GAAI,CAAC,UAAU,CAAE,UAAU,CAAE,WAAW,CAAE,UAAU,CAAE,QAAQ,CAAC,CAACzE,QAAQ,CAACjH,EAAE,CAAC,CAAE;AAC7EkL,GAAG,CAAGU,wBAAwB,CAAC5L,EAAE,CAAG,GAAG,CAAC;AACzC;AACD;AACA,GAAI2L,UAAU,CAAE;AACf,GAAIE,4BAA4B,CAAC7L,EAAE,CAAC,CAAE;AACrCkL,GAAG,CAAGW,4BAA4B,CAAC7L,EAAE,CAAC;AACvC;AACD;AACA,MAAOkL,IAAG;AACX,CAAC;;AAEDY,cAAc,CAAd,wBAAehD,OAA6D,CAAE6C,UAAoB,CAAE;AACnG,GAAI7C,OAAO,GAAK,UAAU,CAAE;AAC3B,oCAAqC1G,GAAG,CAACO,cAAc;AACxD,CAAC,IAAM,IAAImG,OAAO,GAAK,mBAAmB,CAAE;AAC3C,oCAAqC1G,GAAG,CAACO,cAAc;AACxD,CAAC,IAAM,IAAImG,OAAO,GAAK,kBAAkB,CAAE;AAC1C,oCAAqC1G,GAAG,CAACO,cAAc;AACxD,CAAC,IAAM,IAAImG,OAAO,GAAK,eAAe,CAAE;AACvC,oCAAqC1G,GAAG,CAACO,cAAc;AACxD;;AAEA,GAAI3C,GAAE,CAAGF,IAAI,CAACgJ,OAAO,CAAC;AACtB,GAAI,CAACA,OAAO,EAAI,MAAOA,QAAO,GAAK,QAAQ,CAAEA,OAAO,CAAG,IAAI;;AAE3D,aAAIA,OAAO,SAAP,SAASiD,YAAY,CAAE/L,EAAE,CAAGF,IAAI,CAACgJ,OAAO,CAACiD,YAAY,CAAC;;AAE1D,cAAIjD,OAAO,SAAP,UAAS9D,OAAO,CAAEhF,EAAE,CAAGF,IAAI,CAACgJ,OAAO,CAAC9D,OAAO,CAAC;;AAEhD,GAAI,WAAA8D,OAAO,8BAAP,UAASO,SAAS,SAAlB,oBAAoB2C,WAAW,EAAI,CAAClD,OAAO,CAACO,SAAS,CAACC,SAAS,CAAE;;AAEpEtJ,EAAE,CAAGF,IAAI,CAACgJ,OAAO,CAACO,SAAS,CAAC2C,WAAW,CAAC,CAAC,CAAC,CAAC;AAC5C;AACA,GAAId,IAAG,CAAG,IAAI,CAACO,iBAAiB,CAACzL,EAAE,CAAE,YAAA8I,OAAO,eAAP,UAASU,MAAM,IAAK,GAAG,CAAEmC,UAAU,CAAC;;AAEzE,GAAIM,IAAG,CAAGzB,IAAI,CAAC0B,KAAK,CAAChB,GAAG,CAAG,EAAE,CAAC,CAAG,EAAE;AACnC,GAAIiB,KAAI,CAAIjB,GAAG,CAAG,EAAE,CAAI,EAAE;AAC1B,GAAIkB,QAAO,CAAI,WAACtD,OAAO,SAAR,UAAsCsD,OAAO,uDAA4D;AACxH,oCAAqChK,GAAG,CAACO,cAAc,0DAAyDwJ,IAAI,QAAOF,GAAG,MAAKG,OAAO;AAC3I,CAAC;;AAEDC,wBAAwB,CAAxB,kCAAyBvD,OAAY,CAA0C,IAAxCzG,IAAW,2DAAG,CAAC;AACrD,GAAIrC,GAAE,CAAGF,IAAI,CAACgJ,OAAO,CAAC9D,OAAO,CAAC;AAC9B,GAAIoF,SAAQ,CAAGtB,OAAO,CAACsB,QAAQ;AAC/B,GAAIpF,QAAO,CAAG5C,GAAG,CAAC4C,OAAO,CAACvB,GAAG,CAACqF,OAAO,CAAC9D,OAAO,CAAC;AAC9C,GAAI8D,OAAO,CAAC9D,OAAO,EAAI,CAACoF,QAAQ,CAAE;AACjCA,QAAQ,CAAGpF,OAAO,CAACoF,QAAQ,EAAItK,IAAI,CAACgJ,OAAO,CAAC9D,OAAO,CAAC;AACrD;AACA,GAAIA,OAAO,CAAClB,MAAM,GAAK,KAAK,CAAE,MAAO,CAAEwI,SAAS,CAAE,cAAc,CAAElC,QAAQ,CAAE,GAAG,CAAEmC,CAAC,CAAE,EAAE,CAAExC,CAAC,CAAE,CAAE,CAAC;AAC9F,GAAMH,WAAiC,CAAG;AACzCQ,QAAQ,CAARA,QAAQ;AACRkC,SAAS,CAAE,aAAa;AACxBC,CAAC,CAAE,CAAC,CAAC;AACLxC,CAAC,CAAE,CAAC;AACL,CAAC;AACD,GAAIjB,OAAO,CAACS,KAAK,CAAEK,UAAU,CAACL,KAAK,CAAG,IAAI;AAC1C,GAAInH,GAAG,CAACoF,KAAK,CAAC,YAAY,CAAC,CAAEnF,GAAG,CAAG,CAAC;AACpC,GAAID,GAAG,CAACoF,KAAK,CAAC,OAAO,CAAC,EAAInF,GAAG,CAAG,CAAC,CAAEA,GAAG,CAAG,CAAC;AAC1C,GAAImK,YAAW,CAAI,CAACxH,OAAO,CAACyH,aAAa,EAAIzH,OAAO,CAACyH,aAAa,GAAK,MAAM,EAAIzH,OAAO,CAACyH,aAAa,GAAK,KAAK,EAAK;AACpH,gBAAgB,CAAE,cAAc,CAAE,QAAQ,CAAE,UAAU,CAAE,aAAa,CAAE,cAAc,CAAE,mBAAmB,CAAE,YAAY,CAAE,aAAa,CAAE,eAAe,CAAE,kBAAkB,CAAE,iBAAiB,CAAE,aAAa,CAAE,cAAc,CAAE,gBAAgB,CAChP;AAACxF,QAAQ,CAACjC,OAAO,CAAChF,EAAE,CAAC;AACtB,GAAIgF,OAAO,CAAC3C,GAAG,GAAK,CAAC,EAAI2C,OAAO,CAACyH,aAAa,GAAK,KAAK,CAAED,WAAW,CAAG,KAAK;AAC7E,GAAI,CAAC,CAACnK,GAAG,EAAIA,GAAG,EAAI,CAAC,GAAKmK,WAAW,CAAE;AACtC,GAAIxH,OAAO,CAAC3C,GAAG,EAAI,CAAC,CAAE;AACrBuH,UAAU,CAAC2C,CAAC,CAAG,CAAC,CAAC;AACjB3C,UAAU,CAACG,CAAC,CAAG,CAAC,CAAC;AAClB,CAAC,IAAM,IAAI/J,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,GAAK,QAAQ,CAAE;AACxCyH,UAAU,CAAC2C,CAAC,CAAG,CAAC,CAAC;AACjB3C,UAAU,CAACG,CAAC,CAAG,CAAC;AACjB,CAAC,IAAM,IAAI/J,EAAE,GAAK,UAAU,CAAE;AAC7B4J,UAAU,CAAC2C,CAAC,CAAG,CAAC,CAAC;AACjB3C,UAAU,CAACG,CAAC,CAAG,CAAC;AACjB,CAAC,IAAM,IAAI/J,EAAE,GAAK,cAAc,CAAE;AACjC4J,UAAU,CAAC2C,CAAC,CAAG,CAAC,CAAC;AACjB3C,UAAU,CAACG,CAAC,CAAG,CAAC;AACjB;AACA,MAAOH,WAAU;AAClB;AACAA,UAAU,CAAC0C,SAAS,CAAG,cAAc;AACrC,GAAIjK,GAAG,EAAI,CAAC,EAAI2C,OAAO,CAAC3C,GAAG,EAAI,CAAC,CAAEuH,UAAU,CAAC0C,SAAS,CAAG,cAAc,CAAC;AACnE,GAAIjK,GAAG,EAAI,CAAC,EAAI2C,OAAO,CAAC3C,GAAG,EAAI,CAAC,CAAEuH,UAAU,CAAC0C,SAAS,CAAG,cAAc,CAAC;AACxE,GAAIjK,GAAG,EAAI,CAAC,EAAI2C,OAAO,CAAC3C,GAAG,EAAI,CAAC,CAAEuH,UAAU,CAAC0C,SAAS,CAAG,cAAc,CAAC;AACxE,GAAIjK,GAAG,EAAI,CAAC,EAAI2C,OAAO,CAAC3C,GAAG,EAAI,CAAC,CAAEuH,UAAU,CAAC0C,SAAS,CAAG,cAAc;AAC5E1C,UAAU,CAAC2C,CAAC,CAAG,EAAE;AACjB3C,UAAU,CAACG,CAAC,CAAG,CAAC;AAChB,MAAOH,WAAU;AAClB,CAAC;;AAED8C,oBAAoB,CAApB,8BAAqB5D,OAAY,CAAmB,IAAjBzG,IAAW,2DAAG,CAAC;AACjD,GAAI,CAACyG,OAAO,CAAE,MAAO,EAAE;AACvB,GAAMjF,KAAI,CAAG,IAAI,CAACwI,wBAAwB,CAACvD,OAAO,CAAEzG,GAAG,CAAC;AACxD,GAAMkH,MAAK,CAAI1F,IAAI,CAAC0F,KAAK,CAAG,QAAQ,CAAG,EAAG;AAC1C,MAAO,uBAAuB,CAAGnH,GAAG,CAACO,cAAc,CAAGkB,IAAI,CAACyI,SAAS,CAAG/C,KAAK,CAAG,GAAG,CAAG1F,IAAI,CAACuG,QAAQ,CAAG,4BAA4B,CAAGvG,IAAI,CAAC0I,CAAC,CAAG,KAAK,CAAG1I,IAAI,CAACkG,CAAC,CAAG,gCAAgC;AAC/L,CAAC;;AAED4C,WAAW,CAAX,qBAAYlI,IAAS,CAAE;AACtB,GAAIyG,IAAG,CAAG,CAAC;AACX,GAAI,MAAOzG,KAAI,GAAK,QAAQ,EAAI/E,OAAO,CAAC8E,WAAW,CAAEC,IAAI,CAAG/E,OAAO,CAAC8E,WAAW,CAAC1E,IAAI,CAAC2E,IAAI,CAAC,CAAC;AAC3F,UAAIA,IAAI,SAAJ,MAAMmI,SAAS,CAAE1B,GAAG,CAAGzG,IAAI,CAACmI,SAAS;;AAEzC,GAAIX,IAAG,CAAGzB,IAAI,CAAC0B,KAAK,CAAChB,GAAG,CAAG,EAAE,CAAC,CAAG,EAAE;AACnC,GAAIiB,KAAI,CAAIjB,GAAG,CAAG,EAAE,CAAI,EAAE;AAC1B,MAAO,6BAA6B,CAAG9I,GAAG,CAACO,cAAc,CAAG,oDAAoD,CAAGwJ,IAAI,CAAG,MAAM,CAAGF,GAAG,CAAG,IAAI;AAC9I,CAAC;;AAEDY,WAAW,CAAX,qBAAY5G,IAAmB,CAAE/E,CAAW,CAAE;AAC7C+E,IAAI,CAAG,IAAI,CAACF,KAAK,CAACtC,GAAG,CAACwC,IAAI,CAAC,CAAChE,IAAI;AAChC,GAAI,CAACgE,IAAI,CAAEA,IAAI,CAAG,KAAK;AACvB,GAAI6G,cAAa,CAAG7G,IAAI,CAAC9F,OAAO,CAAC,KAAK,CAAE,KAAK,CAAC;AAC9C,oBAAoBiC,GAAG,CAACO,cAAc,kBAAiBmK,aAAa,iBAAc7G,IAAI,oDAA4C/E,CAAC,CAAG,IAAI,CAAG,EAAE;AAChJ,CAAC;;AAED6L,eAAe,CAAf,yBAAgBC,QAAuB,CAAE;AACxC,GAAMC,WAAU,CAAGnN,IAAI,CAACkN,QAAQ,CAAC;AACjC,GAAIE,kBAAiB,CAAG,EAAE;AAC1B,OAAQD,UAAU;AAClB,IAAK,UAAU;AACf,IAAK,SAAS;AACd,IAAK,QAAQ;AACZC,iBAAiB,CAAGD,UAAU,CAACjG,MAAM,CAAC,CAAC,CAAC,CAACd,WAAW,EAAE,CAAG+G,UAAU,CAAClM,KAAK,CAAC,CAAC,CAAC;AAC5E;AACD;AACCmM,iBAAiB,CAAG,WAAW;AAC/B,MAAM;;AAEP,oBAAoB9K,GAAG,CAACO,cAAc,uBAAsBuK,iBAAiB,iBAAcA,iBAAiB;AAC7G,CAAC;;AAEDC,YAAY,CAAZ,uBAAe;AACd,GAAI,IAAI,CAACzK,SAAS,CAAE,MAAO,KAAI,CAACA,SAAS;AACzC,IAAI,CAACA,SAAS,CAAG,EAAE;AACnB,GAAI,CAAClD,MAAM,CAACgF,WAAW,CAAEhF,MAAM,CAACgF,WAAW,CAAG,CAAC,CAAC,CAAC;AAC9B4I,MAAM,CAACC,MAAM,CAAC7N,MAAM,CAACgF,WAAW,CAAC,wBAAiB,CAAhE,GAAMX,KAAI;AACd,GAAI,CAACA,IAAI,CAACyJ,UAAU,CAAE;AACtB,IAAI,CAAC5K,SAAS,CAAC5B,IAAI,CAAC+C,IAAI,CAAC5B,IAAI,CAAC;AAC/B;AACA,MAAO,KAAI,CAACS,SAAS;AACtB,CAAC,sBACD,CAAC;;;AAEIiE,SAAS;;;;;;;;;;;AAWd,mBAAYrE,KAAS,CAAE,sBAVdD,GAAG,aACHC,KAAK,aACLC,KAAK,CAAG,CAChBgL,KAAK,CAAE,CAAC,CAA+B,CACvCC,KAAK,CAAE,CAAC,CAA+B,CACvCC,SAAS,CAAE,CAAC,CAAkC,CAC9C/H,OAAO,CAAE,CAAC,CAAkC,CAC5CgI,KAAK,CAAE,CAAC,CACT,CAAC,MACDhL,SAAS,CAAoB,IAAI;;;;;;AAOjCc,KAAK,CAAG;AACPC,GAAG,CAAE,SAACxB,IAAY,CAAW;AAC5B,GAAIjC,GAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AACnB,GAAIzC,MAAM,CAACmE,aAAa,EAAI3D,EAAE,GAAI2D,cAAa,CAAE;AAChD1B,IAAI,CAAG0B,aAAa,CAAC3D,EAAE,CAAC;AACxBA,EAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AAChB;AACA,GAAI,MAAI,CAACM,KAAK,CAACgL,KAAK,CAAC/G,cAAc,CAACxG,EAAE,CAAC,CAAE,MAAO,OAAI,CAACuC,KAAK,CAACgL,KAAK,CAACvN,EAAE,CAAC;;AAEpE,GAAI6D,KAAI,kBAAOzB,GAAG,CAACoB,KAAK,CAACC,GAAG,CAACxB,IAAI,CAAC,CAAC;;AAEnC,IAAK,GAAIX,EAAC,CAAGc,GAAG,CAACC,GAAG,CAAG,CAAC,CAAEf,CAAC,EAAI,MAAI,CAACe,GAAG,CAAEf,CAAC,EAAE,CAAE;AAC7C,GAAMqM,MAAK,CAAGnO,MAAM,CAACkH,sBAAsB,OAAOpF,CAAC,CAAG;AACtD,GAAItB,EAAE,GAAI2N,MAAK,CAACC,gBAAgB,CAAE;AACjCR,MAAM,CAACS,MAAM,CAAChK,IAAI,CAAE8J,KAAK,CAACC,gBAAgB,CAAC5N,EAAE,CAAC,CAAC;AAChD;AACD;AACA,GAAI,MAAI,CAACsC,KAAK,SAAW,MAAI,CAACD,GAAK,CAAE;AACpC,GAAMsL,OAAK,CAAGnO,MAAM,CAACkH,sBAAsB,CAAC,MAAI,CAACpE,KAAK,CAAC;AACvD,GAAItC,EAAE,GAAI2N,OAAK,CAACC,gBAAgB,CAAE;AACjCR,MAAM,CAACS,MAAM,CAAChK,IAAI,CAAE8J,MAAK,CAACC,gBAAgB,CAAC5N,EAAE,CAAC,CAAC;AAChD;AACD;AACA,GAAI,MAAI,CAACqC,GAAG,EAAI,CAAC,EAAIwB,IAAI,CAACmJ,QAAQ,GAAK,QAAQ,CAAE;AAChDnJ,IAAI,CAACmJ,QAAQ,CAAG5K,GAAG,CAAC2F,eAAe,CAAClE,IAAI,CAACoC,IAAI,CAAC;AAC/C;;AAEA,GAAM7B,KAAI,CAAG,GAAIC,KAAI,CAACrE,EAAE,CAAEiC,IAAI,CAAE4B,IAAI,CAAC;AACrC,MAAI,CAACtB,KAAK,CAACgL,KAAK,CAACvN,EAAE,CAAC,CAAGoE,IAAI;AAC3B,MAAOA,KAAI;AACZ;AACD,CAAC;;AAEDE,KAAK,CAAG;AACPb,GAAG,CAAE,SAACxB,IAAY,CAAW;AAC5B,GAAIjC,GAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AACnB,GAAIzC,MAAM,CAACmE,aAAa,EAAI3D,EAAE,GAAI2D,cAAa,CAAE;AAChD1B,IAAI,CAAG0B,aAAa,CAAC3D,EAAE,CAAC;AACxBA,EAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AAChB;AACA,GAAI,MAAI,CAACM,KAAK,CAACiL,KAAK,CAAChH,cAAc,CAACxG,EAAE,CAAC,CAAE,MAAO,OAAI,CAACuC,KAAK,CAACiL,KAAK,CAACxN,EAAE,CAAC;;AAEpE,GAAI6D,KAAI,kBAAOzB,GAAG,CAACkC,KAAK,CAACb,GAAG,CAACxB,IAAI,CAAC,CAAC;;AAEnC,IAAK,GAAIX,EAAC,CAAG,MAAI,CAACe,GAAG,CAAEf,CAAC,CAAG,CAAC,CAAEA,CAAC,EAAE,CAAE;AAClC,GAAMqM,MAAK,CAAGnO,MAAM,CAACkH,sBAAsB,CAAC,KAAK,CAAGpF,CAAC,CAAC;AACtD,GAAItB,EAAE,GAAI2N,MAAK,CAACG,gBAAgB,CAAE;AACjCjK,IAAI,CAACkK,SAAS,CAAGJ,KAAK,CAACG,gBAAgB,CAAC9N,EAAE,CAAC;AAC3C;AACD;AACD;;AAEA,GAAMyE,KAAI,CAAG,GAAIC,KAAI,CAAC1E,EAAE,CAAEiC,IAAI,CAAE4B,IAAI,CAAC;AACrC,MAAI,CAACtB,KAAK,CAACiL,KAAK,CAACxN,EAAE,CAAC,CAAGyE,IAAI;AAC3B,MAAOA,KAAI;AACZ;AACD,CAAC;;AAEDE,SAAS,CAAG;AACXlB,GAAG,CAAE,SAACxB,IAAY,CAAc;AAC/B,GAAIjC,GAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AACnB,GAAIzC,MAAM,CAACmE,aAAa,EAAI3D,EAAE,GAAI2D,cAAa,CAAE;AAChD1B,IAAI,CAAG0B,aAAa,CAAC3D,EAAE,CAAC;AACxBA,EAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AAChB;AACA,GAAI,MAAI,CAACM,KAAK,CAACkL,SAAS,CAACjH,cAAc,CAACxG,EAAE,CAAC,CAAE,MAAO,OAAI,CAACuC,KAAK,CAACkL,SAAS,CAACzN,EAAE,CAAC;;AAE5E,GAAI6D,KAAI,kBAAOzB,GAAG,CAACuC,SAAS,CAAClB,GAAG,CAACxB,IAAI,CAAC,CAAC;;AAEvC,IAAK,GAAIX,EAAC,CAAGc,GAAG,CAACC,GAAG,CAAG,CAAC,CAAEf,CAAC,EAAI,MAAI,CAACe,GAAG,CAAEf,CAAC,EAAE,CAAE;AAC7C,GAAMqM,MAAK,CAAGnO,MAAM,CAACkH,sBAAsB,OAAOpF,CAAC,CAAG;AACtD,GAAItB,EAAE,GAAI2N,MAAK,CAACK,mBAAmB,CAAE;AACpCZ,MAAM,CAACS,MAAM,CAAChK,IAAI,CAAE8J,KAAK,CAACK,mBAAmB,CAAChO,EAAE,CAAC,CAAC;AACnD;AACD;AACA,GAAI,MAAI,CAACsC,KAAK,SAAW,MAAI,CAACD,GAAK,CAAE;AACpC,GAAMsL,QAAK,CAAGnO,MAAM,CAACkH,sBAAsB,CAAC,MAAI,CAACpE,KAAK,CAAC;AACvD,GAAItC,EAAE,GAAI2N,QAAK,CAACK,mBAAmB,CAAE;AACpCZ,MAAM,CAACS,MAAM,CAAChK,IAAI,CAAE8J,OAAK,CAACK,mBAAmB,CAAChO,EAAE,CAAC,CAAC;AACnD;AACD;;AAEA,GAAM8E,QAAO,CAAG,GAAIC,QAAO,CAAC/E,EAAE,CAAEiC,IAAI,CAAE4B,IAAI,CAAC;AAC3C,MAAI,CAACtB,KAAK,CAACkL,SAAS,CAACzN,EAAE,CAAC,CAAG8E,OAAO;AAClC,MAAOA,QAAO;AACf;AACD,CAAC;;AAEDE,OAAO,CAAG;AACTvB,GAAG,CAAE,SAACxB,IAAY,CAAc;AAC/B,GAAIjC,GAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AACnB,GAAIzC,MAAM,CAACmE,aAAa,EAAI3D,EAAE,GAAI2D,cAAa,CAAE;AAChD1B,IAAI,CAAG0B,aAAa,CAAC3D,EAAE,CAAC;AACxBA,EAAE,CAAGF,IAAI,CAACmC,IAAI,CAAC;AAChB;AACA,GAAI,MAAI,CAACM,KAAK,CAACmD,OAAO,CAACc,cAAc,CAACxG,EAAE,CAAC,CAAE,MAAO,OAAI,CAACuC,KAAK,CAACmD,OAAO,CAAC1F,EAAE,CAAC;;AAExE,GAAI6D,KAAI,kBAAOzB,GAAG,CAAC4C,OAAO,CAACvB,GAAG,CAACxB,IAAI,CAAC,CAAC;;AAErC,IAAK,GAAIX,EAAC,CAAGc,GAAG,CAACC,GAAG,CAAG,CAAC,CAAEf,CAAC,EAAI,MAAI,CAACe,GAAG,CAAEf,CAAC,EAAE,CAAE;AAC7C,GAAMqM,QAAK,CAAGnO,MAAM,CAACkH,sBAAsB,OAAOpF,CAAC,CAAG;AACtD,GAAItB,EAAE,GAAI2N,QAAK,CAACM,mBAAmB,CAAE;AACpCb,MAAM,CAACS,MAAM,CAAChK,IAAI,CAAE8J,OAAK,CAACM,mBAAmB,CAACjO,EAAE,CAAC,CAAC;AACnD;AACD;AACA,GAAI,MAAI,CAACsC,KAAK,SAAW,MAAI,CAACD,GAAK,CAAE;AACpC,GAAMsL,QAAK,CAAGnO,MAAM,CAACkH,sBAAsB,CAAC,MAAI,CAACpE,KAAK,CAAC;AACvD,GAAItC,EAAE,GAAI2N,QAAK,CAACM,mBAAmB,CAAE;AACpCb,MAAM,CAACS,MAAM,CAAChK,IAAI,CAAE8J,OAAK,CAACM,mBAAmB,CAACjO,EAAE,CAAC,CAAC;AACnD;AACD;AACA,GAAI,MAAI,CAACqC,GAAG,CAAG,CAAC,EAAI,MAAI,CAACC,KAAK,GAAK,YAAY,CAAE;AAChDuB,IAAI,CAACc,SAAS,CAAG,CAAC,CAAC,CAAE,YAAY,CAAC;AACnC;;AAEA,GAAMgJ,MAAK,CAAGnO,MAAM,CAACkH,sBAAsB,CAAC,MAAI,CAACpE,KAAK,CAAC;AACvD,GAAItC,EAAE,GAAI2N,MAAK,CAACO,YAAY,CAAErK,IAAI,CAAC2B,IAAI,CAAGmI,KAAK,CAACO,YAAY,CAAClO,EAAE,CAAC;AAChE,GAAI,CAAC6D,IAAI,CAAC2B,IAAI,EAAIxF,EAAE,CAACe,KAAK,CAAC,CAAC,CAAC,CAAC,GAAK,OAAO,CAAE;AAC3C8C,IAAI,CAAC2B,IAAI,CAAG,MAAI,CAACR,OAAO,CAACvB,GAAG,CAACzD,EAAE,CAACe,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,CAAC,CAACyE,IAAI;AACnD;AACA,GAAI,CAAC3B,IAAI,CAAC2B,IAAI,EAAI3B,IAAI,CAAC4B,WAAW,EAAI3F,IAAI,CAAC+D,IAAI,CAAC4B,WAAW,CAAC,GAAKzF,EAAE,CAAE;AACpE6D,IAAI,CAAC2B,IAAI,CAAG,MAAI,CAACR,OAAO,CAACvB,GAAG,CAACI,IAAI,CAAC4B,WAAW,CAAC,CAACD,IAAI;AACpD;AACA,GAAI3B,IAAI,CAACxB,GAAG,CAAG,MAAI,CAACA,GAAG,CAAEwB,IAAI,CAAC2B,IAAI,CAAG,SAAS;;AAE9C,GAAMR,QAAO,CAAG,GAAIU,QAAO,CAAC1F,EAAE,CAAEiC,IAAI,CAAE4B,IAAI,CAAC;AAC3C,MAAI,CAACtB,KAAK,CAACmD,OAAO,CAAC1F,EAAE,CAAC,CAAGgF,OAAO;AAChC,MAAOA,QAAO;AACf;AACD,CAAC;;AAEDe,KAAK,CAAG;AACPtC,GAAG,CAAE,SAACxB,IAAY,CAAa;AAC9B,GAAMjC,GAAE,CAAGF,IAAI,CAACmC,IAAI,CAAO;AAC3BA,IAAI,CAAGjC,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC+D,WAAW,EAAE,CAAGlG,EAAE,CAACmC,MAAM,CAAC,CAAC,CAAC;;AAEnD,GAAI,MAAI,CAACI,KAAK,CAACmL,KAAK,CAAClH,cAAc,CAACxG,EAAE,CAAC,CAAE,MAAO,OAAI,CAACuC,KAAK,CAACmL,KAAK,CAAC1N,EAAE,CAAC;;AAEpE,GAAI6D,KAAI,kBAAOzB,GAAG,CAAC2D,KAAK,CAACtC,GAAG,CAACxB,IAAI,CAAC,CAAC;;AAEnC,IAAK,GAAIX,EAAC,CAAG,CAAC,CAAEA,CAAC,EAAI,MAAI,CAACe,GAAG,CAAEf,CAAC,EAAE,CAAE;AACnC,GAAMqM,MAAK,CAAGnO,MAAM,CAACkH,sBAAsB,CAAC,KAAK,CAAGpF,CAAC,CAAC;AACtD,GAAItB,EAAE,GAAI2N,MAAK,CAACQ,UAAU,CAAE;AAC3BtK,IAAI,CAACC,MAAM,CAAG,KAAK;;AAEnB;AACD;AACA,GAAI9D,EAAE,GAAI2N,MAAK,CAACS,iBAAiB,CAAE;AAClCvK,IAAI,kBAAOA,IAAI,CAAK8J,KAAK,CAACS,iBAAiB,CAACpO,EAAE,CAAC,CAAC;AACjD;AACD;;AAEA,MAAI,CAACuC,KAAK,CAACmL,KAAK,CAAC1N,EAAE,CAAC,CAAG6D,IAAI;AAC3B,MAAOA,KAAI;AACZ;AACD,CAAC,CAhKA,IAAI,CAACvB,KAAK,CAAGA,KAAK,CAClB,GAAMD,IAAG,CAAGgM,QAAQ,CAAC/L,KAAK,CAACH,MAAM,CAAC,CAAC,CAAE,CAAC,CAAC,CAAE,EAAE,CAAC,CAC5C,GAAI,CAACG,KAAK,CAACiD,UAAU,CAAC,KAAK,CAAC,EAAI,CAAClD,GAAG,CAAE,KAAM,IAAIZ,MAAK,CAAC,mBAAmB,CAAC,CAC1E,IAAI,CAACY,GAAG,CAAGA,GAAG,CACf,CAAC;;AA8JD8K,YAAY,CAAZ,uBAAe;AACd,GAAI,IAAI,CAACzK,SAAS,CAAE,MAAO,KAAI,CAACA,SAAS;AACzC,IAAI,CAACA,SAAS,CAAG,EAAE;AACnB,GAAI,CAAClD,MAAM,CAACgF,WAAW,CAAEhF,MAAM,CAACgF,WAAW,CAAG,CAAC,CAAC,CAAC;AAC9B4I,MAAM,CAACC,MAAM,CAAC7N,MAAM,CAACgF,WAAW,CAAC,wBAAiB,CAAhE,GAAMX,KAAI;AACd,GAAIA,IAAI,CAACxB,GAAG,EAAIwB,IAAI,CAACxB,GAAG,CAAG,IAAI,CAACA,GAAG,CAAE;AACrC,GAAI,CAACwB,IAAI,CAACyJ,UAAU,CAAE;AACtB,IAAI,CAAC5K,SAAS,CAAC5B,IAAI,CAAC+C,IAAI,CAAC5B,IAAI,CAAC;AAC/B;AACA,MAAO,KAAI,CAACS,SAAS;AACtB,CAAC;;;AAGF,GAAI,MAAO4L,QAAO,GAAK,UAAU,CAAE;;AAEjC7O,MAAM,CAAS2C,GAAG,CAAGA,GAAG;AACxB3C,MAAM,CAASK,IAAI,CAAGA,IAAI;AAC5B"}