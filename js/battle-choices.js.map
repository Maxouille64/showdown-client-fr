{"version":3,"file":"battle-choices.js","names":["BattleChoiceBuilder","request","choices","current","choiceType","move","targetLoc","mega","ultra","z","max","tera","alreadySwitchingIn","alreadyMega","alreadyMax","alreadyZ","alreadyTera","fillPasses","toString","concat","stringChoice","join","replace","isDone","length","requestLength","isEmpty","choice","index","requestType","active","forceSwitch","maxTeamSize","currentMoveRequest","addChoice","choiceString","parseChoice","err","message","choosableTargets","includes","getChosenMove","target","targetPokemon","i","splice","push","pokemonIndex","activePokemon","moveIndex","zMoves","maxMoves","canDynamax","moves","Error","startsWith","moveRequest","slice","test","toID","parseInt","trim","endsWith","moveid","id","isTeamPreview","lowerChoice","toLowerCase","choiceid","matchLevel","match","side","pokemon","serverPokemon","curMatchLevel","name","speciesForme","Dex","species","get","baseSpecies","fainted","boost","fixRequest","battle","teamPreview","wait","noCancel","parseDetails","ident","substr","details","parseHealth","condition","map","canGigantamax","gigantamax","canZMove"],"sources":["../src/battle-choices.ts"],"sourcesContent":["/**\n * Battle choices\n *\n * PS will send requests \"what do you do this turn?\", and you send back\n * choices \"I switch Pikachu for Caterpie, and Squirtle uses Water Gun\"\n *\n * This file contains classes for handling requests and choices.\n *\n * Dependencies: battle-dex\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license MIT\n */\n\ninterface BattleRequestSideInfo {\n\tname: string;\n\tid: 'p1' | 'p2' | 'p3' | 'p4';\n\tpokemon: ServerPokemon[];\n}\ninterface BattleRequestActivePokemon {\n\tmoves: {\n\t\tname: string,\n\t\tid: ID,\n\t\tpp: number,\n\t\tmaxpp: number,\n\t\ttarget: MoveTarget,\n\t\tdisabled?: boolean,\n\t}[];\n\tmaxMoves?: {\n\t\tname: string,\n\t\tid: ID,\n\t\ttarget: MoveTarget,\n\t\tdisabled?: boolean,\n\t}[];\n\tzMoves?: ({\n\t\tname: string,\n\t\tid: ID,\n\t\ttarget: MoveTarget,\n\t} | null)[];\n\t/** also true if the pokemon can Gigantamax */\n\tcanDynamax?: boolean;\n\tcanGigantamax?: boolean;\n\tcanMegaEvo?: boolean;\n\tcanUltraBurst?: boolean;\n\tcanTerastallize?: boolean;\n\ttrapped?: boolean;\n\tmaybeTrapped?: boolean;\n}\n\ninterface BattleMoveRequest {\n\trequestType: 'move';\n\trqid: number;\n\tside: BattleRequestSideInfo;\n\tactive: (BattleRequestActivePokemon | null)[];\n\tnoCancel?: boolean;\n}\ninterface BattleSwitchRequest {\n\trequestType: 'switch';\n\trqid: number;\n\tside: BattleRequestSideInfo;\n\tforceSwitch: boolean[];\n\tnoCancel?: boolean;\n}\ninterface BattleTeamRequest {\n\trequestType: 'team';\n\trqid: number;\n\tside: BattleRequestSideInfo;\n\tmaxTeamSize?: number;\n\tnoCancel?: boolean;\n}\ninterface BattleWaitRequest {\n\trequestType: 'wait';\n\trqid: number;\n\tside: undefined;\n\tnoCancel?: boolean;\n}\ntype BattleRequest = BattleMoveRequest | BattleSwitchRequest | BattleTeamRequest | BattleWaitRequest;\n\ninterface BattleMoveChoice {\n\tchoiceType: 'move';\n\t/** 1-based move */\n\tmove: number;\n\ttargetLoc: number;\n\tmega: boolean;\n\tultra: boolean;\n\tmax: boolean;\n\tz: boolean;\n\ttera: boolean;\n}\ninterface BattleShiftChoice {\n\tchoiceType: 'shift';\n}\ninterface BattleSwitchChoice {\n\tchoiceType: 'switch' | 'team';\n\t/** 1-based pokemon */\n\ttargetPokemon: number;\n}\ntype BattleChoice = BattleMoveChoice | BattleShiftChoice | BattleSwitchChoice;\n\n/**\n * Tracks a partial choice, allowing you to build it up one step at a time,\n * and maybe even construct a UI to build it!\n *\n * Doesn't support going backwards; just use `new BattleChoiceBuilder`.\n */\nclass BattleChoiceBuilder {\n\trequest: BattleRequest;\n\t/** Completed choices in string form */\n\tchoices: string[] = [];\n\t/** Currently active partial move choice - not used for other choices, which don't have partial states */\n\tcurrent: BattleMoveChoice = {\n\t\tchoiceType: 'move',\n\t\t/** if nonzero, show target screen; if zero, show move screen */\n\t\tmove: 0,\n\t\ttargetLoc: 0, // should always be 0: is not partial if `targetLoc` is known\n\t\tmega: false,\n\t\tultra: false,\n\t\tz: false,\n\t\tmax: false,\n\t\ttera: false,\n\t};\n\talreadySwitchingIn: number[] = [];\n\talreadyMega = false;\n\talreadyMax = false;\n\talreadyZ = false;\n\talreadyTera = false;\n\n\tconstructor(request: BattleRequest) {\n\t\tthis.request = request;\n\t\tthis.fillPasses();\n\t}\n\n\ttoString() {\n\t\tlet choices = this.choices;\n\t\tif (this.current.move) choices = choices.concat(this.stringChoice(this.current));\n\t\treturn choices.join(', ').replace(/, team /g, ', ');\n\t}\n\n\tisDone() {\n\t\treturn this.choices.length >= this.requestLength();\n\t}\n\tisEmpty() {\n\t\tfor (const choice of this.choices) {\n\t\t\tif (choice !== 'pass') return false;\n\t\t}\n\t\tif (this.current.move) return false;\n\t\treturn true;\n\t}\n\n\t/** Index of the current Pokémon to make choices for */\n\tindex() {\n\t\treturn this.choices.length;\n\t}\n\t/** How many choices is the server expecting? */\n\trequestLength() {\n\t\tconst request = this.request;\n\t\tswitch (request.requestType) {\n\t\tcase 'move':\n\t\t\treturn request.active.length;\n\t\tcase 'switch':\n\t\t\treturn request.forceSwitch.length;\n\t\tcase 'team':\n\t\t\tif (request.maxTeamSize) return request.maxTeamSize;\n\t\t\treturn 1;\n\t\tcase 'wait':\n\t\t\treturn 0;\n\t\t}\n\t}\n\tcurrentMoveRequest() {\n\t\tif (this.request.requestType !== 'move') return null;\n\t\treturn this.request.active[this.index()];\n\t}\n\n\taddChoice(choiceString: string) {\n\t\tlet choice: BattleChoice | null;\n\t\ttry {\n\t\t\tchoice = this.parseChoice(choiceString);\n\t\t} catch (err) {\n\t\t\treturn (err as Error).message;\n\t\t}\n\t\tif (!choice) {\n\t\t\treturn \"You do not need to manually choose to pass; the client handles it for you automatically\";\n\t\t}\n\t\tif (choice.choiceType === 'move') {\n\t\t\tif (!choice.targetLoc && this.requestLength() > 1) {\n\t\t\t\tconst choosableTargets = ['normal', 'any', 'adjacentAlly', 'adjacentAllyOrSelf', 'adjacentFoe'];\n\t\t\t\tif (choosableTargets.includes(this.getChosenMove(choice, this.index()).target)) {\n\t\t\t\t\tthis.current.move = choice.move;\n\t\t\t\t\tthis.current.mega = choice.mega;\n\t\t\t\t\tthis.current.ultra = choice.ultra;\n\t\t\t\t\tthis.current.z = choice.z;\n\t\t\t\t\tthis.current.max = choice.max;\n\t\t\t\t\tthis.current.tera = choice.tera;\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (choice.mega) this.alreadyMega = true;\n\t\t\tif (choice.z) this.alreadyZ = true;\n\t\t\tif (choice.max) this.alreadyMax = true;\n\t\t\tif (choice.tera) this.alreadyTera = true;\n\t\t\tthis.current.move = 0;\n\t\t\tthis.current.mega = false;\n\t\t\tthis.current.ultra = false;\n\t\t\tthis.current.z = false;\n\t\t\tthis.current.max = false;\n\t\t\tthis.current.tera = false;\n\t\t} else if (choice.choiceType === 'switch' || choice.choiceType === 'team') {\n\t\t\tif (this.alreadySwitchingIn.includes(choice.targetPokemon)) {\n\t\t\t\tif (choice.choiceType === 'switch') {\n\t\t\t\t\treturn \"You've already chosen to switch that Pokémon in\";\n\t\t\t\t}\n\t\t\t\t// remove choice instead\n\t\t\t\tfor (let i = 0; i < this.alreadySwitchingIn.length; i++) {\n\t\t\t\t\tif (this.alreadySwitchingIn[i] === choice.targetPokemon) {\n\t\t\t\t\t\tthis.alreadySwitchingIn.splice(i, 1);\n\t\t\t\t\t\tthis.choices.splice(i, 1);\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn \"Unexpected bug, please report this\";\n\t\t\t}\n\t\t\tthis.alreadySwitchingIn.push(choice.targetPokemon);\n\t\t} else if (choice.choiceType === 'shift') {\n\t\t\tif (this.index() === 1) {\n\t\t\t\treturn \"Only Pokémon not already in the center can shift to the center\";\n\t\t\t}\n\t\t}\n\t\tthis.choices.push(this.stringChoice(choice));\n\t\tthis.fillPasses();\n\t\treturn null;\n\t}\n\n\t/**\n\t * Move and switch requests will often skip over some active Pokémon (mainly\n\t * fainted Pokémon). This will fill them in automatically, so we don't need\n\t * to ask a user for them.\n\t */\n\tfillPasses() {\n\t\tconst request = this.request;\n\t\tswitch (request.requestType) {\n\t\tcase 'move':\n\t\t\twhile (this.choices.length < request.active.length && !request.active[this.choices.length]) {\n\t\t\t\tthis.choices.push('pass');\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 'switch':\n\t\t\twhile (this.choices.length < request.forceSwitch.length && !request.forceSwitch[this.choices.length]) {\n\t\t\t\tthis.choices.push('pass');\n\t\t\t}\n\t\t}\n\t}\n\n\tgetChosenMove(choice: BattleMoveChoice, pokemonIndex: number) {\n\t\tconst request = this.request as BattleMoveRequest;\n\t\tconst activePokemon = request.active[pokemonIndex]!;\n\t\tconst moveIndex = choice.move - 1;\n\t\tif (choice.z) {\n\t\t\treturn activePokemon.zMoves![moveIndex]!;\n\t\t}\n\t\tif (choice.max || (activePokemon.maxMoves && !activePokemon.canDynamax)) {\n\t\t\treturn activePokemon.maxMoves![moveIndex];\n\t\t}\n\t\treturn activePokemon.moves[moveIndex];\n\t}\n\n\t/**\n\t * Parses a choice from string form to BattleChoice form\n\t */\n\tparseChoice(choice: string): BattleChoice | null {\n\t\tconst request = this.request;\n\t\tif (request.requestType === 'wait') throw new Error(`It's not your turn to choose anything`);\n\n\t\tconst index = this.choices.length;\n\n\t\tif (choice === 'shift') return {choiceType: 'shift'};\n\n\t\tif (choice.startsWith('move ')) {\n\t\t\tif (request.requestType !== 'move') {\n\t\t\t\tthrow new Error(`You must switch in a Pokémon, not move.`);\n\t\t\t}\n\t\t\tconst moveRequest = request.active[index]!;\n\t\t\tchoice = choice.slice(5);\n\t\t\tlet current: BattleMoveChoice = {\n\t\t\t\tchoiceType: 'move',\n\t\t\t\tmove: 0,\n\t\t\t\ttargetLoc: 0,\n\t\t\t\tmega: false,\n\t\t\t\tultra: false,\n\t\t\t\tz: false,\n\t\t\t\tmax: false,\n\t\t\t\ttera: false,\n\t\t\t};\n\t\t\twhile (true) {\n\t\t\t\t// If data ends with a number, treat it as a target location.\n\t\t\t\t// We need to special case 'Conversion 2' so it doesn't get\n\t\t\t\t// confused with 'Conversion' erroneously sent with the target\n\t\t\t\t// '2' (since Conversion targets 'self', targetLoc can't be 2).\n\t\t\t\tif (/\\s(?:-|\\+)?[1-3]$/.test(choice) && toID(choice) !== 'conversion2') {\n\t\t\t\t\tif (current.targetLoc) throw new Error(`Move choice has multiple targets`);\n\t\t\t\t\tcurrent.targetLoc = parseInt(choice.slice(-2), 10);\n\t\t\t\t\tchoice = choice.slice(0, -2).trim();\n\t\t\t\t} else if (choice.endsWith(' mega')) {\n\t\t\t\t\tcurrent.mega = true;\n\t\t\t\t\tchoice = choice.slice(0, -5);\n\t\t\t\t} else if (choice.endsWith(' zmove')) {\n\t\t\t\t\tcurrent.z = true;\n\t\t\t\t\tchoice = choice.slice(0, -6);\n\t\t\t\t} else if (choice.endsWith(' ultra')) {\n\t\t\t\t\tcurrent.ultra = true;\n\t\t\t\t\tchoice = choice.slice(0, -6);\n\t\t\t\t} else if (choice.endsWith(' dynamax')) {\n\t\t\t\t\tcurrent.max = true;\n\t\t\t\t\tchoice = choice.slice(0, -8);\n\t\t\t\t} else if (choice.endsWith(' max')) {\n\t\t\t\t\tcurrent.max = true;\n\t\t\t\t\tchoice = choice.slice(0, -4);\n\t\t\t\t} else if (choice.endsWith(' terastallize')) {\n\t\t\t\t\tcurrent.tera = true;\n\t\t\t\t\tchoice = choice.slice(0, -13);\n\t\t\t\t} else if (choice.endsWith(' terastal')) {\n\t\t\t\t\tcurrent.tera = true;\n\t\t\t\t\tchoice = choice.slice(0, -9);\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (/^[0-9]+$/.test(choice)) {\n\t\t\t\t// Parse a one-based move index.\n\t\t\t\tcurrent.move = parseInt(choice, 10);\n\t\t\t} else {\n\t\t\t\t// Parse a move ID.\n\t\t\t\t// Move names are also allowed, but may cause ambiguity (see client issue #167).\n\t\t\t\tlet moveid = toID(choice);\n\t\t\t\tif (moveid.startsWith('hiddenpower')) moveid = 'hiddenpower' as ID;\n\n\t\t\t\tfor (let i = 0; i < moveRequest.moves.length; i++) {\n\t\t\t\t\tif (moveid === moveRequest.moves[i].id) {\n\t\t\t\t\t\tcurrent.move = i + 1;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!current.move && moveRequest.zMoves) {\n\t\t\t\t\tfor (let i = 0; i < moveRequest.zMoves.length; i++) {\n\t\t\t\t\t\tif (!moveRequest.zMoves[i]) continue;\n\t\t\t\t\t\tif (moveid === moveRequest.zMoves[i]!.id) {\n\t\t\t\t\t\t\tcurrent.move = i + 1;\n\t\t\t\t\t\t\tcurrent.z = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!current.move && moveRequest.maxMoves) {\n\t\t\t\t\tfor (let i = 0; i < moveRequest.maxMoves.length; i++) {\n\t\t\t\t\t\tif (moveid === moveRequest.maxMoves[i].id) {\n\t\t\t\t\t\t\tcurrent.move = i + 1;\n\t\t\t\t\t\t\tcurrent.max = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (current.max && !moveRequest.canDynamax) current.max = false;\n\t\t\treturn current;\n\t\t}\n\n\t\tif (choice.startsWith('switch ') || choice.startsWith('team ')) {\n\t\t\tchoice = choice.slice(choice.startsWith('team ') ? 5 : 7);\n\t\t\tconst isTeamPreview = request.requestType === 'team';\n\t\t\tlet current: BattleSwitchChoice = {\n\t\t\t\tchoiceType: isTeamPreview ? 'team' : 'switch',\n\t\t\t\ttargetPokemon: 0,\n\t\t\t};\n\t\t\tif (/^[0-9]+$/.test(choice)) {\n\t\t\t\t// Parse a one-based move index.\n\t\t\t\tcurrent.targetPokemon = parseInt(choice, 10);\n\t\t\t} else {\n\t\t\t\t// Parse a pokemon name\n\t\t\t\tconst lowerChoice = choice.toLowerCase();\n\t\t\t\tconst choiceid = toID(choice);\n\t\t\t\tlet matchLevel = 0;\n\t\t\t\tlet match = 0;\n\t\t\t\tfor (let i = 0 ; i < request.side.pokemon.length; i++) {\n\t\t\t\t\tconst serverPokemon = request.side.pokemon[i];\n\t\t\t\t\tlet curMatchLevel = 0;\n\t\t\t\t\tif (choice === serverPokemon.name) {\n\t\t\t\t\t\tcurMatchLevel = 10;\n\t\t\t\t\t} else if (lowerChoice === serverPokemon.name.toLowerCase()) {\n\t\t\t\t\t\tcurMatchLevel = 9;\n\t\t\t\t\t} else if (choiceid === toID(serverPokemon.name)) {\n\t\t\t\t\t\tcurMatchLevel = 8;\n\t\t\t\t\t} else if (choiceid === toID(serverPokemon.speciesForme)) {\n\t\t\t\t\t\tcurMatchLevel = 7;\n\t\t\t\t\t} else if (choiceid === toID(Dex.species.get(serverPokemon.speciesForme).baseSpecies)) {\n\t\t\t\t\t\tcurMatchLevel = 6;\n\t\t\t\t\t}\n\t\t\t\t\tif (curMatchLevel > matchLevel) {\n\t\t\t\t\t\tmatch = i + 1;\n\t\t\t\t\t\tmatchLevel = curMatchLevel;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!match) {\n\t\t\t\t\tthrow new Error(`Couldn't find Pokémon \"${choice}\" to switch to`);\n\t\t\t\t}\n\t\t\t\tcurrent.targetPokemon = match;\n\t\t\t}\n\t\t\tif (!isTeamPreview && current.targetPokemon - 1 < this.requestLength()) {\n\t\t\t\tthrow new Error(`That Pokémon is already in battle!`);\n\t\t\t}\n\t\t\tconst target = request.side.pokemon[current.targetPokemon - 1];\n\t\t\tif (!target) {\n\t\t\t\tthrow new Error(`Couldn't find Pokémon \"${choice}\" to switch to!`);\n\t\t\t}\n\t\t\tif (target.fainted) {\n\t\t\t\tthrow new Error(`${target} is fainted and cannot battle!`);\n\t\t\t}\n\t\t\treturn current;\n\t\t}\n\n\t\tif (choice === 'pass') return null;\n\n\t\tthrow new Error(`Unrecognized choice \"${choice}\"`);\n\t}\n\n\t/**\n\t * Converts a choice from `BattleChoice` into string form\n\t */\n\tstringChoice(choice: BattleChoice | null) {\n\t\tif (!choice) return `pass`;\n\t\tswitch (choice.choiceType) {\n\t\tcase 'move':\n\t\t\tconst target = choice.targetLoc ? ` ${choice.targetLoc > 0 ? '+' : ''}${choice.targetLoc}` : ``;\n\t\t\tconst boost = `${choice.max ? ' max' : ''}${choice.mega ? ' mega' : ''}${choice.z ? ' zmove' : ''}${choice.tera ? ' terastallize' : ''}`;\n\t\t\treturn `move ${choice.move}${boost}${target}`;\n\t\tcase 'switch':\n\t\tcase 'team':\n\t\t\treturn `${choice.choiceType} ${choice.targetPokemon}`;\n\t\tcase 'shift':\n\t\t\treturn `shift`;\n\t\t}\n\t}\n\n\t/**\n\t * The request sent from the server is actually really gross, but we'll have\n\t * to wait until we transition to the new client before fixing it in the\n\t * protocol, in the interests of not needing to fix it twice (or needing to\n\t * fix it without TypeScript).\n\t *\n\t * In the meantime, this function converts a request from a shitty request\n\t * to a request that makes sense.\n\t *\n\t * I'm sorry for literally all of this.\n\t */\n\tstatic fixRequest(request: any, battle: Battle) {\n\t\tif (!request.requestType) {\n\t\t\trequest.requestType = 'move';\n\t\t\tif (request.forceSwitch) {\n\t\t\t\trequest.requestType = 'switch';\n\t\t\t} else if (request.teamPreview) {\n\t\t\t\trequest.requestType = 'team';\n\t\t\t} else if (request.wait) {\n\t\t\t\trequest.requestType = 'wait';\n\t\t\t}\n\t\t}\n\n\t\tif (request.requestType === 'wait') request.noCancel = true;\n\t\tif (request.side) {\n\t\t\tfor (const serverPokemon of request.side.pokemon) {\n\t\t\t\tbattle.parseDetails(serverPokemon.ident.substr(4), serverPokemon.ident, serverPokemon.details, serverPokemon);\n\t\t\t\tbattle.parseHealth(serverPokemon.condition, serverPokemon);\n\t\t\t}\n\t\t}\n\n\t\tif (request.active) {\n\t\t\trequest.active = request.active.map(\n\t\t\t\t(active: any, i: number) => request.side.pokemon[i].fainted ? null : active\n\t\t\t);\n\t\t\tfor (const active of request.active) {\n\t\t\t\tif (!active) continue;\n\t\t\t\tfor (const move of active.moves) {\n\t\t\t\t\tif (move.move) move.name = move.move;\n\t\t\t\t\tmove.id = toID(move.name);\n\t\t\t\t}\n\t\t\t\tif (active.maxMoves) {\n\t\t\t\t\tif (active.maxMoves.maxMoves) {\n\t\t\t\t\t\tactive.canGigantamax = active.maxMoves.gigantamax;\n\t\t\t\t\t\tactive.maxMoves = active.maxMoves.maxMoves;\n\t\t\t\t\t}\n\t\t\t\t\tfor (const move of active.maxMoves) {\n\t\t\t\t\t\tif (move.move) move.name = Dex.moves.get(move.move).name;\n\t\t\t\t\t\tmove.id = toID(move.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (active.canZMove) {\n\t\t\t\t\tactive.zMoves = active.canZMove;\n\t\t\t\t\tfor (const move of active.zMoves) {\n\t\t\t\t\t\tif (!move) continue;\n\t\t\t\t\t\tif (move.move) move.name = move.move;\n\t\t\t\t\t\tmove.id = toID(move.name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAZA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyGMA,mBAAmB;;;;;;;;;;;;;;;;;;;;;;AAsBxB,6BAAYC,OAAsB,CAAE,MArBpCA,OAAO,aAEPC,OAAO,CAAa,EAAE,MAEtBC,OAAO,CAAqB,CAC3BC,UAAU,CAAE,MAAM,CAElBC,IAAI,CAAE,CAAC,CACPC,SAAS,CAAE,CAAC,CACZC,IAAI,CAAE,KAAK,CACXC,KAAK,CAAE,KAAK,CACZC,CAAC,CAAE,KAAK,CACRC,GAAG,CAAE,KAAK,CACVC,IAAI,CAAE,KACP,CAAC,MACDC,kBAAkB,CAAa,EAAE,MACjCC,WAAW,CAAG,KAAK,MACnBC,UAAU,CAAG,KAAK,MAClBC,QAAQ,CAAG,KAAK,MAChBC,WAAW,CAAG,KAAK;AAGlB,IAAI,CAACf,OAAO,CAAGA,OAAO;AACtB,IAAI,CAACgB,UAAU,EAAE;AAClB,CAAC;;AAEDC,QAAQ,CAAR,mBAAW;AACV,GAAIhB,QAAO,CAAG,IAAI,CAACA,OAAO;AAC1B,GAAI,IAAI,CAACC,OAAO,CAACE,IAAI,CAAEH,OAAO,CAAGA,OAAO,CAACiB,MAAM,CAAC,IAAI,CAACC,YAAY,CAAC,IAAI,CAACjB,OAAO,CAAC,CAAC;AAChF,MAAOD,QAAO,CAACmB,IAAI,CAAC,IAAI,CAAC,CAACC,OAAO,CAAC,UAAU,CAAE,IAAI,CAAC;AACpD,CAAC;;AAEDC,MAAM,CAAN,iBAAS;AACR,MAAO,KAAI,CAACrB,OAAO,CAACsB,MAAM,EAAI,IAAI,CAACC,aAAa,EAAE;AACnD,CAAC;AACDC,OAAO,CAAP,kBAAU;AACY,IAAI,CAACxB,OAAO,8BAAE,CAA9B,GAAMyB,OAAM;AAChB,GAAIA,MAAM,GAAK,MAAM,CAAE,MAAO,MAAK;AACpC;AACA,GAAI,IAAI,CAACxB,OAAO,CAACE,IAAI,CAAE,MAAO,MAAK;AACnC,MAAO,KAAI;AACZ,CAAC;;;AAGDuB,KAAK,CAAL,gBAAQ;AACP,MAAO,KAAI,CAAC1B,OAAO,CAACsB,MAAM;AAC3B,CAAC;;AAEDC,aAAa,CAAb,wBAAgB;AACf,GAAMxB,QAAO,CAAG,IAAI,CAACA,OAAO;AAC5B,OAAQA,OAAO,CAAC4B,WAAW;AAC3B,IAAK,MAAM;AACV,MAAO5B,QAAO,CAAC6B,MAAM,CAACN,MAAM;AAC7B,IAAK,QAAQ;AACZ,MAAOvB,QAAO,CAAC8B,WAAW,CAACP,MAAM;AAClC,IAAK,MAAM;AACV,GAAIvB,OAAO,CAAC+B,WAAW,CAAE,MAAO/B,QAAO,CAAC+B,WAAW;AACnD,MAAO,EAAC;AACT,IAAK,MAAM;AACV,MAAO,EAAC,CAAC;;AAEX,CAAC;AACDC,kBAAkB,CAAlB,6BAAqB;AACpB,GAAI,IAAI,CAAChC,OAAO,CAAC4B,WAAW,GAAK,MAAM,CAAE,MAAO,KAAI;AACpD,MAAO,KAAI,CAAC5B,OAAO,CAAC6B,MAAM,CAAC,IAAI,CAACF,KAAK,EAAE,CAAC;AACzC,CAAC;;AAEDM,SAAS,CAAT,mBAAUC,YAAoB,CAAE;AAC/B,GAAIR,OAA2B;AAC/B,GAAI;AACHA,MAAM,CAAG,IAAI,CAACS,WAAW,CAACD,YAAY,CAAC;AACxC,CAAE,MAAOE,GAAG,CAAE;AACb,MAAQA,IAAG,CAAWC,OAAO;AAC9B;AACA,GAAI,CAACX,MAAM,CAAE;AACZ,MAAO,yFAAyF;AACjG;AACA,GAAIA,MAAM,CAACvB,UAAU,GAAK,MAAM,CAAE;AACjC,GAAI,CAACuB,MAAM,CAACrB,SAAS,EAAI,IAAI,CAACmB,aAAa,EAAE,CAAG,CAAC,CAAE;AAClD,GAAMc,iBAAgB,CAAG,CAAC,QAAQ,CAAE,KAAK,CAAE,cAAc,CAAE,oBAAoB,CAAE,aAAa,CAAC;AAC/F,GAAIA,gBAAgB,CAACC,QAAQ,CAAC,IAAI,CAACC,aAAa,CAACd,MAAM,CAAE,IAAI,CAACC,KAAK,EAAE,CAAC,CAACc,MAAM,CAAC,CAAE;AAC/E,IAAI,CAACvC,OAAO,CAACE,IAAI,CAAGsB,MAAM,CAACtB,IAAI;AAC/B,IAAI,CAACF,OAAO,CAACI,IAAI,CAAGoB,MAAM,CAACpB,IAAI;AAC/B,IAAI,CAACJ,OAAO,CAACK,KAAK,CAAGmB,MAAM,CAACnB,KAAK;AACjC,IAAI,CAACL,OAAO,CAACM,CAAC,CAAGkB,MAAM,CAAClB,CAAC;AACzB,IAAI,CAACN,OAAO,CAACO,GAAG,CAAGiB,MAAM,CAACjB,GAAG;AAC7B,IAAI,CAACP,OAAO,CAACQ,IAAI,CAAGgB,MAAM,CAAChB,IAAI;AAC/B,MAAO,KAAI;AACZ;AACD;AACA,GAAIgB,MAAM,CAACpB,IAAI,CAAE,IAAI,CAACM,WAAW,CAAG,IAAI;AACxC,GAAIc,MAAM,CAAClB,CAAC,CAAE,IAAI,CAACM,QAAQ,CAAG,IAAI;AAClC,GAAIY,MAAM,CAACjB,GAAG,CAAE,IAAI,CAACI,UAAU,CAAG,IAAI;AACtC,GAAIa,MAAM,CAAChB,IAAI,CAAE,IAAI,CAACK,WAAW,CAAG,IAAI;AACxC,IAAI,CAACb,OAAO,CAACE,IAAI,CAAG,CAAC;AACrB,IAAI,CAACF,OAAO,CAACI,IAAI,CAAG,KAAK;AACzB,IAAI,CAACJ,OAAO,CAACK,KAAK,CAAG,KAAK;AAC1B,IAAI,CAACL,OAAO,CAACM,CAAC,CAAG,KAAK;AACtB,IAAI,CAACN,OAAO,CAACO,GAAG,CAAG,KAAK;AACxB,IAAI,CAACP,OAAO,CAACQ,IAAI,CAAG,KAAK;AAC1B,CAAC,IAAM,IAAIgB,MAAM,CAACvB,UAAU,GAAK,QAAQ,EAAIuB,MAAM,CAACvB,UAAU,GAAK,MAAM,CAAE;AAC1E,GAAI,IAAI,CAACQ,kBAAkB,CAAC4B,QAAQ,CAACb,MAAM,CAACgB,aAAa,CAAC,CAAE;AAC3D,GAAIhB,MAAM,CAACvB,UAAU,GAAK,QAAQ,CAAE;AACnC,MAAO,iDAAiD;AACzD;;AAEA,IAAK,GAAIwC,EAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,IAAI,CAAChC,kBAAkB,CAACY,MAAM,CAAEoB,CAAC,EAAE,CAAE;AACxD,GAAI,IAAI,CAAChC,kBAAkB,CAACgC,CAAC,CAAC,GAAKjB,MAAM,CAACgB,aAAa,CAAE;AACxD,IAAI,CAAC/B,kBAAkB,CAACiC,MAAM,CAACD,CAAC,CAAE,CAAC,CAAC;AACpC,IAAI,CAAC1C,OAAO,CAAC2C,MAAM,CAACD,CAAC,CAAE,CAAC,CAAC;AACzB,MAAO,KAAI;AACZ;AACD;AACA,MAAO,oCAAoC;AAC5C;AACA,IAAI,CAAChC,kBAAkB,CAACkC,IAAI,CAACnB,MAAM,CAACgB,aAAa,CAAC;AACnD,CAAC,IAAM,IAAIhB,MAAM,CAACvB,UAAU,GAAK,OAAO,CAAE;AACzC,GAAI,IAAI,CAACwB,KAAK,EAAE,GAAK,CAAC,CAAE;AACvB,MAAO,gEAAgE;AACxE;AACD;AACA,IAAI,CAAC1B,OAAO,CAAC4C,IAAI,CAAC,IAAI,CAAC1B,YAAY,CAACO,MAAM,CAAC,CAAC;AAC5C,IAAI,CAACV,UAAU,EAAE;AACjB,MAAO,KAAI;AACZ,CAAC;;;;;;;AAODA,UAAU,CAAV,qBAAa;AACZ,GAAMhB,QAAO,CAAG,IAAI,CAACA,OAAO;AAC5B,OAAQA,OAAO,CAAC4B,WAAW;AAC3B,IAAK,MAAM;AACV,MAAO,IAAI,CAAC3B,OAAO,CAACsB,MAAM,CAAGvB,OAAO,CAAC6B,MAAM,CAACN,MAAM,EAAI,CAACvB,OAAO,CAAC6B,MAAM,CAAC,IAAI,CAAC5B,OAAO,CAACsB,MAAM,CAAC,CAAE;AAC3F,IAAI,CAACtB,OAAO,CAAC4C,IAAI,CAAC,MAAM,CAAC;AAC1B;AACA;AACD,IAAK,QAAQ;AACZ,MAAO,IAAI,CAAC5C,OAAO,CAACsB,MAAM,CAAGvB,OAAO,CAAC8B,WAAW,CAACP,MAAM,EAAI,CAACvB,OAAO,CAAC8B,WAAW,CAAC,IAAI,CAAC7B,OAAO,CAACsB,MAAM,CAAC,CAAE;AACrG,IAAI,CAACtB,OAAO,CAAC4C,IAAI,CAAC,MAAM,CAAC;AAC1B,CAAC;;AAEH,CAAC;;AAEDL,aAAa,CAAb,uBAAcd,MAAwB,CAAEoB,YAAoB,CAAE;AAC7D,GAAM9C,QAAO,CAAG,IAAI,CAACA,OAA4B;AACjD,GAAM+C,cAAa,CAAG/C,OAAO,CAAC6B,MAAM,CAACiB,YAAY,CAAE;AACnD,GAAME,UAAS,CAAGtB,MAAM,CAACtB,IAAI,CAAG,CAAC;AACjC,GAAIsB,MAAM,CAAClB,CAAC,CAAE;AACb,MAAOuC,cAAa,CAACE,MAAM,CAAED,SAAS,CAAC;AACxC;AACA,GAAItB,MAAM,CAACjB,GAAG,EAAKsC,aAAa,CAACG,QAAQ,EAAI,CAACH,aAAa,CAACI,UAAW,CAAE;AACxE,MAAOJ,cAAa,CAACG,QAAQ,CAAEF,SAAS,CAAC;AAC1C;AACA,MAAOD,cAAa,CAACK,KAAK,CAACJ,SAAS,CAAC;AACtC,CAAC;;;;;AAKDb,WAAW,CAAX,qBAAYT,MAAc,CAAuB;AAChD,GAAM1B,QAAO,CAAG,IAAI,CAACA,OAAO;AAC5B,GAAIA,OAAO,CAAC4B,WAAW,GAAK,MAAM,CAAE,KAAM,IAAIyB,MAAK,yCAAyC;;AAE5F,GAAM1B,MAAK,CAAG,IAAI,CAAC1B,OAAO,CAACsB,MAAM;;AAEjC,GAAIG,MAAM,GAAK,OAAO,CAAE,MAAO,CAACvB,UAAU,CAAE,OAAO,CAAC;;AAEpD,GAAIuB,MAAM,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAAE;AAC/B,GAAItD,OAAO,CAAC4B,WAAW,GAAK,MAAM,CAAE;AACnC,KAAM,IAAIyB,MAAK,8CAA2C;AAC3D;AACA,GAAME,YAAW,CAAGvD,OAAO,CAAC6B,MAAM,CAACF,KAAK,CAAE;AAC1CD,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAC;AACxB,GAAItD,QAAyB,CAAG;AAC/BC,UAAU,CAAE,MAAM;AAClBC,IAAI,CAAE,CAAC;AACPC,SAAS,CAAE,CAAC;AACZC,IAAI,CAAE,KAAK;AACXC,KAAK,CAAE,KAAK;AACZC,CAAC,CAAE,KAAK;AACRC,GAAG,CAAE,KAAK;AACVC,IAAI,CAAE;AACP,CAAC;AACD,MAAO,IAAI,CAAE;;;;;AAKZ,GAAI,mBAAmB,CAAC+C,IAAI,CAAC/B,MAAM,CAAC,EAAIgC,IAAI,CAAChC,MAAM,CAAC,GAAK,aAAa,CAAE;AACvE,GAAIxB,OAAO,CAACG,SAAS,CAAE,KAAM,IAAIgD,MAAK,oCAAoC;AAC1EnD,OAAO,CAACG,SAAS,CAAGsD,QAAQ,CAACjC,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC;AAClD9B,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,CAACI,IAAI,EAAE;AACpC,CAAC,IAAM,IAAIlC,MAAM,CAACmC,QAAQ,CAAC,OAAO,CAAC,CAAE;AACpC3D,OAAO,CAACI,IAAI,CAAG,IAAI;AACnBoB,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC;AAC7B,CAAC,IAAM,IAAI9B,MAAM,CAACmC,QAAQ,CAAC,QAAQ,CAAC,CAAE;AACrC3D,OAAO,CAACM,CAAC,CAAG,IAAI;AAChBkB,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC;AAC7B,CAAC,IAAM,IAAI9B,MAAM,CAACmC,QAAQ,CAAC,QAAQ,CAAC,CAAE;AACrC3D,OAAO,CAACK,KAAK,CAAG,IAAI;AACpBmB,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC;AAC7B,CAAC,IAAM,IAAI9B,MAAM,CAACmC,QAAQ,CAAC,UAAU,CAAC,CAAE;AACvC3D,OAAO,CAACO,GAAG,CAAG,IAAI;AAClBiB,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC;AAC7B,CAAC,IAAM,IAAI9B,MAAM,CAACmC,QAAQ,CAAC,MAAM,CAAC,CAAE;AACnC3D,OAAO,CAACO,GAAG,CAAG,IAAI;AAClBiB,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC;AAC7B,CAAC,IAAM,IAAI9B,MAAM,CAACmC,QAAQ,CAAC,eAAe,CAAC,CAAE;AAC5C3D,OAAO,CAACQ,IAAI,CAAG,IAAI;AACnBgB,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAE,CAAC,EAAE,CAAC;AAC9B,CAAC,IAAM,IAAI9B,MAAM,CAACmC,QAAQ,CAAC,WAAW,CAAC,CAAE;AACxC3D,OAAO,CAACQ,IAAI,CAAG,IAAI;AACnBgB,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC;AAC7B,CAAC,IAAM;AACN;AACD;AACD;;AAEA,GAAI,UAAU,CAACC,IAAI,CAAC/B,MAAM,CAAC,CAAE;;AAE5BxB,OAAO,CAACE,IAAI,CAAGuD,QAAQ,CAACjC,MAAM,CAAE,EAAE,CAAC;AACpC,CAAC,IAAM;;;AAGN,GAAIoC,OAAM,CAAGJ,IAAI,CAAChC,MAAM,CAAC;AACzB,GAAIoC,MAAM,CAACR,UAAU,CAAC,aAAa,CAAC,CAAEQ,MAAM,CAAG,aAAmB;;AAElE,IAAK,GAAInB,EAAC,CAAG,CAAC,CAAEA,CAAC,CAAGY,WAAW,CAACH,KAAK,CAAC7B,MAAM,CAAEoB,CAAC,EAAE,CAAE;AAClD,GAAImB,MAAM,GAAKP,WAAW,CAACH,KAAK,CAACT,CAAC,CAAC,CAACoB,EAAE,CAAE;AACvC7D,OAAO,CAACE,IAAI,CAAGuC,CAAC,CAAG,CAAC;AACpB;AACD;AACD;AACA,GAAI,CAACzC,OAAO,CAACE,IAAI,EAAImD,WAAW,CAACN,MAAM,CAAE;AACxC,IAAK,GAAIN,IAAC,CAAG,CAAC,CAAEA,GAAC,CAAGY,WAAW,CAACN,MAAM,CAAC1B,MAAM,CAAEoB,GAAC,EAAE,CAAE;AACnD,GAAI,CAACY,WAAW,CAACN,MAAM,CAACN,GAAC,CAAC,CAAE;AAC5B,GAAImB,MAAM,GAAKP,WAAW,CAACN,MAAM,CAACN,GAAC,CAAC,CAAEoB,EAAE,CAAE;AACzC7D,OAAO,CAACE,IAAI,CAAGuC,GAAC,CAAG,CAAC;AACpBzC,OAAO,CAACM,CAAC,CAAG,IAAI;AAChB;AACD;AACD;AACD;AACA,GAAI,CAACN,OAAO,CAACE,IAAI,EAAImD,WAAW,CAACL,QAAQ,CAAE;AAC1C,IAAK,GAAIP,IAAC,CAAG,CAAC,CAAEA,GAAC,CAAGY,WAAW,CAACL,QAAQ,CAAC3B,MAAM,CAAEoB,GAAC,EAAE,CAAE;AACrD,GAAImB,MAAM,GAAKP,WAAW,CAACL,QAAQ,CAACP,GAAC,CAAC,CAACoB,EAAE,CAAE;AAC1C7D,OAAO,CAACE,IAAI,CAAGuC,GAAC,CAAG,CAAC;AACpBzC,OAAO,CAACO,GAAG,CAAG,IAAI;AAClB;AACD;AACD;AACD;AACD;AACA,GAAIP,OAAO,CAACO,GAAG,EAAI,CAAC8C,WAAW,CAACJ,UAAU,CAAEjD,OAAO,CAACO,GAAG,CAAG,KAAK;AAC/D,MAAOP,QAAO;AACf;;AAEA,GAAIwB,MAAM,CAAC4B,UAAU,CAAC,SAAS,CAAC,EAAI5B,MAAM,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAAE;AAC/D5B,MAAM,CAAGA,MAAM,CAAC8B,KAAK,CAAC9B,MAAM,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAAG,CAAC,CAAG,CAAC,CAAC;AACzD,GAAMU,cAAa,CAAGhE,OAAO,CAAC4B,WAAW,GAAK,MAAM;AACpD,GAAI1B,SAA2B,CAAG;AACjCC,UAAU,CAAE6D,aAAa,CAAG,MAAM,CAAG,QAAQ;AAC7CtB,aAAa,CAAE;AAChB,CAAC;AACD,GAAI,UAAU,CAACe,IAAI,CAAC/B,MAAM,CAAC,CAAE;;AAE5BxB,QAAO,CAACwC,aAAa,CAAGiB,QAAQ,CAACjC,MAAM,CAAE,EAAE,CAAC;AAC7C,CAAC,IAAM;;AAEN,GAAMuC,YAAW,CAAGvC,MAAM,CAACwC,WAAW,EAAE;AACxC,GAAMC,SAAQ,CAAGT,IAAI,CAAChC,MAAM,CAAC;AAC7B,GAAI0C,WAAU,CAAG,CAAC;AAClB,GAAIC,MAAK,CAAG,CAAC;AACb,IAAK,GAAI1B,IAAC,CAAG,CAAC,CAAGA,GAAC,CAAG3C,OAAO,CAACsE,IAAI,CAACC,OAAO,CAAChD,MAAM,CAAEoB,GAAC,EAAE,CAAE;AACtD,GAAM6B,cAAa,CAAGxE,OAAO,CAACsE,IAAI,CAACC,OAAO,CAAC5B,GAAC,CAAC;AAC7C,GAAI8B,cAAa,CAAG,CAAC;AACrB,GAAI/C,MAAM,GAAK8C,aAAa,CAACE,IAAI,CAAE;AAClCD,aAAa,CAAG,EAAE;AACnB,CAAC,IAAM,IAAIR,WAAW,GAAKO,aAAa,CAACE,IAAI,CAACR,WAAW,EAAE,CAAE;AAC5DO,aAAa,CAAG,CAAC;AAClB,CAAC,IAAM,IAAIN,QAAQ,GAAKT,IAAI,CAACc,aAAa,CAACE,IAAI,CAAC,CAAE;AACjDD,aAAa,CAAG,CAAC;AAClB,CAAC,IAAM,IAAIN,QAAQ,GAAKT,IAAI,CAACc,aAAa,CAACG,YAAY,CAAC,CAAE;AACzDF,aAAa,CAAG,CAAC;AAClB,CAAC,IAAM,IAAIN,QAAQ,GAAKT,IAAI,CAACkB,GAAG,CAACC,OAAO,CAACC,GAAG,CAACN,aAAa,CAACG,YAAY,CAAC,CAACI,WAAW,CAAC,CAAE;AACtFN,aAAa,CAAG,CAAC;AAClB;AACA,GAAIA,aAAa,CAAGL,UAAU,CAAE;AAC/BC,KAAK,CAAG1B,GAAC,CAAG,CAAC;AACbyB,UAAU,CAAGK,aAAa;AAC3B;AACD;AACA,GAAI,CAACJ,KAAK,CAAE;AACX,KAAM,IAAIhB,MAAK,+BAA2B3B,MAAM,mBAAiB;AAClE;AACAxB,QAAO,CAACwC,aAAa,CAAG2B,KAAK;AAC9B;AACA,GAAI,CAACL,aAAa,EAAI9D,QAAO,CAACwC,aAAa,CAAG,CAAC,CAAG,IAAI,CAAClB,aAAa,EAAE,CAAE;AACvE,KAAM,IAAI6B,MAAK,yCAAsC;AACtD;AACA,GAAMZ,OAAM,CAAGzC,OAAO,CAACsE,IAAI,CAACC,OAAO,CAACrE,QAAO,CAACwC,aAAa,CAAG,CAAC,CAAC;AAC9D,GAAI,CAACD,MAAM,CAAE;AACZ,KAAM,IAAIY,MAAK,+BAA2B3B,MAAM,oBAAkB;AACnE;AACA,GAAIe,MAAM,CAACuC,OAAO,CAAE;AACnB,KAAM,IAAI3B,MAAK,CAAIZ,MAAM,kCAAiC;AAC3D;AACA,MAAOvC,SAAO;AACf;;AAEA,GAAIwB,MAAM,GAAK,MAAM,CAAE,MAAO,KAAI;;AAElC,KAAM,IAAI2B,MAAK,0BAAyB3B,MAAM,MAAI;AACnD,CAAC;;;;;AAKDP,YAAY,CAAZ,sBAAaO,MAA2B,CAAE;AACzC,GAAI,CAACA,MAAM,CAAE;AACb,OAAQA,MAAM,CAACvB,UAAU;AACzB,IAAK,MAAM;AACV,GAAMsC,OAAM,CAAGf,MAAM,CAACrB,SAAS,MAAOqB,MAAM,CAACrB,SAAS,CAAG,CAAC,CAAG,GAAG,CAAG,EAAE,EAAGqB,MAAM,CAACrB,SAAS,GAAO;AAC/F,GAAM4E,MAAK,KAAMvD,MAAM,CAACjB,GAAG,CAAG,MAAM,CAAG,EAAE,GAAGiB,MAAM,CAACpB,IAAI,CAAG,OAAO,CAAG,EAAE,GAAGoB,MAAM,CAAClB,CAAC,CAAG,QAAQ,CAAG,EAAE,GAAGkB,MAAM,CAAChB,IAAI,CAAG,eAAe,CAAG,EAAE,CAAE;AACxI,cAAegB,MAAM,CAACtB,IAAI,CAAG6E,KAAK,CAAGxC,MAAM;AAC5C,IAAK,QAAQ;AACb,IAAK,MAAM;AACV,MAAUf,OAAM,CAACvB,UAAU,KAAIuB,MAAM,CAACgB,aAAa;AACpD,IAAK,OAAO;AACX,cAAe;;AAEjB,CAAC;;;;;;;;;;;;;AAaMwC,UAAU,CAAjB,oBAAkBlF,OAAY,CAAEmF,MAAc,CAAE;AAC/C,GAAI,CAACnF,OAAO,CAAC4B,WAAW,CAAE;AACzB5B,OAAO,CAAC4B,WAAW,CAAG,MAAM;AAC5B,GAAI5B,OAAO,CAAC8B,WAAW,CAAE;AACxB9B,OAAO,CAAC4B,WAAW,CAAG,QAAQ;AAC/B,CAAC,IAAM,IAAI5B,OAAO,CAACoF,WAAW,CAAE;AAC/BpF,OAAO,CAAC4B,WAAW,CAAG,MAAM;AAC7B,CAAC,IAAM,IAAI5B,OAAO,CAACqF,IAAI,CAAE;AACxBrF,OAAO,CAAC4B,WAAW,CAAG,MAAM;AAC7B;AACD;;AAEA,GAAI5B,OAAO,CAAC4B,WAAW,GAAK,MAAM,CAAE5B,OAAO,CAACsF,QAAQ,CAAG,IAAI;AAC3D,GAAItF,OAAO,CAACsE,IAAI,CAAE;AACWtE,OAAO,CAACsE,IAAI,CAACC,OAAO,wCAAE,CAA7C,GAAMC,cAAa;AACvBW,MAAM,CAACI,YAAY,CAACf,aAAa,CAACgB,KAAK,CAACC,MAAM,CAAC,CAAC,CAAC,CAAEjB,aAAa,CAACgB,KAAK,CAAEhB,aAAa,CAACkB,OAAO,CAAElB,aAAa,CAAC;AAC7GW,MAAM,CAACQ,WAAW,CAACnB,aAAa,CAACoB,SAAS,CAAEpB,aAAa,CAAC;AAC3D;AACD;;AAEA,GAAIxE,OAAO,CAAC6B,MAAM,CAAE;AACnB7B,OAAO,CAAC6B,MAAM,CAAG7B,OAAO,CAAC6B,MAAM,CAACgE,GAAG;AAClC,SAAChE,MAAW,CAAEc,CAAS,QAAK3C,QAAO,CAACsE,IAAI,CAACC,OAAO,CAAC5B,CAAC,CAAC,CAACqC,OAAO,CAAG,IAAI,CAAGnD,MAAM,GAC3E,CAAC;;AACmB7B,OAAO,CAAC6B,MAAM,kCAAE,CAAhC,GAAMA,OAAM;AAChB,GAAI,CAACA,MAAM,CAAE,SAAS;AACHA,MAAM,CAACuB,KAAK,gCAAE,CAA5B,GAAMhD,KAAI;AACd,GAAIA,IAAI,CAACA,IAAI,CAAEA,IAAI,CAACsE,IAAI,CAAGtE,IAAI,CAACA,IAAI;AACpCA,IAAI,CAAC2D,EAAE,CAAGL,IAAI,CAACtD,IAAI,CAACsE,IAAI,CAAC;AAC1B;AACA,GAAI7C,MAAM,CAACqB,QAAQ,CAAE;AACpB,GAAIrB,MAAM,CAACqB,QAAQ,CAACA,QAAQ,CAAE;AAC7BrB,MAAM,CAACiE,aAAa,CAAGjE,MAAM,CAACqB,QAAQ,CAAC6C,UAAU;AACjDlE,MAAM,CAACqB,QAAQ,CAAGrB,MAAM,CAACqB,QAAQ,CAACA,QAAQ;AAC3C,CAAC;AACkBrB,MAAM,CAACqB,QAAQ,mCAAE,CAA/B,GAAM9C,MAAI;AACd,GAAIA,KAAI,CAACA,IAAI,CAAEA,KAAI,CAACsE,IAAI,CAAGE,GAAG,CAACxB,KAAK,CAAC0B,GAAG,CAAC1E,KAAI,CAACA,IAAI,CAAC,CAACsE,IAAI;AACxDtE,KAAI,CAAC2D,EAAE,CAAGL,IAAI,CAACtD,KAAI,CAACsE,IAAI,CAAC;AAC1B;AACD;AACA,GAAI7C,MAAM,CAACmE,QAAQ,CAAE;AACpBnE,MAAM,CAACoB,MAAM,CAAGpB,MAAM,CAACmE,QAAQ,CAAC;AACbnE,MAAM,CAACoB,MAAM,iCAAE,CAA7B,GAAM7C,OAAI;AACd,GAAI,CAACA,MAAI,CAAE;AACX,GAAIA,MAAI,CAACA,IAAI,CAAEA,MAAI,CAACsE,IAAI,CAAGtE,MAAI,CAACA,IAAI;AACpCA,MAAI,CAAC2D,EAAE,CAAGL,IAAI,CAACtD,MAAI,CAACsE,IAAI,CAAC;AAC1B;AACD;AACD;AACD;AACD,CAAC"}