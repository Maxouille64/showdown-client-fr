{"version":3,"file":"panel-teambuilder-team.js","names":["TeamRoom","team","PSRoom","TeamTextbox","setInfo","sets","textbox","heightTester","activeType","activeOffsetY","activeSetIndex","search","DexSearch","input","update","select","closeMenu","forceUpdate","focus","cursorOnly","style","width","offsetWidth","value","index","setIndex","selectionStart","selectionEnd","parseState","length","nlIndex","indexOf","line","slice","trim","bottomY","getYAt","atIndex","species","endsWith","parenIndex","lastIndexOf","push","selectionEndCutoff","lcLine","toLowerCase","startsWith","setType","find","window","height","save","scrollHeight","PSTeambuilder","importTeam","props","packedTeam","packTeam","iconCache","PS","teams","componentDidMount","base","getElementsByClassName","unpackTeam","exportedTeam","exportTeam","componentWillUnmount","render","map","info","i","prevOffset","num","Dex","getPokemonIconNum","toID","top","Math","floor","left","iconStyle","resourcePrefix","preact","Component","TeamPanel","rename","e","currentTarget","room","name","byKey","id","PSRoomPanel","roomTypes","Model","title","updateRoomTypes"],"sources":["../src/panel-teambuilder-team.tsx"],"sourcesContent":["/**\n * Teambuilder team panel\n *\n * @author Guangcong Luo <guangcongluo@gmail.com>\n * @license AGPLv3\n */\n\nclass TeamRoom extends PSRoom {\n\tteam: Team | null = null;\n}\n\nclass TeamTextbox extends preact.Component<{team: Team}> {\n\tsetInfo: {\n\t\tspecies: string,\n\t\tbottomY: number,\n\t}[] = [];\n\tsets: PokemonSet[] = [];\n\ttextbox: HTMLTextAreaElement = null!;\n\theightTester: HTMLTextAreaElement = null!;\n\tactiveType: 'pokemon' | 'move' | 'item' | 'ability' | '' = '';\n\tactiveOffsetY = -1;\n\tactiveSetIndex = -1;\n\tsearch = new DexSearch();\n\tgetYAt(index: number, value: string) {\n\t\tif (index < 0) return 10;\n\t\tthis.heightTester.value = value.slice(0, index);\n\t\treturn this.heightTester.scrollHeight;\n\t}\n\tinput = () => this.update();\n\tselect = () => this.update(true);\n\tcloseMenu = () => {\n\t\tthis.activeType = '';\n\t\tthis.forceUpdate();\n\t\tthis.textbox.focus();\n\t};\n\tupdate = (cursorOnly?: boolean) => {\n\t\tconst textbox = this.textbox;\n\t\tthis.heightTester.style.width = `${textbox.offsetWidth}px`;\n\t\tconst value = textbox.value;\n\n\t\tlet index = 0;\n\t\tlet setIndex = -1;\n\t\tif (!cursorOnly) this.setInfo = [];\n\t\tthis.activeOffsetY = -1;\n\t\tthis.activeSetIndex = -1;\n\t\tthis.activeType = '';\n\n\t\tconst selectionStart = textbox.selectionStart || 0;\n\t\tconst selectionEnd = textbox.selectionEnd || 0;\n\n\t\t/** 0 = set top, 1 = set middle */\n\t\tlet parseState: 0 | 1 = 0;\n\t\twhile (index < value.length) {\n\t\t\tlet nlIndex = value.indexOf('\\n', index);\n\t\t\tif (nlIndex < 0) nlIndex = value.length;\n\t\t\tconst line = value.slice(index, nlIndex).trim();\n\n\t\t\tif (!line) {\n\t\t\t\tparseState = 0;\n\t\t\t\tindex = nlIndex + 1;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (parseState === 0 && index && !cursorOnly) {\n\t\t\t\tthis.setInfo[this.setInfo.length - 1].bottomY = this.getYAt(index - 1, value);\n\t\t\t}\n\n\t\t\tif (parseState === 0) {\n\t\t\t\tif (!cursorOnly) {\n\t\t\t\t\tconst atIndex = line.indexOf('@');\n\t\t\t\t\tlet species = atIndex >= 0 ? line.slice(0, atIndex).trim() : line;\n\t\t\t\t\tif (species.endsWith(' (M)') || species.endsWith(' (F)')) {\n\t\t\t\t\t\tspecies = species.slice(0, -4);\n\t\t\t\t\t}\n\t\t\t\t\tif (species.endsWith(')')) {\n\t\t\t\t\t\tconst parenIndex = species.lastIndexOf(' (');\n\t\t\t\t\t\tif (parenIndex >= 0) {\n\t\t\t\t\t\t\tspecies = species.slice(parenIndex + 2, -1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.setInfo.push({\n\t\t\t\t\t\tspecies,\n\t\t\t\t\t\tbottomY: -1,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tparseState = 1;\n\t\t\t\tsetIndex++;\n\t\t\t}\n\n\t\t\tconst selectionEndCutoff = (selectionStart === selectionEnd ? nlIndex : nlIndex + 1);\n\t\t\tif (index <= selectionStart && selectionEnd <= selectionEndCutoff) {\n\t\t\t\t// both ends within range\n\t\t\t\tthis.activeOffsetY = this.getYAt(index - 1, value);\n\t\t\t\tthis.activeSetIndex = setIndex;\n\n\t\t\t\tconst lcLine = line.toLowerCase().trim();\n\t\t\t\tif (lcLine.startsWith('ability:')) {\n\t\t\t\t\tthis.activeType = 'ability';\n\t\t\t\t} else if (lcLine.startsWith('-')) {\n\t\t\t\t\tthis.activeType = 'move';\n\t\t\t\t} else if (\n\t\t\t\t\t!lcLine || lcLine.startsWith('ivs:') || lcLine.startsWith('evs:') ||\n\t\t\t\t\tlcLine.startsWith('level:') || lcLine.startsWith('gender:') ||\n\t\t\t\t\tlcLine.endsWith(' nature') || lcLine.startsWith('shiny:')\n\t\t\t\t) {\n\t\t\t\t\t// leave activeType blank\n\t\t\t\t} else {\n\t\t\t\t\tthis.activeType = 'pokemon';\n\t\t\t\t\tconst atIndex = line.indexOf('@');\n\t\t\t\t\tif (atIndex >= 0 && selectionStart > index + atIndex) {\n\t\t\t\t\t\tthis.activeType = 'item';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.search.setType(this.activeType, 'gen8ou' as ID, this.sets[setIndex]);\n\t\t\t\tthis.search.find('');\n\t\t\t\twindow.search = this.search;\n\t\t\t}\n\n\t\t\tindex = nlIndex + 1;\n\t\t}\n\t\tif (!cursorOnly) {\n\t\t\tconst bottomY = this.getYAt(value.length, value);\n\t\t\tif (this.setInfo.length) {\n\t\t\t\tthis.setInfo[this.setInfo.length - 1].bottomY = bottomY;\n\t\t\t}\n\n\t\t\ttextbox.style.height = `${bottomY + 100}px`;\n\t\t\tthis.save();\n\t\t}\n\t\tthis.forceUpdate();\n\t};\n\tsave() {\n\t\tconst sets = PSTeambuilder.importTeam(this.textbox.value);\n\t\tthis.props.team.packedTeam = PSTeambuilder.packTeam(sets);\n\t\tthis.props.team.iconCache = null;\n\t\tPS.teams.save();\n\t}\n\tcomponentDidMount() {\n\t\tthis.textbox = this.base!.getElementsByClassName('teamtextbox')[0] as HTMLTextAreaElement;\n\t\tthis.heightTester = this.base!.getElementsByClassName('heighttester')[0] as HTMLTextAreaElement;\n\n\t\tthis.sets = PSTeambuilder.unpackTeam(this.props.team.packedTeam);\n\t\tconst exportedTeam = PSTeambuilder.exportTeam(this.sets);\n\t\tthis.textbox.value = exportedTeam;\n\t\tthis.update();\n\t}\n\tcomponentWillUnmount() {\n\t\tthis.textbox = null!;\n\t\tthis.heightTester = null!;\n\t}\n\trender() {\n\t\treturn <div class=\"teameditor\">\n\t\t\t<textarea class=\"textbox teamtextbox\" onInput={this.input} onSelect={this.select} onClick={this.select} onKeyUp={this.select} />\n\t\t\t<textarea\n\t\t\t\tclass=\"textbox teamtextbox heighttester\" style=\"visibility:hidden\" tabIndex={-1} aria-hidden={true}\n\t\t\t/>\n\t\t\t<div class=\"teamoverlays\">\n\t\t\t\t{this.setInfo.slice(0, -1).map(info =>\n\t\t\t\t\t<hr style={`top:${info.bottomY - 18}px`} />\n\t\t\t\t)}\n\t\t\t\t{this.setInfo.map((info, i) => {\n\t\t\t\t\tif (!info.species) return null;\n\t\t\t\t\tconst prevOffset = i === 0 ? 8 : this.setInfo[i - 1].bottomY;\n\t\t\t\t\tconst species = info.species;\n\t\t\t\t\tconst num = Dex.getPokemonIconNum(toID(species));\n\t\t\t\t\tif (!num) return null;\n\n\t\t\t\t\tconst top = Math.floor(num / 12) * 30;\n\t\t\t\t\tconst left = (num % 12) * 40;\n\t\t\t\t\tconst iconStyle = `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-sheet.png) no-repeat scroll -${left}px -${top}px`;\n\n\t\t\t\t\treturn <span class=\"picon\" style={\n\t\t\t\t\t\t`top:${prevOffset + 1}px;left:50px;position:absolute;${iconStyle}`\n\t\t\t\t\t}></span>;\n\t\t\t\t})}\n\t\t\t\t{this.activeOffsetY >= 0 &&\n\t\t\t\t\t<div class=\"teaminnertextbox\" style={{top: this.activeOffsetY - 1}}></div>\n\t\t\t\t}\n\t\t\t</div>\n\t\t\t{this.activeType && <div class=\"searchresults\" style={{top: this.activeSetIndex >= 0 ? this.setInfo[this.activeSetIndex].bottomY - 12 : 0}}>\n\t\t\t\t<button class=\"button closesearch\" onClick={this.closeMenu}><i class=\"fa fa-times\"></i> Close</button>\n\t\t\t\t<PSSearchResults search={this.search} />\n\t\t\t</div>}\n\t\t</div>;\n\t}\n}\n\nclass TeamPanel extends PSRoomPanel<TeamRoom> {\n\trename = (e: Event) => {\n\t\tconst textbox = e.currentTarget as HTMLInputElement;\n\t\tconst room = this.props.room;\n\n\t\troom.team!.name = textbox.value.trim();\n\t\tPS.teams.save();\n\t};\n\trender() {\n\t\tconst room = this.props.room;\n\t\tconst team = PS.teams.byKey[room.id.slice(5)];\n\t\tif (!team) {\n\t\t\treturn <PSPanelWrapper room={room}>\n\t\t\t\t<button class=\"button\" data-href=\"teambuilder\" data-target=\"replace\">\n\t\t\t\t\t<i class=\"fa fa-chevron-left\"></i> List\n\t\t\t\t</button>\n\t\t\t\t<p class=\"error\">\n\t\t\t\t\tTeam doesn't exist\n\t\t\t\t</p>\n\t\t\t</PSPanelWrapper>;\n\t\t}\n\n\t\tif (!room.team) room.team = team;\n\t\treturn <PSPanelWrapper room={room} scrollable>\n\t\t\t<div class=\"pad\">\n\t\t\t\t<button class=\"button\" data-href=\"teambuilder\" data-target=\"replace\">\n\t\t\t\t\t<i class=\"fa fa-chevron-left\"></i> List\n\t\t\t\t</button>\n\t\t\t\t<label class=\"label teamname\">\n\t\t\t\t\tTeam name:\n\t\t\t\t\t<input class=\"textbox\" type=\"text\" value={team.name} onInput={this.rename} onChange={this.rename} onKeyUp={this.rename} />\n\t\t\t\t</label>\n\t\t\t\t<TeamTextbox team={team} />\n\t\t\t</div>\n\t\t</PSPanelWrapper>;\n\t}\n}\n\nPS.roomTypes['team'] = {\n\tModel: TeamRoom,\n\tComponent: TeamPanel,\n\ttitle: \"Team\",\n};\nPS.updateRoomTypes();\n"],"mappings":"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"}